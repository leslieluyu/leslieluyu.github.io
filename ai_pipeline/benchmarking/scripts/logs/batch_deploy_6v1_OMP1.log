2023-03-14 20:06:50,727 - INFO - Starting batch deployment...
2023-03-14 20:06:50,730 - INFO - ------------- scenario: 1/5 ------------
2023-03-14 20:06:50,730 - INFO - Begin set_deployment_env of scenario : AMX_BF16 ...
2023-03-14 20:06:50,769 - INFO - Setting environment variables for scenario AMX_BF16...
2023-03-14 20:06:50,791 - INFO - Setting resource requests and limits for scenario AMX_BF16...
2023-03-14 20:06:50,812 - INFO - after patch_body wait for 30 seconds to enable the new pods
2023-03-14 20:07:20,819 - INFO - Waiting for 1 pods to be ready for scenario AMX_BF16...
2023-03-14 20:07:20,901 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:07:20,902 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:07:20,902 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 0.08 seconds
2023-03-14 20:07:30,932 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:07:30,932 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:07:30,932 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 10.11 seconds
2023-03-14 20:07:40,968 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:07:40,969 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:07:40,969 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 20.15 seconds
2023-03-14 20:07:51,006 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:07:51,007 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:07:51,007 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 30.19 seconds
2023-03-14 20:08:01,042 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:08:01,042 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:08:01,042 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 40.22 seconds
2023-03-14 20:08:11,080 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:08:11,080 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:08:11,080 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 50.26 seconds
2023-03-14 20:08:21,118 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:08:21,119 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:08:21,119 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 60.30 seconds
2023-03-14 20:08:31,156 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:08:31,156 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:08:31,156 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 70.34 seconds
2023-03-14 20:08:41,191 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:08:41,191 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:08:41,191 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 80.37 seconds
2023-03-14 20:08:51,230 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:08:51,230 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:08:51,230 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 90.41 seconds
2023-03-14 20:09:01,266 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:09:01,266 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:09:01,266 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 100.45 seconds
2023-03-14 20:09:11,303 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:09:11,303 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:09:11,303 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 110.48 seconds
2023-03-14 20:09:21,340 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:09:21,341 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:09:21,341 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 120.52 seconds
2023-03-14 20:09:31,376 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:09:31,376 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:09:31,376 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 130.56 seconds
2023-03-14 20:09:41,413 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:09:41,413 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:09:41,413 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 140.59 seconds
2023-03-14 20:09:51,445 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:09:51,445 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:09:51,445 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 150.63 seconds
2023-03-14 20:10:01,480 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:10:01,480 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:10:01,480 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 160.66 seconds
2023-03-14 20:10:11,516 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:10:11,516 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:10:11,517 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 170.70 seconds
2023-03-14 20:10:21,554 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:10:21,554 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:10:21,554 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 180.73 seconds
2023-03-14 20:10:31,590 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:10:31,591 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:10:31,591 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 190.77 seconds
2023-03-14 20:10:41,631 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:10:41,631 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:10:41,631 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 200.81 seconds
2023-03-14 20:10:51,667 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:10:51,667 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:10:51,668 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 210.85 seconds
2023-03-14 20:11:01,703 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:11:01,703 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:11:01,704 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 220.88 seconds
2023-03-14 20:11:11,740 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:11:11,740 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:11:11,740 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 230.92 seconds
2023-03-14 20:11:21,776 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:11:21,776 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:11:21,777 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 240.96 seconds
2023-03-14 20:11:31,812 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:11:31,813 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:11:31,813 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 250.99 seconds
2023-03-14 20:11:41,848 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:11:41,848 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:11:41,848 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 261.03 seconds
2023-03-14 20:11:51,896 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:11:51,896 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:11:51,896 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 271.08 seconds
2023-03-14 20:12:01,933 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:12:01,933 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:12:01,933 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 281.11 seconds
2023-03-14 20:12:11,969 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:12:11,969 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:12:11,969 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 291.15 seconds
2023-03-14 20:12:22,003 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:12:22,004 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:12:22,004 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 301.18 seconds
2023-03-14 20:12:32,041 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:12:32,042 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:12:32,042 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 311.22 seconds
2023-03-14 20:12:42,077 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:12:42,077 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:12:42,077 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 321.26 seconds
2023-03-14 20:12:52,113 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:12:52,113 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:12:52,113 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 331.29 seconds
2023-03-14 20:13:02,148 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:13:02,148 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:13:02,149 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 341.33 seconds
2023-03-14 20:13:12,184 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:13:12,184 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:13:12,184 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 351.36 seconds
2023-03-14 20:13:22,220 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:13:22,220 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:13:22,221 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 361.40 seconds
2023-03-14 20:13:32,255 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:13:32,256 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:13:32,256 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 371.44 seconds
2023-03-14 20:13:42,291 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:13:42,291 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:13:42,291 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 381.47 seconds
2023-03-14 20:13:52,327 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:13:52,327 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:13:52,327 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 391.51 seconds
2023-03-14 20:14:02,363 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:14:02,364 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:14:02,364 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 401.54 seconds
2023-03-14 20:14:12,400 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:14:12,401 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:14:12,401 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 411.58 seconds
2023-03-14 20:14:22,436 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:14:22,437 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:14:22,437 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 421.62 seconds
2023-03-14 20:14:32,473 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:14:32,474 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:14:32,474 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 431.65 seconds
2023-03-14 20:14:42,509 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:14:42,509 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:14:42,510 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 441.69 seconds
2023-03-14 20:14:52,545 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-rx4nn status:Running
2023-03-14 20:14:52,545 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Pending
2023-03-14 20:14:52,545 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_BF16. Elapsed time: 451.73 seconds
2023-03-14 20:15:02,574 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Running
2023-03-14 20:15:02,574 - INFO - All 1 pods are ready for scenario AMX_BF16
2023-03-14 20:15:02,575 - INFO - Finished scenario AMX_BF16
2023-03-14 20:15:02,575 - INFO - wait for 2m to get stable metrics ...
2023-03-14 20:17:02,675 - INFO - Running benchmarking script for scenario AMX_BF16...
2023-03-14 20:17:02,688 - INFO - TS=20230314201702
2023-03-14 20:17:04,628 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:17:04,629 - INFO - Reading package lists...
2023-03-14 20:17:04,629 - INFO - Building dependency tree...
2023-03-14 20:17:04,629 - INFO - Reading state information...
2023-03-14 20:17:04,629 - INFO - linux-tools-5.15.0-60-generic is already the newest version (5.15.0-60.66).
2023-03-14 20:17:04,629 - INFO - sysstat is already the newest version (12.5.2-2ubuntu0.1).
2023-03-14 20:17:04,629 - INFO - The following packages were automatically installed and are no longer required:
2023-03-14 20:17:04,629 - INFO - cgroupfs-mount libltdl7 pigz
2023-03-14 20:17:04,629 - INFO - Use 'sudo apt autoremove' to remove them.
2023-03-14 20:17:04,629 - INFO - 0 upgraded, 0 newly installed, 0 to remove and 44 not upgraded.
2023-03-14 20:17:04,629 - INFO - WARNING: apt does not have a stable CLI interface. Use with caution in scripts.
2023-03-14 20:17:05,711 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:17:05,711 - INFO - 
2023-03-14 20:17:06,760 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:17:06,760 - INFO - performance
2023-03-14 20:17:06,853 - INFO - Run on test AiPipeline_20230314201702_E086_AMX_BF16_6
2023-03-14 20:17:06,854 - INFO - TT=AiPipeline_20230314201702_E086_AMX_BF16_6,WRKDIR=/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon
2023-03-14 20:17:06,860 - INFO - -----------loop num:1/3------------
2023-03-14 20:17:16,866 - INFO - 1.  fetch_emon.sh
2023-03-14 20:17:16,868 - INFO - pwd=/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon
2023-03-14 20:17:18,163 - INFO - 10.45.247.200 | SUCCESS => {
2023-03-14 20:17:18,163 - INFO - "ansible_facts": {
2023-03-14 20:17:18,163 - INFO - "discovered_interpreter_python": "/usr/bin/python3"
2023-03-14 20:17:18,163 - INFO - },
2023-03-14 20:17:18,163 - INFO - "changed": false,
2023-03-14 20:17:18,163 - INFO - "checksum": "1bb1c680bf42bce57bd33e9ee945d27bb8aeaafc",
2023-03-14 20:17:18,164 - INFO - "dest": "runemon.sh",
2023-03-14 20:17:18,164 - INFO - "gid": 1007,
2023-03-14 20:17:18,164 - INFO - "group": "ansible",
2023-03-14 20:17:18,164 - INFO - "mode": "0755",
2023-03-14 20:17:18,164 - INFO - "owner": "ansible",
2023-03-14 20:17:18,164 - INFO - "path": "runemon.sh",
2023-03-14 20:17:18,164 - INFO - "size": 452,
2023-03-14 20:17:18,164 - INFO - "state": "file",
2023-03-14 20:17:18,164 - INFO - "uid": 1006
2023-03-14 20:17:18,164 - INFO - }
2023-03-14 20:17:19,542 - INFO - 10.45.247.200 | SUCCESS => {
2023-03-14 20:17:19,543 - INFO - "ansible_facts": {
2023-03-14 20:17:19,543 - INFO - "discovered_interpreter_python": "/usr/bin/python3"
2023-03-14 20:17:19,543 - INFO - },
2023-03-14 20:17:19,543 - INFO - "changed": false,
2023-03-14 20:17:19,543 - INFO - "checksum": "0b7ce1d178a191ee4962273d5bcbcac8b825066d",
2023-03-14 20:17:19,543 - INFO - "dest": "sapphirerapids_server_events_private.txt",
2023-03-14 20:17:19,543 - INFO - "gid": 1007,
2023-03-14 20:17:19,543 - INFO - "group": "ansible",
2023-03-14 20:17:19,543 - INFO - "mode": "0664",
2023-03-14 20:17:19,543 - INFO - "owner": "ansible",
2023-03-14 20:17:19,544 - INFO - "path": "sapphirerapids_server_events_private.txt",
2023-03-14 20:17:19,544 - INFO - "size": 23423,
2023-03-14 20:17:19,544 - INFO - "state": "file",
2023-03-14 20:17:19,544 - INFO - "uid": 1006
2023-03-14 20:17:19,544 - INFO - }
2023-03-14 20:17:20,609 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:17:20,609 - INFO - 
2023-03-14 20:17:21,647 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:17:21,648 - INFO - 
2023-03-14 20:17:21,743 - INFO - Sleep 5 seconds then collect emon data for 30 seconds
2023-03-14 20:17:26,746 - INFO - Collecting 30 seconds sar data background
2023-03-14 20:17:28,713 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:17:28,713 - INFO - 
2023-03-14 20:17:30,774 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:17:30,775 - INFO - 
2023-03-14 20:17:32,830 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:17:32,830 - INFO - 
2023-03-14 20:17:34,887 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:17:34,888 - INFO - 
2023-03-14 20:17:34,984 - INFO - Collecting EMON data
2023-03-14 20:18:06,523 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:18:06,523 - INFO - Usage: sep_vars.sh [emon_api]
2023-03-14 20:18:06,523 - INFO - PATH=/opt/intel/sep/bin64:/opt/intel/sep/android_target:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin
2023-03-14 20:18:06,523 - INFO - CPATH=/opt/intel/sep/config/emon_api:
2023-03-14 20:18:06,524 - INFO - LIBRARY_PATH=/opt/intel/sep/lib64:
2023-03-14 20:18:06,524 - INFO - LD_LIBRARY_PATH=
2023-03-14 20:18:06,524 - INFO - SEP_BASE_DIR=/opt/intel/sep/bin64
2023-03-14 20:18:06,524 - INFO - SEP is currently installed under /opt/intel/sep/bin64
2023-03-14 20:18:06,524 - INFO - EMON collector successfully stopped.
2023-03-14 20:18:06,619 - INFO - Sleep another 30 seconds to make sure the previous run exit
2023-03-14 20:18:36,622 - INFO - Copy dat files
2023-03-14 20:18:37,630 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:18:37,631 - INFO - "changed": true,
2023-03-14 20:18:37,631 - INFO - "checksum": "650fe0d4b6b41398bb6989b02faf86d77e63471f",
2023-03-14 20:18:37,631 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/cpuutil.log",
2023-03-14 20:18:37,631 - INFO - "md5sum": "ed94b8719d12f98c3f4c4ff0e05a867c",
2023-03-14 20:18:37,631 - INFO - "remote_checksum": "650fe0d4b6b41398bb6989b02faf86d77e63471f",
2023-03-14 20:18:37,631 - INFO - "remote_md5sum": null
2023-03-14 20:18:37,631 - INFO - }
2023-03-14 20:18:38,726 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:18:38,727 - INFO - "changed": true,
2023-03-14 20:18:38,727 - INFO - "checksum": "2b607d740523568e5b9a2274364adf34014adb3e",
2023-03-14 20:18:38,727 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/diskutil.log",
2023-03-14 20:18:38,727 - INFO - "md5sum": "6ff44b465ec8948e187b84e2ec904ba6",
2023-03-14 20:18:38,727 - INFO - "remote_checksum": "2b607d740523568e5b9a2274364adf34014adb3e",
2023-03-14 20:18:38,727 - INFO - "remote_md5sum": null
2023-03-14 20:18:38,727 - INFO - }
2023-03-14 20:18:39,848 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:18:39,848 - INFO - "changed": true,
2023-03-14 20:18:39,848 - INFO - "checksum": "a3157be479033aeb948759c4f599605ffed1cae6",
2023-03-14 20:18:39,849 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/netutil.log",
2023-03-14 20:18:39,849 - INFO - "md5sum": "9cb7dc87766d43d45ef3a412c96fe326",
2023-03-14 20:18:39,849 - INFO - "remote_checksum": "a3157be479033aeb948759c4f599605ffed1cae6",
2023-03-14 20:18:39,849 - INFO - "remote_md5sum": null
2023-03-14 20:18:39,849 - INFO - }
2023-03-14 20:18:40,989 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:18:40,989 - INFO - "changed": true,
2023-03-14 20:18:40,989 - INFO - "checksum": "496fe09d70ccdaac5bf470f9455f3707d1419f5d",
2023-03-14 20:18:40,989 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/top.log",
2023-03-14 20:18:40,990 - INFO - "md5sum": "674ad1995b50fa6dc61ea661135d9c47",
2023-03-14 20:18:40,990 - INFO - "remote_checksum": "496fe09d70ccdaac5bf470f9455f3707d1419f5d",
2023-03-14 20:18:40,990 - INFO - "remote_md5sum": null
2023-03-14 20:18:40,990 - INFO - }
2023-03-14 20:18:42,097 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:18:42,097 - INFO - "changed": true,
2023-03-14 20:18:42,097 - INFO - "checksum": "0eecf027044a52ff57e87a1ef1f9277e1ceb146e",
2023-03-14 20:18:42,097 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon-v.dat",
2023-03-14 20:18:42,097 - INFO - "md5sum": "9ed6ca61f164c3a1ddac82b3adb8e41f",
2023-03-14 20:18:42,097 - INFO - "remote_checksum": "0eecf027044a52ff57e87a1ef1f9277e1ceb146e",
2023-03-14 20:18:42,098 - INFO - "remote_md5sum": null
2023-03-14 20:18:42,098 - INFO - }
2023-03-14 20:18:43,186 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:18:43,186 - INFO - "changed": true,
2023-03-14 20:18:43,186 - INFO - "checksum": "553de59ae1f861c17499a345947edac24f5ef5e6",
2023-03-14 20:18:43,187 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon-M.dat",
2023-03-14 20:18:43,187 - INFO - "md5sum": "82b2e5d1d33c2feb6e5d5290b113dd3f",
2023-03-14 20:18:43,187 - INFO - "remote_checksum": "553de59ae1f861c17499a345947edac24f5ef5e6",
2023-03-14 20:18:43,187 - INFO - "remote_md5sum": null
2023-03-14 20:18:43,187 - INFO - }
2023-03-14 20:18:44,822 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:18:44,823 - INFO - "changed": true,
2023-03-14 20:18:44,823 - INFO - "checksum": "c2ea5c98927b30c7d52175476d0dd186f4de1332",
2023-03-14 20:18:44,823 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon.dat",
2023-03-14 20:18:44,823 - INFO - "md5sum": "e770a97f702de579efb0e2dcc1e9854e",
2023-03-14 20:18:44,823 - INFO - "remote_checksum": "c2ea5c98927b30c7d52175476d0dd186f4de1332",
2023-03-14 20:18:44,823 - INFO - "remote_md5sum": null
2023-03-14 20:18:44,823 - INFO - }
2023-03-14 20:18:44,930 - INFO - 2. fetch the matrics of ai_pipeline
2023-03-14 20:18:44,930 - INFO - 3.  collect the result
2023-03-14 20:18:45,076 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(rate(container_cpu_usage_seconds_total{namespace="default", container!=""}[2m])[2m:])
2023-03-14 20:18:45,076 - INFO - metric_name is: cpu_usage
2023-03-14 20:18:45,091 - INFO - result is: [{'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod37bfe08c_1a35_4f31_aee2_d3ed773045f6.slice/cri-containerd-32957fce66e8ca89850f6a363f2bad55c4c434f4dd10e8ee22d59409d4d63156.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '32957fce66e8ca89850f6a363f2bad55c4c434f4dd10e8ee22d59409d4d63156', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-06-59c94bd6dd-7fqpw', 'service': 'kubelet'}, 'value': [1678850325.075, '0.07638542777779851']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod443d56fd_7192_407b_aa7f_3a19c6164b35.slice/cri-containerd-8ef35ec5e997b42b467e9a537ce481f8b80255b055daf3b4d653e511cc959b79.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '8ef35ec5e997b42b467e9a537ce481f8b80255b055daf3b4d653e511cc959b79', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-02-59c94bd6dd-hf2k2', 'service': 'kubelet'}, 'value': [1678850325.075, '0.07357630277777691']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod5b20665e_1471_41e3_a906_37dbadf61ded.slice/cri-containerd-1903d9a29e2cc9280c983cf212ed426789dd4724ed212d8d6aaa692b7099b21d.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '1903d9a29e2cc9280c983cf212ed426789dd4724ed212d8d6aaa692b7099b21d', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-05-59c94bd6dd-2vw5v', 'service': 'kubelet'}, 'value': [1678850325.075, '0.07270878333333206']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podc1b02e88_e7c7_494d_b700_42e46c1f306d.slice/cri-containerd-8eb30a61e0cb53f9f0a8c0c18dc645c56eb3686a459ce4441c537113ae8007ae.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '8eb30a61e0cb53f9f0a8c0c18dc645c56eb3686a459ce4441c537113ae8007ae', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-04-59c94bd6dd-whjrf', 'service': 'kubelet'}, 'value': [1678850325.075, '0.07229334722222927']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podf0bbadd5_e728_4dc7_ac09_67de87ab9ed9.slice/cri-containerd-d2606d2272b90c545952113b692da741b7958b163650096e2f624aeee76293a8.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'd2606d2272b90c545952113b692da741b7958b163650096e2f624aeee76293a8', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-03-59c94bd6dd-57bn5', 'service': 'kubelet'}, 'value': [1678850325.075, '0.07518523611110545']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podf765b16c_07f8_4261_9b64_3517dc6bafb7.slice/cri-containerd-88d725ffe5a1ce389c7c711b044f1cbdd7b97a922268c6d9d0735d1ba203f048.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '88d725ffe5a1ce389c7c711b044f1cbdd7b97a922268c6d9d0735d1ba203f048', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-01-59c94bd6dd-n5rdt', 'service': 'kubelet'}, 'value': [1678850325.075, '0.06941814166665507']}, {'metric': {'container': 'ei-gws', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podaf221d52_33c6_40a0_b6bf_e5e2bc7b88db.slice/cri-containerd-870edc8724b46c501ca89d89b821712566f2c55b1d2077b638d4cbb0f32dcada.scope', 'image': 'ccr-registry.caas.intel.com/cnbench/ei-gateway-server:2022WW51-ws-8080', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '870edc8724b46c501ca89d89b821712566f2c55b1d2077b638d4cbb0f32dcada', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-gateway-server-deployment-694bf969dd-xhbg9', 'service': 'kubelet'}, 'value': [1678850325.075, '0.0011900444444443614']}, {'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-burstable.slice/kubepods-burstable-poda4ccd870_7213_4e3f_a9a2_1ca4f1992c29.slice/cri-containerd-7c8b612bc099941f3a6e91c530c79f85e4a532a0078c3b9476152e8dd66f7c64.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-inference-service-tensorflow:2022WW49', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '7c8b612bc099941f3a6e91c530c79f85e4a532a0078c3b9476152e8dd66f7c64', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x', 'service': 'kubelet'}, 'value': [1678850325.075, '1.5373042074742593']}, {'metric': {'container': 'ei-wss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podd781997c_c6e4_4a9a_8814_f1a5e364edb4.slice/cri-containerd-d43dd1ddebde49d8cd5407a60d348e56d9384fcda992f264ae9ca5887ba0ab87.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-websocket-server:2022WW51', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'd43dd1ddebde49d8cd5407a60d348e56d9384fcda992f264ae9ca5887ba0ab87', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-websocket-server-deployment-b4f68d987-95vnz', 'service': 'kubelet'}, 'value': [1678850325.075, '0.009486719444445648']}, {'metric': {'container': 'nfs-subdir-external-provisioner', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod008ca2f8_cd34_4bb5_9e75_b46ec5ce9a23.slice/cri-containerd-710ae0fcfaef79b8c1cbf5871a10727a0da4ef1ca22a1fd9e475a740588b43e4.scope', 'image': 'k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '710ae0fcfaef79b8c1cbf5871a10727a0da4ef1ca22a1fd9e475a740588b43e4', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'nfs-subdir-external-provisioner-6f66496f8f-529tg', 'service': 'kubelet'}, 'value': [1678850325.075, '0.0009870194444437806']}, {'metric': {'container': 'redis', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod0d8f249f_8e44_4dae_82d3_618b15befd15.slice/cri-containerd-0d39607a911d680151ccaee4e31a4eeb21acbade8e1a9eb7cd5377c4796e012e.scope', 'image': 'docker.io/library/redis:6.0', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '0d39607a911d680151ccaee4e31a4eeb21acbade8e1a9eb7cd5377c4796e012e', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-redis-deployment-68df56c9d5-9kt42', 'service': 'kubelet'}, 'value': [1678850325.075, '0.014463005555550504']}, {'metric': {'container': 'tmp-shell', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod9cbe7477_0ea6_463d_8c1e_33eb5efda051.slice/cri-containerd-9093ed8c6f94ca6b98db8362a28e0ee47cc31e863e7c131462759af96d66c3e9.scope', 'image': 'docker.io/nicolaka/netshoot:latest', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '9093ed8c6f94ca6b98db8362a28e0ee47cc31e863e7c131462759af96d66c3e9', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'tmp-shell', 'service': 'kubelet'}, 'value': [1678850325.075, '0']}]
2023-03-14 20:18:45,091 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=sum(container_memory_working_set_bytes{namespace="default",container!="", image!=""}) by (pod)
2023-03-14 20:18:45,091 - INFO - metric_name is: memory_usage
2023-03-14 20:18:45,091 - INFO - result is: [{'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-06-59c94bd6dd-7fqpw'}, 'value': [1678850325.079, '386166784']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-02-59c94bd6dd-hf2k2'}, 'value': [1678850325.079, '386457600']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-05-59c94bd6dd-2vw5v'}, 'value': [1678850325.079, '386572288']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-04-59c94bd6dd-whjrf'}, 'value': [1678850325.079, '386162688']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-03-59c94bd6dd-57bn5'}, 'value': [1678850325.079, '386523136']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-01-59c94bd6dd-n5rdt'}, 'value': [1678850325.079, '386158592']}, {'metric': {'pod': 'ei-gateway-server-deployment-694bf969dd-xhbg9'}, 'value': [1678850325.079, '56774656']}, {'metric': {'pod': 'ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x'}, 'value': [1678850325.079, '518868992']}, {'metric': {'pod': 'ei-websocket-server-deployment-b4f68d987-95vnz'}, 'value': [1678850325.079, '5093195776']}, {'metric': {'pod': 'nfs-subdir-external-provisioner-6f66496f8f-529tg'}, 'value': [1678850325.079, '15171584']}, {'metric': {'pod': 'ei-redis-deployment-68df56c9d5-9kt42'}, 'value': [1678850325.079, '2444963840']}, {'metric': {'pod': 'tmp-shell'}, 'value': [1678850325.079, '847872']}]
2023-03-14 20:18:45,091 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_infer_fps{namespace="default"}[2m])
2023-03-14 20:18:45,092 - INFO - metric_name is: ei_infer_fps
2023-03-14 20:18:45,092 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.58:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678850325.083, '105.96558718904133']}]
2023-03-14 20:18:45,092 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_drop_fps{namespace="default"}[2m])
2023-03-14 20:18:45,092 - INFO - metric_name is: ei_drop_fps
2023-03-14 20:18:45,092 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.58:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678850325.087, '64.03925423150449']}]
2023-03-14 20:18:45,092 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_scale_ratio{namespace="default"}[2m])
2023-03-14 20:18:45,092 - INFO - metric_name is: ei_scale_ratio
2023-03-14 20:18:45,092 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.58:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678850325.091, '1.6044770547118705']}]
2023-03-14 20:18:45,092 - INFO - Results written to metrics/E086_AMX_BF16_metrics_20230314_201845.txt
2023-03-14 20:18:45,146 - INFO - sleep 120 seconds for the next round ...
2023-03-14 20:20:45,149 - INFO - -----------loop num:2/3------------
2023-03-14 20:20:55,156 - INFO - 1.  fetch_emon.sh
2023-03-14 20:20:55,158 - INFO - pwd=/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon
2023-03-14 20:20:57,078 - INFO - 10.45.247.200 | SUCCESS => {
2023-03-14 20:20:57,079 - INFO - "ansible_facts": {
2023-03-14 20:20:57,079 - INFO - "discovered_interpreter_python": "/usr/bin/python3"
2023-03-14 20:20:57,079 - INFO - },
2023-03-14 20:20:57,079 - INFO - "changed": false,
2023-03-14 20:20:57,079 - INFO - "checksum": "1bb1c680bf42bce57bd33e9ee945d27bb8aeaafc",
2023-03-14 20:20:57,079 - INFO - "dest": "runemon.sh",
2023-03-14 20:20:57,079 - INFO - "gid": 1007,
2023-03-14 20:20:57,079 - INFO - "group": "ansible",
2023-03-14 20:20:57,079 - INFO - "mode": "0755",
2023-03-14 20:20:57,079 - INFO - "owner": "ansible",
2023-03-14 20:20:57,080 - INFO - "path": "runemon.sh",
2023-03-14 20:20:57,080 - INFO - "size": 452,
2023-03-14 20:20:57,080 - INFO - "state": "file",
2023-03-14 20:20:57,080 - INFO - "uid": 1006
2023-03-14 20:20:57,080 - INFO - }
2023-03-14 20:20:58,468 - INFO - 10.45.247.200 | SUCCESS => {
2023-03-14 20:20:58,469 - INFO - "ansible_facts": {
2023-03-14 20:20:58,469 - INFO - "discovered_interpreter_python": "/usr/bin/python3"
2023-03-14 20:20:58,469 - INFO - },
2023-03-14 20:20:58,469 - INFO - "changed": false,
2023-03-14 20:20:58,469 - INFO - "checksum": "0b7ce1d178a191ee4962273d5bcbcac8b825066d",
2023-03-14 20:20:58,469 - INFO - "dest": "sapphirerapids_server_events_private.txt",
2023-03-14 20:20:58,469 - INFO - "gid": 1007,
2023-03-14 20:20:58,469 - INFO - "group": "ansible",
2023-03-14 20:20:58,469 - INFO - "mode": "0664",
2023-03-14 20:20:58,470 - INFO - "owner": "ansible",
2023-03-14 20:20:58,470 - INFO - "path": "sapphirerapids_server_events_private.txt",
2023-03-14 20:20:58,470 - INFO - "size": 23423,
2023-03-14 20:20:58,470 - INFO - "state": "file",
2023-03-14 20:20:58,470 - INFO - "uid": 1006
2023-03-14 20:20:58,470 - INFO - }
2023-03-14 20:20:59,543 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:20:59,543 - INFO - 
2023-03-14 20:21:00,597 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:21:00,598 - INFO - 
2023-03-14 20:21:00,704 - INFO - Sleep 5 seconds then collect emon data for 30 seconds
2023-03-14 20:21:05,707 - INFO - Collecting 30 seconds sar data background
2023-03-14 20:21:07,668 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:21:07,669 - INFO - 
2023-03-14 20:21:09,728 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:21:09,728 - INFO - 
2023-03-14 20:21:11,786 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:21:11,787 - INFO - 
2023-03-14 20:21:13,832 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:21:13,832 - INFO - 
2023-03-14 20:21:13,934 - INFO - Collecting EMON data
2023-03-14 20:21:45,437 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:21:45,438 - INFO - Usage: sep_vars.sh [emon_api]
2023-03-14 20:21:45,438 - INFO - PATH=/opt/intel/sep/bin64:/opt/intel/sep/android_target:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin
2023-03-14 20:21:45,438 - INFO - CPATH=/opt/intel/sep/config/emon_api:
2023-03-14 20:21:45,438 - INFO - LIBRARY_PATH=/opt/intel/sep/lib64:
2023-03-14 20:21:45,438 - INFO - LD_LIBRARY_PATH=
2023-03-14 20:21:45,438 - INFO - SEP_BASE_DIR=/opt/intel/sep/bin64
2023-03-14 20:21:45,438 - INFO - SEP is currently installed under /opt/intel/sep/bin64
2023-03-14 20:21:45,438 - INFO - EMON collector successfully stopped.
2023-03-14 20:21:45,538 - INFO - Sleep another 30 seconds to make sure the previous run exit
2023-03-14 20:22:15,541 - INFO - Copy dat files
2023-03-14 20:22:16,552 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:22:16,553 - INFO - "changed": true,
2023-03-14 20:22:16,553 - INFO - "checksum": "c6acff06846c96c734f7fd01ef3922c4318bf227",
2023-03-14 20:22:16,553 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/cpuutil.log",
2023-03-14 20:22:16,553 - INFO - "md5sum": "dc14a7756cce0b435203ec1a38f819f4",
2023-03-14 20:22:16,553 - INFO - "remote_checksum": "c6acff06846c96c734f7fd01ef3922c4318bf227",
2023-03-14 20:22:16,553 - INFO - "remote_md5sum": null
2023-03-14 20:22:16,553 - INFO - }
2023-03-14 20:22:17,648 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:22:17,648 - INFO - "changed": true,
2023-03-14 20:22:17,648 - INFO - "checksum": "11ce86d561b402461836816c892c1e1becd3af81",
2023-03-14 20:22:17,648 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/diskutil.log",
2023-03-14 20:22:17,648 - INFO - "md5sum": "f9523d11f327af3f83679582e24da908",
2023-03-14 20:22:17,649 - INFO - "remote_checksum": "11ce86d561b402461836816c892c1e1becd3af81",
2023-03-14 20:22:17,649 - INFO - "remote_md5sum": null
2023-03-14 20:22:17,649 - INFO - }
2023-03-14 20:22:18,741 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:22:18,741 - INFO - "changed": true,
2023-03-14 20:22:18,741 - INFO - "checksum": "711259ff6f7e9e3c7495a3a7268f0cc55ece7d4d",
2023-03-14 20:22:18,741 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/netutil.log",
2023-03-14 20:22:18,741 - INFO - "md5sum": "859e1a7d4925a8060e52c2010bf25c22",
2023-03-14 20:22:18,742 - INFO - "remote_checksum": "711259ff6f7e9e3c7495a3a7268f0cc55ece7d4d",
2023-03-14 20:22:18,742 - INFO - "remote_md5sum": null
2023-03-14 20:22:18,742 - INFO - }
2023-03-14 20:22:19,990 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:22:19,990 - INFO - "changed": true,
2023-03-14 20:22:19,990 - INFO - "checksum": "e8655e38c9248d35ffb773aea3f1e8d5e3f8b649",
2023-03-14 20:22:19,990 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/top.log",
2023-03-14 20:22:19,990 - INFO - "md5sum": "fd2b0fb0c2fac29b636a01d901dcd2c8",
2023-03-14 20:22:19,990 - INFO - "remote_checksum": "e8655e38c9248d35ffb773aea3f1e8d5e3f8b649",
2023-03-14 20:22:19,990 - INFO - "remote_md5sum": null
2023-03-14 20:22:19,990 - INFO - }
2023-03-14 20:22:21,070 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:22:21,070 - INFO - "changed": true,
2023-03-14 20:22:21,070 - INFO - "checksum": "0eecf027044a52ff57e87a1ef1f9277e1ceb146e",
2023-03-14 20:22:21,070 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon-v.dat",
2023-03-14 20:22:21,071 - INFO - "md5sum": "9ed6ca61f164c3a1ddac82b3adb8e41f",
2023-03-14 20:22:21,071 - INFO - "remote_checksum": "0eecf027044a52ff57e87a1ef1f9277e1ceb146e",
2023-03-14 20:22:21,071 - INFO - "remote_md5sum": null
2023-03-14 20:22:21,071 - INFO - }
2023-03-14 20:22:22,151 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:22:22,151 - INFO - "changed": true,
2023-03-14 20:22:22,151 - INFO - "checksum": "553de59ae1f861c17499a345947edac24f5ef5e6",
2023-03-14 20:22:22,152 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon-M.dat",
2023-03-14 20:22:22,152 - INFO - "md5sum": "82b2e5d1d33c2feb6e5d5290b113dd3f",
2023-03-14 20:22:22,152 - INFO - "remote_checksum": "553de59ae1f861c17499a345947edac24f5ef5e6",
2023-03-14 20:22:22,152 - INFO - "remote_md5sum": null
2023-03-14 20:22:22,152 - INFO - }
2023-03-14 20:22:23,745 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:22:23,746 - INFO - "changed": true,
2023-03-14 20:22:23,746 - INFO - "checksum": "acd109e08980c16a4f6c807d7f02654a21f32082",
2023-03-14 20:22:23,746 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon.dat",
2023-03-14 20:22:23,746 - INFO - "md5sum": "b440fe73c40655402b4221b98ea44f64",
2023-03-14 20:22:23,746 - INFO - "remote_checksum": "acd109e08980c16a4f6c807d7f02654a21f32082",
2023-03-14 20:22:23,746 - INFO - "remote_md5sum": null
2023-03-14 20:22:23,746 - INFO - }
2023-03-14 20:22:23,845 - INFO - 2. fetch the matrics of ai_pipeline
2023-03-14 20:22:23,846 - INFO - 3.  collect the result
2023-03-14 20:22:24,004 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(rate(container_cpu_usage_seconds_total{namespace="default", container!=""}[2m])[2m:])
2023-03-14 20:22:24,004 - INFO - metric_name is: cpu_usage
2023-03-14 20:22:24,016 - INFO - result is: [{'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod37bfe08c_1a35_4f31_aee2_d3ed773045f6.slice/cri-containerd-32957fce66e8ca89850f6a363f2bad55c4c434f4dd10e8ee22d59409d4d63156.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '32957fce66e8ca89850f6a363f2bad55c4c434f4dd10e8ee22d59409d4d63156', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-06-59c94bd6dd-7fqpw', 'service': 'kubelet'}, 'value': [1678850544.003, '0.06738831666668071']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod443d56fd_7192_407b_aa7f_3a19c6164b35.slice/cri-containerd-8ef35ec5e997b42b467e9a537ce481f8b80255b055daf3b4d653e511cc959b79.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '8ef35ec5e997b42b467e9a537ce481f8b80255b055daf3b4d653e511cc959b79', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-02-59c94bd6dd-hf2k2', 'service': 'kubelet'}, 'value': [1678850544.003, '0.07212837500000104']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod5b20665e_1471_41e3_a906_37dbadf61ded.slice/cri-containerd-1903d9a29e2cc9280c983cf212ed426789dd4724ed212d8d6aaa692b7099b21d.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '1903d9a29e2cc9280c983cf212ed426789dd4724ed212d8d6aaa692b7099b21d', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-05-59c94bd6dd-2vw5v', 'service': 'kubelet'}, 'value': [1678850544.003, '0.06958133333335151']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podc1b02e88_e7c7_494d_b700_42e46c1f306d.slice/cri-containerd-8eb30a61e0cb53f9f0a8c0c18dc645c56eb3686a459ce4441c537113ae8007ae.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '8eb30a61e0cb53f9f0a8c0c18dc645c56eb3686a459ce4441c537113ae8007ae', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-04-59c94bd6dd-whjrf', 'service': 'kubelet'}, 'value': [1678850544.003, '0.07316803611110016']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podf0bbadd5_e728_4dc7_ac09_67de87ab9ed9.slice/cri-containerd-d2606d2272b90c545952113b692da741b7958b163650096e2f624aeee76293a8.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'd2606d2272b90c545952113b692da741b7958b163650096e2f624aeee76293a8', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-03-59c94bd6dd-57bn5', 'service': 'kubelet'}, 'value': [1678850544.003, '0.07442473333335833']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podf765b16c_07f8_4261_9b64_3517dc6bafb7.slice/cri-containerd-88d725ffe5a1ce389c7c711b044f1cbdd7b97a922268c6d9d0735d1ba203f048.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '88d725ffe5a1ce389c7c711b044f1cbdd7b97a922268c6d9d0735d1ba203f048', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-01-59c94bd6dd-n5rdt', 'service': 'kubelet'}, 'value': [1678850544.003, '0.07211072777776684']}, {'metric': {'container': 'ei-gws', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podaf221d52_33c6_40a0_b6bf_e5e2bc7b88db.slice/cri-containerd-870edc8724b46c501ca89d89b821712566f2c55b1d2077b638d4cbb0f32dcada.scope', 'image': 'ccr-registry.caas.intel.com/cnbench/ei-gateway-server:2022WW51-ws-8080', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '870edc8724b46c501ca89d89b821712566f2c55b1d2077b638d4cbb0f32dcada', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-gateway-server-deployment-694bf969dd-xhbg9', 'service': 'kubelet'}, 'value': [1678850544.003, '0.001167024999999613']}, {'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-burstable.slice/kubepods-burstable-poda4ccd870_7213_4e3f_a9a2_1ca4f1992c29.slice/cri-containerd-7c8b612bc099941f3a6e91c530c79f85e4a532a0078c3b9476152e8dd66f7c64.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-inference-service-tensorflow:2022WW49', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '7c8b612bc099941f3a6e91c530c79f85e4a532a0078c3b9476152e8dd66f7c64', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x', 'service': 'kubelet'}, 'value': [1678850544.003, '1.4134492']}, {'metric': {'container': 'ei-wss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podd781997c_c6e4_4a9a_8814_f1a5e364edb4.slice/cri-containerd-d43dd1ddebde49d8cd5407a60d348e56d9384fcda992f264ae9ca5887ba0ab87.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-websocket-server:2022WW51', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'd43dd1ddebde49d8cd5407a60d348e56d9384fcda992f264ae9ca5887ba0ab87', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-websocket-server-deployment-b4f68d987-95vnz', 'service': 'kubelet'}, 'value': [1678850544.003, '0.009982900000002497']}, {'metric': {'container': 'nfs-subdir-external-provisioner', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod008ca2f8_cd34_4bb5_9e75_b46ec5ce9a23.slice/cri-containerd-710ae0fcfaef79b8c1cbf5871a10727a0da4ef1ca22a1fd9e475a740588b43e4.scope', 'image': 'k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '710ae0fcfaef79b8c1cbf5871a10727a0da4ef1ca22a1fd9e475a740588b43e4', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'nfs-subdir-external-provisioner-6f66496f8f-529tg', 'service': 'kubelet'}, 'value': [1678850544.003, '0.0009606611111103626']}, {'metric': {'container': 'redis', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod0d8f249f_8e44_4dae_82d3_618b15befd15.slice/cri-containerd-0d39607a911d680151ccaee4e31a4eeb21acbade8e1a9eb7cd5377c4796e012e.scope', 'image': 'docker.io/library/redis:6.0', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '0d39607a911d680151ccaee4e31a4eeb21acbade8e1a9eb7cd5377c4796e012e', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-redis-deployment-68df56c9d5-9kt42', 'service': 'kubelet'}, 'value': [1678850544.003, '0.014377594444441557']}, {'metric': {'container': 'tmp-shell', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod9cbe7477_0ea6_463d_8c1e_33eb5efda051.slice/cri-containerd-9093ed8c6f94ca6b98db8362a28e0ee47cc31e863e7c131462759af96d66c3e9.scope', 'image': 'docker.io/nicolaka/netshoot:latest', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '9093ed8c6f94ca6b98db8362a28e0ee47cc31e863e7c131462759af96d66c3e9', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'tmp-shell', 'service': 'kubelet'}, 'value': [1678850544.003, '0']}]
2023-03-14 20:22:24,016 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=sum(container_memory_working_set_bytes{namespace="default",container!="", image!=""}) by (pod)
2023-03-14 20:22:24,016 - INFO - metric_name is: memory_usage
2023-03-14 20:22:24,016 - INFO - result is: [{'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-06-59c94bd6dd-7fqpw'}, 'value': [1678850544.007, '386166784']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-02-59c94bd6dd-hf2k2'}, 'value': [1678850544.007, '386433024']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-05-59c94bd6dd-2vw5v'}, 'value': [1678850544.007, '386445312']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-04-59c94bd6dd-whjrf'}, 'value': [1678850544.007, '386166784']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-03-59c94bd6dd-57bn5'}, 'value': [1678850544.007, '386498560']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-01-59c94bd6dd-n5rdt'}, 'value': [1678850544.007, '386002944']}, {'metric': {'pod': 'ei-gateway-server-deployment-694bf969dd-xhbg9'}, 'value': [1678850544.007, '56774656']}, {'metric': {'pod': 'ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x'}, 'value': [1678850544.007, '518868992']}, {'metric': {'pod': 'ei-websocket-server-deployment-b4f68d987-95vnz'}, 'value': [1678850544.007, '5093195776']}, {'metric': {'pod': 'nfs-subdir-external-provisioner-6f66496f8f-529tg'}, 'value': [1678850544.007, '15560704']}, {'metric': {'pod': 'ei-redis-deployment-68df56c9d5-9kt42'}, 'value': [1678850544.007, '2445393920']}, {'metric': {'pod': 'tmp-shell'}, 'value': [1678850544.007, '847872']}]
2023-03-14 20:22:24,016 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_infer_fps{namespace="default"}[2m])
2023-03-14 20:22:24,016 - INFO - metric_name is: ei_infer_fps
2023-03-14 20:22:24,017 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.58:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678850544.011, '104.72626220268259']}]
2023-03-14 20:22:24,017 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_drop_fps{namespace="default"}[2m])
2023-03-14 20:22:24,017 - INFO - metric_name is: ei_drop_fps
2023-03-14 20:22:24,017 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.58:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678850544.013, '65.2901492451687']}]
2023-03-14 20:22:24,017 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_scale_ratio{namespace="default"}[2m])
2023-03-14 20:22:24,017 - INFO - metric_name is: ei_scale_ratio
2023-03-14 20:22:24,017 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.58:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678850544.016, '1.6239697543442992']}]
2023-03-14 20:22:24,017 - INFO - Results written to metrics/E086_AMX_BF16_metrics_20230314_202224.txt
2023-03-14 20:22:24,085 - INFO - sleep 120 seconds for the next round ...
2023-03-14 20:24:24,088 - INFO - -----------loop num:3/3------------
2023-03-14 20:24:34,095 - INFO - 1.  fetch_emon.sh
2023-03-14 20:24:34,096 - INFO - pwd=/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon
2023-03-14 20:24:35,978 - INFO - 10.45.247.200 | SUCCESS => {
2023-03-14 20:24:35,979 - INFO - "ansible_facts": {
2023-03-14 20:24:35,979 - INFO - "discovered_interpreter_python": "/usr/bin/python3"
2023-03-14 20:24:35,979 - INFO - },
2023-03-14 20:24:35,979 - INFO - "changed": false,
2023-03-14 20:24:35,979 - INFO - "checksum": "1bb1c680bf42bce57bd33e9ee945d27bb8aeaafc",
2023-03-14 20:24:35,979 - INFO - "dest": "runemon.sh",
2023-03-14 20:24:35,979 - INFO - "gid": 1007,
2023-03-14 20:24:35,979 - INFO - "group": "ansible",
2023-03-14 20:24:35,980 - INFO - "mode": "0755",
2023-03-14 20:24:35,980 - INFO - "owner": "ansible",
2023-03-14 20:24:35,980 - INFO - "path": "runemon.sh",
2023-03-14 20:24:35,980 - INFO - "size": 452,
2023-03-14 20:24:35,980 - INFO - "state": "file",
2023-03-14 20:24:35,980 - INFO - "uid": 1006
2023-03-14 20:24:35,980 - INFO - }
2023-03-14 20:24:37,365 - INFO - 10.45.247.200 | SUCCESS => {
2023-03-14 20:24:37,366 - INFO - "ansible_facts": {
2023-03-14 20:24:37,366 - INFO - "discovered_interpreter_python": "/usr/bin/python3"
2023-03-14 20:24:37,366 - INFO - },
2023-03-14 20:24:37,366 - INFO - "changed": false,
2023-03-14 20:24:37,366 - INFO - "checksum": "0b7ce1d178a191ee4962273d5bcbcac8b825066d",
2023-03-14 20:24:37,366 - INFO - "dest": "sapphirerapids_server_events_private.txt",
2023-03-14 20:24:37,366 - INFO - "gid": 1007,
2023-03-14 20:24:37,366 - INFO - "group": "ansible",
2023-03-14 20:24:37,366 - INFO - "mode": "0664",
2023-03-14 20:24:37,366 - INFO - "owner": "ansible",
2023-03-14 20:24:37,366 - INFO - "path": "sapphirerapids_server_events_private.txt",
2023-03-14 20:24:37,367 - INFO - "size": 23423,
2023-03-14 20:24:37,367 - INFO - "state": "file",
2023-03-14 20:24:37,367 - INFO - "uid": 1006
2023-03-14 20:24:37,367 - INFO - }
2023-03-14 20:24:38,433 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:24:38,434 - INFO - 
2023-03-14 20:24:39,484 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:24:39,484 - INFO - 
2023-03-14 20:24:39,585 - INFO - Sleep 5 seconds then collect emon data for 30 seconds
2023-03-14 20:24:44,589 - INFO - Collecting 30 seconds sar data background
2023-03-14 20:24:46,557 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:24:46,558 - INFO - 
2023-03-14 20:24:48,612 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:24:48,613 - INFO - 
2023-03-14 20:24:50,662 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:24:50,663 - INFO - 
2023-03-14 20:24:52,715 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:24:52,716 - INFO - 
2023-03-14 20:24:52,818 - INFO - Collecting EMON data
2023-03-14 20:25:24,315 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:25:24,315 - INFO - Usage: sep_vars.sh [emon_api]
2023-03-14 20:25:24,315 - INFO - PATH=/opt/intel/sep/bin64:/opt/intel/sep/android_target:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin
2023-03-14 20:25:24,316 - INFO - CPATH=/opt/intel/sep/config/emon_api:
2023-03-14 20:25:24,316 - INFO - LIBRARY_PATH=/opt/intel/sep/lib64:
2023-03-14 20:25:24,316 - INFO - LD_LIBRARY_PATH=
2023-03-14 20:25:24,316 - INFO - SEP_BASE_DIR=/opt/intel/sep/bin64
2023-03-14 20:25:24,316 - INFO - SEP is currently installed under /opt/intel/sep/bin64
2023-03-14 20:25:24,316 - INFO - EMON collector successfully stopped.
2023-03-14 20:25:24,450 - INFO - Sleep another 30 seconds to make sure the previous run exit
2023-03-14 20:25:54,453 - INFO - Copy dat files
2023-03-14 20:25:55,469 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:25:55,469 - INFO - "changed": true,
2023-03-14 20:25:55,469 - INFO - "checksum": "227933b07c0a1b84c210e5d5ecda682d71097ae3",
2023-03-14 20:25:55,469 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/cpuutil.log",
2023-03-14 20:25:55,469 - INFO - "md5sum": "56098a8d5502e6e3dbee8256961b2fd2",
2023-03-14 20:25:55,469 - INFO - "remote_checksum": "227933b07c0a1b84c210e5d5ecda682d71097ae3",
2023-03-14 20:25:55,469 - INFO - "remote_md5sum": null
2023-03-14 20:25:55,469 - INFO - }
2023-03-14 20:25:56,567 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:25:56,568 - INFO - "changed": true,
2023-03-14 20:25:56,568 - INFO - "checksum": "996849a2c27f79eb4d4c0fd9e6f435537ac1c9fe",
2023-03-14 20:25:56,568 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/diskutil.log",
2023-03-14 20:25:56,568 - INFO - "md5sum": "c2564cee675f0688ce98876db44c0878",
2023-03-14 20:25:56,568 - INFO - "remote_checksum": "996849a2c27f79eb4d4c0fd9e6f435537ac1c9fe",
2023-03-14 20:25:56,568 - INFO - "remote_md5sum": null
2023-03-14 20:25:56,568 - INFO - }
2023-03-14 20:25:57,671 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:25:57,671 - INFO - "changed": true,
2023-03-14 20:25:57,672 - INFO - "checksum": "7ccc77c9cc316ef33f78ef72e45150de8f5d6d87",
2023-03-14 20:25:57,672 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/netutil.log",
2023-03-14 20:25:57,672 - INFO - "md5sum": "e2e0c247ede4b671b0e67e3d6cc9a5d5",
2023-03-14 20:25:57,672 - INFO - "remote_checksum": "7ccc77c9cc316ef33f78ef72e45150de8f5d6d87",
2023-03-14 20:25:57,672 - INFO - "remote_md5sum": null
2023-03-14 20:25:57,672 - INFO - }
2023-03-14 20:25:58,817 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:25:58,817 - INFO - "changed": true,
2023-03-14 20:25:58,817 - INFO - "checksum": "edbfedd2859c7c7c5bfd89403351be6010ddebcf",
2023-03-14 20:25:58,817 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/top.log",
2023-03-14 20:25:58,817 - INFO - "md5sum": "cc5e035cf3f9b1417de71e104d1c4054",
2023-03-14 20:25:58,817 - INFO - "remote_checksum": "edbfedd2859c7c7c5bfd89403351be6010ddebcf",
2023-03-14 20:25:58,817 - INFO - "remote_md5sum": null
2023-03-14 20:25:58,818 - INFO - }
2023-03-14 20:25:59,917 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:25:59,917 - INFO - "changed": true,
2023-03-14 20:25:59,917 - INFO - "checksum": "0eecf027044a52ff57e87a1ef1f9277e1ceb146e",
2023-03-14 20:25:59,917 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon-v.dat",
2023-03-14 20:25:59,918 - INFO - "md5sum": "9ed6ca61f164c3a1ddac82b3adb8e41f",
2023-03-14 20:25:59,918 - INFO - "remote_checksum": "0eecf027044a52ff57e87a1ef1f9277e1ceb146e",
2023-03-14 20:25:59,918 - INFO - "remote_md5sum": null
2023-03-14 20:25:59,918 - INFO - }
2023-03-14 20:26:01,034 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:26:01,034 - INFO - "changed": true,
2023-03-14 20:26:01,034 - INFO - "checksum": "553de59ae1f861c17499a345947edac24f5ef5e6",
2023-03-14 20:26:01,035 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon-M.dat",
2023-03-14 20:26:01,035 - INFO - "md5sum": "82b2e5d1d33c2feb6e5d5290b113dd3f",
2023-03-14 20:26:01,035 - INFO - "remote_checksum": "553de59ae1f861c17499a345947edac24f5ef5e6",
2023-03-14 20:26:01,035 - INFO - "remote_md5sum": null
2023-03-14 20:26:01,035 - INFO - }
2023-03-14 20:26:02,626 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:26:02,626 - INFO - "changed": true,
2023-03-14 20:26:02,626 - INFO - "checksum": "7103a9bc63ad4efff60f39ac5c3be9e1c981aaf0",
2023-03-14 20:26:02,626 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon.dat",
2023-03-14 20:26:02,626 - INFO - "md5sum": "c85da5f85a1aa964d00b5f9c9fc04623",
2023-03-14 20:26:02,626 - INFO - "remote_checksum": "7103a9bc63ad4efff60f39ac5c3be9e1c981aaf0",
2023-03-14 20:26:02,626 - INFO - "remote_md5sum": null
2023-03-14 20:26:02,627 - INFO - }
2023-03-14 20:26:02,726 - INFO - 2. fetch the matrics of ai_pipeline
2023-03-14 20:26:02,726 - INFO - 3.  collect the result
2023-03-14 20:26:02,885 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(rate(container_cpu_usage_seconds_total{namespace="default", container!=""}[2m])[2m:])
2023-03-14 20:26:02,886 - INFO - metric_name is: cpu_usage
2023-03-14 20:26:02,900 - INFO - result is: [{'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod37bfe08c_1a35_4f31_aee2_d3ed773045f6.slice/cri-containerd-32957fce66e8ca89850f6a363f2bad55c4c434f4dd10e8ee22d59409d4d63156.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '32957fce66e8ca89850f6a363f2bad55c4c434f4dd10e8ee22d59409d4d63156', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-06-59c94bd6dd-7fqpw', 'service': 'kubelet'}, 'value': [1678850762.885, '0.07000083611110312']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod443d56fd_7192_407b_aa7f_3a19c6164b35.slice/cri-containerd-8ef35ec5e997b42b467e9a537ce481f8b80255b055daf3b4d653e511cc959b79.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '8ef35ec5e997b42b467e9a537ce481f8b80255b055daf3b4d653e511cc959b79', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-02-59c94bd6dd-hf2k2', 'service': 'kubelet'}, 'value': [1678850762.885, '0.0713696333333347']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod5b20665e_1471_41e3_a906_37dbadf61ded.slice/cri-containerd-1903d9a29e2cc9280c983cf212ed426789dd4724ed212d8d6aaa692b7099b21d.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '1903d9a29e2cc9280c983cf212ed426789dd4724ed212d8d6aaa692b7099b21d', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-05-59c94bd6dd-2vw5v', 'service': 'kubelet'}, 'value': [1678850762.885, '0.06400677499999195']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podc1b02e88_e7c7_494d_b700_42e46c1f306d.slice/cri-containerd-8eb30a61e0cb53f9f0a8c0c18dc645c56eb3686a459ce4441c537113ae8007ae.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '8eb30a61e0cb53f9f0a8c0c18dc645c56eb3686a459ce4441c537113ae8007ae', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-04-59c94bd6dd-whjrf', 'service': 'kubelet'}, 'value': [1678850762.885, '0.06458860833334053']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podf0bbadd5_e728_4dc7_ac09_67de87ab9ed9.slice/cri-containerd-d2606d2272b90c545952113b692da741b7958b163650096e2f624aeee76293a8.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'd2606d2272b90c545952113b692da741b7958b163650096e2f624aeee76293a8', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-03-59c94bd6dd-57bn5', 'service': 'kubelet'}, 'value': [1678850762.885, '0.07368500833332897']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podf765b16c_07f8_4261_9b64_3517dc6bafb7.slice/cri-containerd-88d725ffe5a1ce389c7c711b044f1cbdd7b97a922268c6d9d0735d1ba203f048.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '88d725ffe5a1ce389c7c711b044f1cbdd7b97a922268c6d9d0735d1ba203f048', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-01-59c94bd6dd-n5rdt', 'service': 'kubelet'}, 'value': [1678850762.885, '0.07280135833332477']}, {'metric': {'container': 'ei-gws', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podaf221d52_33c6_40a0_b6bf_e5e2bc7b88db.slice/cri-containerd-870edc8724b46c501ca89d89b821712566f2c55b1d2077b638d4cbb0f32dcada.scope', 'image': 'ccr-registry.caas.intel.com/cnbench/ei-gateway-server:2022WW51-ws-8080', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '870edc8724b46c501ca89d89b821712566f2c55b1d2077b638d4cbb0f32dcada', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-gateway-server-deployment-694bf969dd-xhbg9', 'service': 'kubelet'}, 'value': [1678850762.885, '0.0012074861111108879']}, {'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-burstable.slice/kubepods-burstable-poda4ccd870_7213_4e3f_a9a2_1ca4f1992c29.slice/cri-containerd-7c8b612bc099941f3a6e91c530c79f85e4a532a0078c3b9476152e8dd66f7c64.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-inference-service-tensorflow:2022WW49', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '7c8b612bc099941f3a6e91c530c79f85e4a532a0078c3b9476152e8dd66f7c64', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x', 'service': 'kubelet'}, 'value': [1678850762.885, '1.420355055555556']}, {'metric': {'container': 'ei-wss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podd781997c_c6e4_4a9a_8814_f1a5e364edb4.slice/cri-containerd-d43dd1ddebde49d8cd5407a60d348e56d9384fcda992f264ae9ca5887ba0ab87.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-websocket-server:2022WW51', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'd43dd1ddebde49d8cd5407a60d348e56d9384fcda992f264ae9ca5887ba0ab87', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-websocket-server-deployment-b4f68d987-95vnz', 'service': 'kubelet'}, 'value': [1678850762.885, '0.009621277777776209']}, {'metric': {'container': 'nfs-subdir-external-provisioner', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod008ca2f8_cd34_4bb5_9e75_b46ec5ce9a23.slice/cri-containerd-710ae0fcfaef79b8c1cbf5871a10727a0da4ef1ca22a1fd9e475a740588b43e4.scope', 'image': 'k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '710ae0fcfaef79b8c1cbf5871a10727a0da4ef1ca22a1fd9e475a740588b43e4', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'nfs-subdir-external-provisioner-6f66496f8f-529tg', 'service': 'kubelet'}, 'value': [1678850762.885, '0.0010892027777774475']}, {'metric': {'container': 'redis', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod0d8f249f_8e44_4dae_82d3_618b15befd15.slice/cri-containerd-0d39607a911d680151ccaee4e31a4eeb21acbade8e1a9eb7cd5377c4796e012e.scope', 'image': 'docker.io/library/redis:6.0', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '0d39607a911d680151ccaee4e31a4eeb21acbade8e1a9eb7cd5377c4796e012e', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-redis-deployment-68df56c9d5-9kt42', 'service': 'kubelet'}, 'value': [1678850762.885, '0.013762163888895883']}, {'metric': {'container': 'tmp-shell', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod9cbe7477_0ea6_463d_8c1e_33eb5efda051.slice/cri-containerd-9093ed8c6f94ca6b98db8362a28e0ee47cc31e863e7c131462759af96d66c3e9.scope', 'image': 'docker.io/nicolaka/netshoot:latest', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '9093ed8c6f94ca6b98db8362a28e0ee47cc31e863e7c131462759af96d66c3e9', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'tmp-shell', 'service': 'kubelet'}, 'value': [1678850762.885, '0']}]
2023-03-14 20:26:02,900 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=sum(container_memory_working_set_bytes{namespace="default",container!="", image!=""}) by (pod)
2023-03-14 20:26:02,901 - INFO - metric_name is: memory_usage
2023-03-14 20:26:02,901 - INFO - result is: [{'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-06-59c94bd6dd-7fqpw'}, 'value': [1678850762.889, '386162688']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-02-59c94bd6dd-hf2k2'}, 'value': [1678850762.889, '386564096']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-05-59c94bd6dd-2vw5v'}, 'value': [1678850762.889, '386445312']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-04-59c94bd6dd-whjrf'}, 'value': [1678850762.889, '386318336']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-03-59c94bd6dd-57bn5'}, 'value': [1678850762.889, '386498560']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-01-59c94bd6dd-n5rdt'}, 'value': [1678850762.889, '386002944']}, {'metric': {'pod': 'ei-gateway-server-deployment-694bf969dd-xhbg9'}, 'value': [1678850762.889, '56774656']}, {'metric': {'pod': 'ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x'}, 'value': [1678850762.889, '518873088']}, {'metric': {'pod': 'ei-websocket-server-deployment-b4f68d987-95vnz'}, 'value': [1678850762.889, '5093195776']}, {'metric': {'pod': 'nfs-subdir-external-provisioner-6f66496f8f-529tg'}, 'value': [1678850762.889, '15294464']}, {'metric': {'pod': 'ei-redis-deployment-68df56c9d5-9kt42'}, 'value': [1678850762.889, '2445451264']}, {'metric': {'pod': 'tmp-shell'}, 'value': [1678850762.889, '847872']}]
2023-03-14 20:26:02,901 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_infer_fps{namespace="default"}[2m])
2023-03-14 20:26:02,901 - INFO - metric_name is: ei_infer_fps
2023-03-14 20:26:02,901 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.58:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678850762.893, '105.50079164644461']}]
2023-03-14 20:26:02,901 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_drop_fps{namespace="default"}[2m])
2023-03-14 20:26:02,901 - INFO - metric_name is: ei_drop_fps
2023-03-14 20:26:02,901 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.58:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678850762.897, '64.66519450516387']}]
2023-03-14 20:26:02,901 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_scale_ratio{namespace="default"}[2m])
2023-03-14 20:26:02,901 - INFO - metric_name is: ei_scale_ratio
2023-03-14 20:26:02,901 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.58:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678850762.9, '1.6131758015284836']}]
2023-03-14 20:26:02,901 - INFO - Results written to metrics/E086_AMX_BF16_metrics_20230314_202602.txt
2023-03-14 20:26:02,967 - INFO - ------------- scenario: 2/5 ------------
2023-03-14 20:26:02,967 - INFO - Begin set_deployment_env of scenario : NON_AMX_BF16 ...
2023-03-14 20:26:03,020 - INFO - Setting environment variables for scenario NON_AMX_BF16...
2023-03-14 20:26:03,041 - INFO - Setting resource requests and limits for scenario NON_AMX_BF16...
2023-03-14 20:26:03,060 - INFO - after patch_body wait for 30 seconds to enable the new pods
2023-03-14 20:26:33,091 - INFO - Waiting for 1 pods to be ready for scenario NON_AMX_BF16...
2023-03-14 20:26:33,171 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9 status:Pending
2023-03-14 20:26:33,171 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Running
2023-03-14 20:26:33,171 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_AMX_BF16. Elapsed time: 0.08 seconds
2023-03-14 20:26:43,200 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9 status:Pending
2023-03-14 20:26:43,201 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Running
2023-03-14 20:26:43,201 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_AMX_BF16. Elapsed time: 10.11 seconds
2023-03-14 20:26:53,234 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9 status:Pending
2023-03-14 20:26:53,235 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Running
2023-03-14 20:26:53,235 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_AMX_BF16. Elapsed time: 20.14 seconds
2023-03-14 20:27:03,272 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9 status:Pending
2023-03-14 20:27:03,272 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Running
2023-03-14 20:27:03,272 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_AMX_BF16. Elapsed time: 30.18 seconds
2023-03-14 20:27:13,339 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9 status:Pending
2023-03-14 20:27:13,339 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Running
2023-03-14 20:27:13,339 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_AMX_BF16. Elapsed time: 40.25 seconds
2023-03-14 20:27:23,376 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9 status:Pending
2023-03-14 20:27:23,377 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Running
2023-03-14 20:27:23,377 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_AMX_BF16. Elapsed time: 50.29 seconds
2023-03-14 20:27:33,414 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9 status:Pending
2023-03-14 20:27:33,414 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Running
2023-03-14 20:27:33,414 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_AMX_BF16. Elapsed time: 60.32 seconds
2023-03-14 20:27:43,450 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9 status:Pending
2023-03-14 20:27:43,450 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Running
2023-03-14 20:27:43,450 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_AMX_BF16. Elapsed time: 70.36 seconds
2023-03-14 20:27:53,487 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9 status:Pending
2023-03-14 20:27:53,487 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Running
2023-03-14 20:27:53,487 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_AMX_BF16. Elapsed time: 80.40 seconds
2023-03-14 20:28:03,523 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9 status:Pending
2023-03-14 20:28:03,524 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Running
2023-03-14 20:28:03,524 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_AMX_BF16. Elapsed time: 90.43 seconds
2023-03-14 20:28:13,559 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9 status:Pending
2023-03-14 20:28:13,560 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Running
2023-03-14 20:28:13,560 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_AMX_BF16. Elapsed time: 100.47 seconds
2023-03-14 20:28:23,595 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9 status:Pending
2023-03-14 20:28:23,596 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Running
2023-03-14 20:28:23,596 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_AMX_BF16. Elapsed time: 110.50 seconds
2023-03-14 20:28:33,633 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9 status:Pending
2023-03-14 20:28:33,633 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Running
2023-03-14 20:28:33,633 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_AMX_BF16. Elapsed time: 120.54 seconds
2023-03-14 20:28:43,669 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9 status:Pending
2023-03-14 20:28:43,670 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Running
2023-03-14 20:28:43,670 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_AMX_BF16. Elapsed time: 130.58 seconds
2023-03-14 20:28:53,706 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9 status:Pending
2023-03-14 20:28:53,706 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Running
2023-03-14 20:28:53,706 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_AMX_BF16. Elapsed time: 140.61 seconds
2023-03-14 20:29:03,741 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9 status:Pending
2023-03-14 20:29:03,741 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Running
2023-03-14 20:29:03,741 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_AMX_BF16. Elapsed time: 150.65 seconds
2023-03-14 20:29:13,777 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9 status:Pending
2023-03-14 20:29:13,778 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Running
2023-03-14 20:29:13,778 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_AMX_BF16. Elapsed time: 160.69 seconds
2023-03-14 20:29:23,815 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9 status:Pending
2023-03-14 20:29:23,816 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Running
2023-03-14 20:29:23,816 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_AMX_BF16. Elapsed time: 170.72 seconds
2023-03-14 20:29:33,852 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9 status:Pending
2023-03-14 20:29:33,852 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Running
2023-03-14 20:29:33,852 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_AMX_BF16. Elapsed time: 180.76 seconds
2023-03-14 20:29:43,888 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9 status:Pending
2023-03-14 20:29:43,888 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Running
2023-03-14 20:29:43,889 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_AMX_BF16. Elapsed time: 190.80 seconds
2023-03-14 20:29:53,924 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9 status:Pending
2023-03-14 20:29:53,925 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Running
2023-03-14 20:29:53,925 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_AMX_BF16. Elapsed time: 200.83 seconds
2023-03-14 20:30:03,961 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9 status:Pending
2023-03-14 20:30:03,961 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-c8864fcfc-4rb4x status:Running
2023-03-14 20:30:03,962 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_AMX_BF16. Elapsed time: 210.87 seconds
2023-03-14 20:30:13,992 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9 status:Running
2023-03-14 20:30:13,992 - INFO - All 1 pods are ready for scenario NON_AMX_BF16
2023-03-14 20:30:13,994 - INFO - Finished scenario NON_AMX_BF16
2023-03-14 20:30:13,994 - INFO - wait for 2m to get stable metrics ...
2023-03-14 20:32:14,093 - INFO - Running benchmarking script for scenario NON_AMX_BF16...
2023-03-14 20:32:14,106 - INFO - TS=20230314203214
2023-03-14 20:32:16,081 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:32:16,082 - INFO - Reading package lists...
2023-03-14 20:32:16,082 - INFO - Building dependency tree...
2023-03-14 20:32:16,082 - INFO - Reading state information...
2023-03-14 20:32:16,082 - INFO - linux-tools-5.15.0-60-generic is already the newest version (5.15.0-60.66).
2023-03-14 20:32:16,082 - INFO - sysstat is already the newest version (12.5.2-2ubuntu0.1).
2023-03-14 20:32:16,082 - INFO - The following packages were automatically installed and are no longer required:
2023-03-14 20:32:16,082 - INFO - cgroupfs-mount libltdl7 pigz
2023-03-14 20:32:16,082 - INFO - Use 'sudo apt autoremove' to remove them.
2023-03-14 20:32:16,082 - INFO - 0 upgraded, 0 newly installed, 0 to remove and 44 not upgraded.
2023-03-14 20:32:16,082 - INFO - WARNING: apt does not have a stable CLI interface. Use with caution in scripts.
2023-03-14 20:32:16,963 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:32:16,964 - INFO - 
2023-03-14 20:32:18,006 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:32:18,006 - INFO - performance
2023-03-14 20:32:18,103 - INFO - Run on test AiPipeline_20230314203214_E086_NON_AMX_BF16_6
2023-03-14 20:32:18,104 - INFO - TT=AiPipeline_20230314203214_E086_NON_AMX_BF16_6,WRKDIR=/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon
2023-03-14 20:32:18,108 - INFO - -----------loop num:1/3------------
2023-03-14 20:32:28,113 - INFO - 1.  fetch_emon.sh
2023-03-14 20:32:28,115 - INFO - pwd=/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon
2023-03-14 20:32:29,420 - INFO - 10.45.247.200 | SUCCESS => {
2023-03-14 20:32:29,421 - INFO - "ansible_facts": {
2023-03-14 20:32:29,421 - INFO - "discovered_interpreter_python": "/usr/bin/python3"
2023-03-14 20:32:29,421 - INFO - },
2023-03-14 20:32:29,421 - INFO - "changed": false,
2023-03-14 20:32:29,421 - INFO - "checksum": "1bb1c680bf42bce57bd33e9ee945d27bb8aeaafc",
2023-03-14 20:32:29,421 - INFO - "dest": "runemon.sh",
2023-03-14 20:32:29,421 - INFO - "gid": 1007,
2023-03-14 20:32:29,421 - INFO - "group": "ansible",
2023-03-14 20:32:29,421 - INFO - "mode": "0755",
2023-03-14 20:32:29,421 - INFO - "owner": "ansible",
2023-03-14 20:32:29,421 - INFO - "path": "runemon.sh",
2023-03-14 20:32:29,421 - INFO - "size": 452,
2023-03-14 20:32:29,421 - INFO - "state": "file",
2023-03-14 20:32:29,422 - INFO - "uid": 1006
2023-03-14 20:32:29,422 - INFO - }
2023-03-14 20:32:30,871 - INFO - 10.45.247.200 | SUCCESS => {
2023-03-14 20:32:30,871 - INFO - "ansible_facts": {
2023-03-14 20:32:30,872 - INFO - "discovered_interpreter_python": "/usr/bin/python3"
2023-03-14 20:32:30,872 - INFO - },
2023-03-14 20:32:30,872 - INFO - "changed": false,
2023-03-14 20:32:30,872 - INFO - "checksum": "0b7ce1d178a191ee4962273d5bcbcac8b825066d",
2023-03-14 20:32:30,872 - INFO - "dest": "sapphirerapids_server_events_private.txt",
2023-03-14 20:32:30,872 - INFO - "gid": 1007,
2023-03-14 20:32:30,872 - INFO - "group": "ansible",
2023-03-14 20:32:30,872 - INFO - "mode": "0664",
2023-03-14 20:32:30,872 - INFO - "owner": "ansible",
2023-03-14 20:32:30,872 - INFO - "path": "sapphirerapids_server_events_private.txt",
2023-03-14 20:32:30,872 - INFO - "size": 23423,
2023-03-14 20:32:30,872 - INFO - "state": "file",
2023-03-14 20:32:30,872 - INFO - "uid": 1006
2023-03-14 20:32:30,873 - INFO - }
2023-03-14 20:32:31,944 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:32:31,944 - INFO - 
2023-03-14 20:32:32,999 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:32:32,999 - INFO - 
2023-03-14 20:32:33,097 - INFO - Sleep 5 seconds then collect emon data for 30 seconds
2023-03-14 20:32:38,101 - INFO - Collecting 30 seconds sar data background
2023-03-14 20:32:40,067 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:32:40,067 - INFO - 
2023-03-14 20:32:42,114 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:32:42,114 - INFO - 
2023-03-14 20:32:44,164 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:32:44,164 - INFO - 
2023-03-14 20:32:46,238 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:32:46,239 - INFO - 
2023-03-14 20:32:46,332 - INFO - Collecting EMON data
2023-03-14 20:33:17,917 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:33:17,917 - INFO - Usage: sep_vars.sh [emon_api]
2023-03-14 20:33:17,917 - INFO - PATH=/opt/intel/sep/bin64:/opt/intel/sep/android_target:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin
2023-03-14 20:33:17,917 - INFO - CPATH=/opt/intel/sep/config/emon_api:
2023-03-14 20:33:17,917 - INFO - LIBRARY_PATH=/opt/intel/sep/lib64:
2023-03-14 20:33:17,918 - INFO - LD_LIBRARY_PATH=
2023-03-14 20:33:17,918 - INFO - SEP_BASE_DIR=/opt/intel/sep/bin64
2023-03-14 20:33:17,918 - INFO - SEP is currently installed under /opt/intel/sep/bin64
2023-03-14 20:33:17,918 - INFO - EMON collector successfully stopped.
2023-03-14 20:33:18,024 - INFO - Sleep another 30 seconds to make sure the previous run exit
2023-03-14 20:33:48,027 - INFO - Copy dat files
2023-03-14 20:33:49,047 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:33:49,047 - INFO - "changed": true,
2023-03-14 20:33:49,048 - INFO - "checksum": "282810f4b8f4532b4fbaffcebd3cd56591f30220",
2023-03-14 20:33:49,048 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/cpuutil.log",
2023-03-14 20:33:49,048 - INFO - "md5sum": "d4f723b0cfeec8afcae2f756435c0330",
2023-03-14 20:33:49,048 - INFO - "remote_checksum": "282810f4b8f4532b4fbaffcebd3cd56591f30220",
2023-03-14 20:33:49,048 - INFO - "remote_md5sum": null
2023-03-14 20:33:49,048 - INFO - }
2023-03-14 20:33:50,145 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:33:50,146 - INFO - "changed": true,
2023-03-14 20:33:50,146 - INFO - "checksum": "687ccf2595a8b921038bcf68241971c05513e3e0",
2023-03-14 20:33:50,146 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/diskutil.log",
2023-03-14 20:33:50,146 - INFO - "md5sum": "834c58841278ee75cbc8c4fa882886a0",
2023-03-14 20:33:50,146 - INFO - "remote_checksum": "687ccf2595a8b921038bcf68241971c05513e3e0",
2023-03-14 20:33:50,146 - INFO - "remote_md5sum": null
2023-03-14 20:33:50,146 - INFO - }
2023-03-14 20:33:51,251 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:33:51,252 - INFO - "changed": true,
2023-03-14 20:33:51,252 - INFO - "checksum": "5eaae43db26379d827116ac50b496a210d4f42fc",
2023-03-14 20:33:51,252 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/netutil.log",
2023-03-14 20:33:51,252 - INFO - "md5sum": "56b6f49494604e320e4b667fcb2b02a4",
2023-03-14 20:33:51,252 - INFO - "remote_checksum": "5eaae43db26379d827116ac50b496a210d4f42fc",
2023-03-14 20:33:51,252 - INFO - "remote_md5sum": null
2023-03-14 20:33:51,252 - INFO - }
2023-03-14 20:33:52,394 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:33:52,394 - INFO - "changed": true,
2023-03-14 20:33:52,394 - INFO - "checksum": "366f60dae78af5efba6b25f4c9cfdbfbd710206c",
2023-03-14 20:33:52,395 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/top.log",
2023-03-14 20:33:52,395 - INFO - "md5sum": "77c6197d7e23beb91a3b158b6eaf5d52",
2023-03-14 20:33:52,395 - INFO - "remote_checksum": "366f60dae78af5efba6b25f4c9cfdbfbd710206c",
2023-03-14 20:33:52,395 - INFO - "remote_md5sum": null
2023-03-14 20:33:52,395 - INFO - }
2023-03-14 20:33:53,582 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:33:53,583 - INFO - "changed": true,
2023-03-14 20:33:53,583 - INFO - "checksum": "0eecf027044a52ff57e87a1ef1f9277e1ceb146e",
2023-03-14 20:33:53,583 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon-v.dat",
2023-03-14 20:33:53,583 - INFO - "md5sum": "9ed6ca61f164c3a1ddac82b3adb8e41f",
2023-03-14 20:33:53,583 - INFO - "remote_checksum": "0eecf027044a52ff57e87a1ef1f9277e1ceb146e",
2023-03-14 20:33:53,583 - INFO - "remote_md5sum": null
2023-03-14 20:33:53,583 - INFO - }
2023-03-14 20:33:54,705 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:33:54,705 - INFO - "changed": true,
2023-03-14 20:33:54,705 - INFO - "checksum": "553de59ae1f861c17499a345947edac24f5ef5e6",
2023-03-14 20:33:54,705 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon-M.dat",
2023-03-14 20:33:54,706 - INFO - "md5sum": "82b2e5d1d33c2feb6e5d5290b113dd3f",
2023-03-14 20:33:54,706 - INFO - "remote_checksum": "553de59ae1f861c17499a345947edac24f5ef5e6",
2023-03-14 20:33:54,706 - INFO - "remote_md5sum": null
2023-03-14 20:33:54,706 - INFO - }
2023-03-14 20:33:56,298 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:33:56,298 - INFO - "changed": true,
2023-03-14 20:33:56,299 - INFO - "checksum": "736455d34c805645075a299c406a328c55c416c0",
2023-03-14 20:33:56,299 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon.dat",
2023-03-14 20:33:56,299 - INFO - "md5sum": "a725429c61e3c4575605864bb0d278a9",
2023-03-14 20:33:56,299 - INFO - "remote_checksum": "736455d34c805645075a299c406a328c55c416c0",
2023-03-14 20:33:56,299 - INFO - "remote_md5sum": null
2023-03-14 20:33:56,299 - INFO - }
2023-03-14 20:33:56,398 - INFO - 2. fetch the matrics of ai_pipeline
2023-03-14 20:33:56,398 - INFO - 3.  collect the result
2023-03-14 20:33:56,560 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(rate(container_cpu_usage_seconds_total{namespace="default", container!=""}[2m])[2m:])
2023-03-14 20:33:56,560 - INFO - metric_name is: cpu_usage
2023-03-14 20:33:56,574 - INFO - result is: [{'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod37bfe08c_1a35_4f31_aee2_d3ed773045f6.slice/cri-containerd-32957fce66e8ca89850f6a363f2bad55c4c434f4dd10e8ee22d59409d4d63156.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '32957fce66e8ca89850f6a363f2bad55c4c434f4dd10e8ee22d59409d4d63156', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-06-59c94bd6dd-7fqpw', 'service': 'kubelet'}, 'value': [1678851236.56, '0.07381984444447072']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod443d56fd_7192_407b_aa7f_3a19c6164b35.slice/cri-containerd-8ef35ec5e997b42b467e9a537ce481f8b80255b055daf3b4d653e511cc959b79.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '8ef35ec5e997b42b467e9a537ce481f8b80255b055daf3b4d653e511cc959b79', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-02-59c94bd6dd-hf2k2', 'service': 'kubelet'}, 'value': [1678851236.56, '0.0736121666666602']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod5b20665e_1471_41e3_a906_37dbadf61ded.slice/cri-containerd-1903d9a29e2cc9280c983cf212ed426789dd4724ed212d8d6aaa692b7099b21d.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '1903d9a29e2cc9280c983cf212ed426789dd4724ed212d8d6aaa692b7099b21d', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-05-59c94bd6dd-2vw5v', 'service': 'kubelet'}, 'value': [1678851236.56, '0.06942648055555764']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podc1b02e88_e7c7_494d_b700_42e46c1f306d.slice/cri-containerd-8eb30a61e0cb53f9f0a8c0c18dc645c56eb3686a459ce4441c537113ae8007ae.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '8eb30a61e0cb53f9f0a8c0c18dc645c56eb3686a459ce4441c537113ae8007ae', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-04-59c94bd6dd-whjrf', 'service': 'kubelet'}, 'value': [1678851236.56, '0.06866905555555908']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podf0bbadd5_e728_4dc7_ac09_67de87ab9ed9.slice/cri-containerd-d2606d2272b90c545952113b692da741b7958b163650096e2f624aeee76293a8.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'd2606d2272b90c545952113b692da741b7958b163650096e2f624aeee76293a8', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-03-59c94bd6dd-57bn5', 'service': 'kubelet'}, 'value': [1678851236.56, '0.07098536944445691']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podf765b16c_07f8_4261_9b64_3517dc6bafb7.slice/cri-containerd-88d725ffe5a1ce389c7c711b044f1cbdd7b97a922268c6d9d0735d1ba203f048.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '88d725ffe5a1ce389c7c711b044f1cbdd7b97a922268c6d9d0735d1ba203f048', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-01-59c94bd6dd-n5rdt', 'service': 'kubelet'}, 'value': [1678851236.56, '0.07409686111111821']}, {'metric': {'container': 'ei-gws', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podaf221d52_33c6_40a0_b6bf_e5e2bc7b88db.slice/cri-containerd-870edc8724b46c501ca89d89b821712566f2c55b1d2077b638d4cbb0f32dcada.scope', 'image': 'ccr-registry.caas.intel.com/cnbench/ei-gateway-server:2022WW51-ws-8080', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '870edc8724b46c501ca89d89b821712566f2c55b1d2077b638d4cbb0f32dcada', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-gateway-server-deployment-694bf969dd-xhbg9', 'service': 'kubelet'}, 'value': [1678851236.56, '0.0010823916666664797']}, {'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-burstable.slice/kubepods-burstable-pod7c5c60f1_091a_4773_84dc_ffc0b6e9c14b.slice/cri-containerd-7e7eb669303b7c73e6c9301cb1dce84e7efa20fce7b6e3ac4d285baaf30b35ae.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-inference-service-tensorflow:2022WW49', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '7e7eb669303b7c73e6c9301cb1dce84e7efa20fce7b6e3ac4d285baaf30b35ae', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9', 'service': 'kubelet'}, 'value': [1678851236.56, '1.8028800720124074']}, {'metric': {'container': 'ei-wss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podd781997c_c6e4_4a9a_8814_f1a5e364edb4.slice/cri-containerd-d43dd1ddebde49d8cd5407a60d348e56d9384fcda992f264ae9ca5887ba0ab87.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-websocket-server:2022WW51', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'd43dd1ddebde49d8cd5407a60d348e56d9384fcda992f264ae9ca5887ba0ab87', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-websocket-server-deployment-b4f68d987-95vnz', 'service': 'kubelet'}, 'value': [1678851236.56, '0.00037088611110852474']}, {'metric': {'container': 'nfs-subdir-external-provisioner', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod008ca2f8_cd34_4bb5_9e75_b46ec5ce9a23.slice/cri-containerd-710ae0fcfaef79b8c1cbf5871a10727a0da4ef1ca22a1fd9e475a740588b43e4.scope', 'image': 'k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '710ae0fcfaef79b8c1cbf5871a10727a0da4ef1ca22a1fd9e475a740588b43e4', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'nfs-subdir-external-provisioner-6f66496f8f-529tg', 'service': 'kubelet'}, 'value': [1678851236.56, '0.00103142222222156']}, {'metric': {'container': 'redis', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod0d8f249f_8e44_4dae_82d3_618b15befd15.slice/cri-containerd-0d39607a911d680151ccaee4e31a4eeb21acbade8e1a9eb7cd5377c4796e012e.scope', 'image': 'docker.io/library/redis:6.0', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '0d39607a911d680151ccaee4e31a4eeb21acbade8e1a9eb7cd5377c4796e012e', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-redis-deployment-68df56c9d5-9kt42', 'service': 'kubelet'}, 'value': [1678851236.56, '0.009064913888889553']}, {'metric': {'container': 'tmp-shell', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod9cbe7477_0ea6_463d_8c1e_33eb5efda051.slice/cri-containerd-9093ed8c6f94ca6b98db8362a28e0ee47cc31e863e7c131462759af96d66c3e9.scope', 'image': 'docker.io/nicolaka/netshoot:latest', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '9093ed8c6f94ca6b98db8362a28e0ee47cc31e863e7c131462759af96d66c3e9', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'tmp-shell', 'service': 'kubelet'}, 'value': [1678851236.56, '0']}]
2023-03-14 20:33:56,575 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=sum(container_memory_working_set_bytes{namespace="default",container!="", image!=""}) by (pod)
2023-03-14 20:33:56,575 - INFO - metric_name is: memory_usage
2023-03-14 20:33:56,575 - INFO - result is: [{'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-06-59c94bd6dd-7fqpw'}, 'value': [1678851236.564, '386162688']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-02-59c94bd6dd-hf2k2'}, 'value': [1678851236.564, '386584576']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-05-59c94bd6dd-2vw5v'}, 'value': [1678851236.564, '386551808']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-04-59c94bd6dd-whjrf'}, 'value': [1678851236.564, '386420736']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-03-59c94bd6dd-57bn5'}, 'value': [1678851236.564, '386625536']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-01-59c94bd6dd-n5rdt'}, 'value': [1678851236.564, '386002944']}, {'metric': {'pod': 'ei-gateway-server-deployment-694bf969dd-xhbg9'}, 'value': [1678851236.564, '56774656']}, {'metric': {'pod': 'ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9'}, 'value': [1678851236.564, '538861568']}, {'metric': {'pod': 'ei-websocket-server-deployment-b4f68d987-95vnz'}, 'value': [1678851236.564, '5093171200']}, {'metric': {'pod': 'nfs-subdir-external-provisioner-6f66496f8f-529tg'}, 'value': [1678851236.564, '15171584']}, {'metric': {'pod': 'ei-redis-deployment-68df56c9d5-9kt42'}, 'value': [1678851236.564, '2450751488']}, {'metric': {'pod': 'tmp-shell'}, 'value': [1678851236.564, '847872']}]
2023-03-14 20:33:56,575 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_infer_fps{namespace="default"}[2m])
2023-03-14 20:33:56,575 - INFO - metric_name is: ei_infer_fps
2023-03-14 20:33:56,575 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.61:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678851236.568, '0.32259392799035114']}]
2023-03-14 20:33:56,576 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_drop_fps{namespace="default"}[2m])
2023-03-14 20:33:56,576 - INFO - metric_name is: ei_drop_fps
2023-03-14 20:33:56,576 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.61:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678851236.571, '170.0036920780809']}]
2023-03-14 20:33:56,576 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_scale_ratio{namespace="default"}[2m])
2023-03-14 20:33:56,576 - INFO - metric_name is: ei_scale_ratio
2023-03-14 20:33:56,576 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.61:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678851236.575, '533.4583333333334']}]
2023-03-14 20:33:56,576 - INFO - Results written to metrics/E086_NON_AMX_BF16_metrics_20230314_203356.txt
2023-03-14 20:33:56,644 - INFO - sleep 120 seconds for the next round ...
2023-03-14 20:35:56,648 - INFO - -----------loop num:2/3------------
2023-03-14 20:36:06,654 - INFO - 1.  fetch_emon.sh
2023-03-14 20:36:06,656 - INFO - pwd=/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon
2023-03-14 20:36:08,587 - INFO - 10.45.247.200 | SUCCESS => {
2023-03-14 20:36:08,588 - INFO - "ansible_facts": {
2023-03-14 20:36:08,588 - INFO - "discovered_interpreter_python": "/usr/bin/python3"
2023-03-14 20:36:08,588 - INFO - },
2023-03-14 20:36:08,588 - INFO - "changed": false,
2023-03-14 20:36:08,588 - INFO - "checksum": "1bb1c680bf42bce57bd33e9ee945d27bb8aeaafc",
2023-03-14 20:36:08,588 - INFO - "dest": "runemon.sh",
2023-03-14 20:36:08,588 - INFO - "gid": 1007,
2023-03-14 20:36:08,588 - INFO - "group": "ansible",
2023-03-14 20:36:08,588 - INFO - "mode": "0755",
2023-03-14 20:36:08,588 - INFO - "owner": "ansible",
2023-03-14 20:36:08,588 - INFO - "path": "runemon.sh",
2023-03-14 20:36:08,588 - INFO - "size": 452,
2023-03-14 20:36:08,589 - INFO - "state": "file",
2023-03-14 20:36:08,589 - INFO - "uid": 1006
2023-03-14 20:36:08,589 - INFO - }
2023-03-14 20:36:09,981 - INFO - 10.45.247.200 | SUCCESS => {
2023-03-14 20:36:09,981 - INFO - "ansible_facts": {
2023-03-14 20:36:09,981 - INFO - "discovered_interpreter_python": "/usr/bin/python3"
2023-03-14 20:36:09,981 - INFO - },
2023-03-14 20:36:09,981 - INFO - "changed": false,
2023-03-14 20:36:09,981 - INFO - "checksum": "0b7ce1d178a191ee4962273d5bcbcac8b825066d",
2023-03-14 20:36:09,982 - INFO - "dest": "sapphirerapids_server_events_private.txt",
2023-03-14 20:36:09,982 - INFO - "gid": 1007,
2023-03-14 20:36:09,982 - INFO - "group": "ansible",
2023-03-14 20:36:09,982 - INFO - "mode": "0664",
2023-03-14 20:36:09,982 - INFO - "owner": "ansible",
2023-03-14 20:36:09,982 - INFO - "path": "sapphirerapids_server_events_private.txt",
2023-03-14 20:36:09,982 - INFO - "size": 23423,
2023-03-14 20:36:09,982 - INFO - "state": "file",
2023-03-14 20:36:09,982 - INFO - "uid": 1006
2023-03-14 20:36:09,982 - INFO - }
2023-03-14 20:36:11,043 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:36:11,044 - INFO - 
2023-03-14 20:36:12,079 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:36:12,079 - INFO - 
2023-03-14 20:36:12,174 - INFO - Sleep 5 seconds then collect emon data for 30 seconds
2023-03-14 20:36:17,177 - INFO - Collecting 30 seconds sar data background
2023-03-14 20:36:19,142 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:36:19,142 - INFO - 
2023-03-14 20:36:21,187 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:36:21,187 - INFO - 
2023-03-14 20:36:23,247 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:36:23,248 - INFO - 
2023-03-14 20:36:25,299 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:36:25,299 - INFO - 
2023-03-14 20:36:25,398 - INFO - Collecting EMON data
2023-03-14 20:36:56,883 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:36:56,883 - INFO - Usage: sep_vars.sh [emon_api]
2023-03-14 20:36:56,883 - INFO - PATH=/opt/intel/sep/bin64:/opt/intel/sep/android_target:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin
2023-03-14 20:36:56,883 - INFO - CPATH=/opt/intel/sep/config/emon_api:
2023-03-14 20:36:56,883 - INFO - LIBRARY_PATH=/opt/intel/sep/lib64:
2023-03-14 20:36:56,883 - INFO - LD_LIBRARY_PATH=
2023-03-14 20:36:56,884 - INFO - SEP_BASE_DIR=/opt/intel/sep/bin64
2023-03-14 20:36:56,884 - INFO - SEP is currently installed under /opt/intel/sep/bin64
2023-03-14 20:36:56,884 - INFO - EMON collector successfully stopped.
2023-03-14 20:36:56,988 - INFO - Sleep another 30 seconds to make sure the previous run exit
2023-03-14 20:37:26,992 - INFO - Copy dat files
2023-03-14 20:37:28,004 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:37:28,005 - INFO - "changed": true,
2023-03-14 20:37:28,005 - INFO - "checksum": "76a448fb3cecbb7a7d99064a8f6f2731702a1f14",
2023-03-14 20:37:28,005 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/cpuutil.log",
2023-03-14 20:37:28,005 - INFO - "md5sum": "9684990ebfe6de1b2067eb832a8a2337",
2023-03-14 20:37:28,005 - INFO - "remote_checksum": "76a448fb3cecbb7a7d99064a8f6f2731702a1f14",
2023-03-14 20:37:28,005 - INFO - "remote_md5sum": null
2023-03-14 20:37:28,005 - INFO - }
2023-03-14 20:37:29,131 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:37:29,132 - INFO - "changed": true,
2023-03-14 20:37:29,132 - INFO - "checksum": "6518553bdd02063e457e0df5814f8b1b283abc0e",
2023-03-14 20:37:29,132 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/diskutil.log",
2023-03-14 20:37:29,132 - INFO - "md5sum": "af2293b97569c38f7326b763f9a36e50",
2023-03-14 20:37:29,132 - INFO - "remote_checksum": "6518553bdd02063e457e0df5814f8b1b283abc0e",
2023-03-14 20:37:29,132 - INFO - "remote_md5sum": null
2023-03-14 20:37:29,133 - INFO - }
2023-03-14 20:37:30,259 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:37:30,259 - INFO - "changed": true,
2023-03-14 20:37:30,259 - INFO - "checksum": "a807717809f03017a65ad139c234ed4a278c3f0c",
2023-03-14 20:37:30,259 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/netutil.log",
2023-03-14 20:37:30,259 - INFO - "md5sum": "ba8295c00871a37536bb3792124df31c",
2023-03-14 20:37:30,259 - INFO - "remote_checksum": "a807717809f03017a65ad139c234ed4a278c3f0c",
2023-03-14 20:37:30,259 - INFO - "remote_md5sum": null
2023-03-14 20:37:30,259 - INFO - }
2023-03-14 20:37:31,428 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:37:31,428 - INFO - "changed": true,
2023-03-14 20:37:31,429 - INFO - "checksum": "b71bf2de2c08d6db29c98ef100db75a96862574b",
2023-03-14 20:37:31,429 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/top.log",
2023-03-14 20:37:31,429 - INFO - "md5sum": "fdae14dd037d7225b8a0a6ef29483bf4",
2023-03-14 20:37:31,429 - INFO - "remote_checksum": "b71bf2de2c08d6db29c98ef100db75a96862574b",
2023-03-14 20:37:31,429 - INFO - "remote_md5sum": null
2023-03-14 20:37:31,429 - INFO - }
2023-03-14 20:37:32,526 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:37:32,527 - INFO - "changed": true,
2023-03-14 20:37:32,527 - INFO - "checksum": "0eecf027044a52ff57e87a1ef1f9277e1ceb146e",
2023-03-14 20:37:32,527 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon-v.dat",
2023-03-14 20:37:32,527 - INFO - "md5sum": "9ed6ca61f164c3a1ddac82b3adb8e41f",
2023-03-14 20:37:32,527 - INFO - "remote_checksum": "0eecf027044a52ff57e87a1ef1f9277e1ceb146e",
2023-03-14 20:37:32,527 - INFO - "remote_md5sum": null
2023-03-14 20:37:32,527 - INFO - }
2023-03-14 20:37:33,592 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:37:33,592 - INFO - "changed": true,
2023-03-14 20:37:33,592 - INFO - "checksum": "553de59ae1f861c17499a345947edac24f5ef5e6",
2023-03-14 20:37:33,593 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon-M.dat",
2023-03-14 20:37:33,593 - INFO - "md5sum": "82b2e5d1d33c2feb6e5d5290b113dd3f",
2023-03-14 20:37:33,593 - INFO - "remote_checksum": "553de59ae1f861c17499a345947edac24f5ef5e6",
2023-03-14 20:37:33,593 - INFO - "remote_md5sum": null
2023-03-14 20:37:33,593 - INFO - }
2023-03-14 20:37:35,218 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:37:35,218 - INFO - "changed": true,
2023-03-14 20:37:35,218 - INFO - "checksum": "95df053c5211869b3da52bcafeeed3bb251e1191",
2023-03-14 20:37:35,218 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon.dat",
2023-03-14 20:37:35,218 - INFO - "md5sum": "ff82dc663128e92a213d21f74ec5124f",
2023-03-14 20:37:35,218 - INFO - "remote_checksum": "95df053c5211869b3da52bcafeeed3bb251e1191",
2023-03-14 20:37:35,219 - INFO - "remote_md5sum": null
2023-03-14 20:37:35,219 - INFO - }
2023-03-14 20:37:35,322 - INFO - 2. fetch the matrics of ai_pipeline
2023-03-14 20:37:35,322 - INFO - 3.  collect the result
2023-03-14 20:37:35,479 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(rate(container_cpu_usage_seconds_total{namespace="default", container!=""}[2m])[2m:])
2023-03-14 20:37:35,479 - INFO - metric_name is: cpu_usage
2023-03-14 20:37:35,493 - INFO - result is: [{'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod37bfe08c_1a35_4f31_aee2_d3ed773045f6.slice/cri-containerd-32957fce66e8ca89850f6a363f2bad55c4c434f4dd10e8ee22d59409d4d63156.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '32957fce66e8ca89850f6a363f2bad55c4c434f4dd10e8ee22d59409d4d63156', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-06-59c94bd6dd-7fqpw', 'service': 'kubelet'}, 'value': [1678851455.479, '0.07702256666666976']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod443d56fd_7192_407b_aa7f_3a19c6164b35.slice/cri-containerd-8ef35ec5e997b42b467e9a537ce481f8b80255b055daf3b4d653e511cc959b79.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '8ef35ec5e997b42b467e9a537ce481f8b80255b055daf3b4d653e511cc959b79', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-02-59c94bd6dd-hf2k2', 'service': 'kubelet'}, 'value': [1678851455.479, '0.07194101111108465']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod5b20665e_1471_41e3_a906_37dbadf61ded.slice/cri-containerd-1903d9a29e2cc9280c983cf212ed426789dd4724ed212d8d6aaa692b7099b21d.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '1903d9a29e2cc9280c983cf212ed426789dd4724ed212d8d6aaa692b7099b21d', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-05-59c94bd6dd-2vw5v', 'service': 'kubelet'}, 'value': [1678851455.479, '0.07285992499999136']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podc1b02e88_e7c7_494d_b700_42e46c1f306d.slice/cri-containerd-8eb30a61e0cb53f9f0a8c0c18dc645c56eb3686a459ce4441c537113ae8007ae.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '8eb30a61e0cb53f9f0a8c0c18dc645c56eb3686a459ce4441c537113ae8007ae', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-04-59c94bd6dd-whjrf', 'service': 'kubelet'}, 'value': [1678851455.479, '0.07871123888889997']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podf0bbadd5_e728_4dc7_ac09_67de87ab9ed9.slice/cri-containerd-d2606d2272b90c545952113b692da741b7958b163650096e2f624aeee76293a8.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'd2606d2272b90c545952113b692da741b7958b163650096e2f624aeee76293a8', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-03-59c94bd6dd-57bn5', 'service': 'kubelet'}, 'value': [1678851455.479, '0.06959440277777401']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podf765b16c_07f8_4261_9b64_3517dc6bafb7.slice/cri-containerd-88d725ffe5a1ce389c7c711b044f1cbdd7b97a922268c6d9d0735d1ba203f048.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '88d725ffe5a1ce389c7c711b044f1cbdd7b97a922268c6d9d0735d1ba203f048', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-01-59c94bd6dd-n5rdt', 'service': 'kubelet'}, 'value': [1678851455.479, '0.07143805000002128']}, {'metric': {'container': 'ei-gws', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podaf221d52_33c6_40a0_b6bf_e5e2bc7b88db.slice/cri-containerd-870edc8724b46c501ca89d89b821712566f2c55b1d2077b638d4cbb0f32dcada.scope', 'image': 'ccr-registry.caas.intel.com/cnbench/ei-gateway-server:2022WW51-ws-8080', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '870edc8724b46c501ca89d89b821712566f2c55b1d2077b638d4cbb0f32dcada', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-gateway-server-deployment-694bf969dd-xhbg9', 'service': 'kubelet'}, 'value': [1678851455.479, '0.0012005194444447572']}, {'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-burstable.slice/kubepods-burstable-pod7c5c60f1_091a_4773_84dc_ffc0b6e9c14b.slice/cri-containerd-7e7eb669303b7c73e6c9301cb1dce84e7efa20fce7b6e3ac4d285baaf30b35ae.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-inference-service-tensorflow:2022WW49', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '7e7eb669303b7c73e6c9301cb1dce84e7efa20fce7b6e3ac4d285baaf30b35ae', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9', 'service': 'kubelet'}, 'value': [1678851455.479, '1.9629389027777777']}, {'metric': {'container': 'ei-wss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podd781997c_c6e4_4a9a_8814_f1a5e364edb4.slice/cri-containerd-d43dd1ddebde49d8cd5407a60d348e56d9384fcda992f264ae9ca5887ba0ab87.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-websocket-server:2022WW51', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'd43dd1ddebde49d8cd5407a60d348e56d9384fcda992f264ae9ca5887ba0ab87', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-websocket-server-deployment-b4f68d987-95vnz', 'service': 'kubelet'}, 'value': [1678851455.479, '0.0005128388888907567']}, {'metric': {'container': 'nfs-subdir-external-provisioner', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod008ca2f8_cd34_4bb5_9e75_b46ec5ce9a23.slice/cri-containerd-710ae0fcfaef79b8c1cbf5871a10727a0da4ef1ca22a1fd9e475a740588b43e4.scope', 'image': 'k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '710ae0fcfaef79b8c1cbf5871a10727a0da4ef1ca22a1fd9e475a740588b43e4', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'nfs-subdir-external-provisioner-6f66496f8f-529tg', 'service': 'kubelet'}, 'value': [1678851455.479, '0.0009876694444440344']}, {'metric': {'container': 'redis', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod0d8f249f_8e44_4dae_82d3_618b15befd15.slice/cri-containerd-0d39607a911d680151ccaee4e31a4eeb21acbade8e1a9eb7cd5377c4796e012e.scope', 'image': 'docker.io/library/redis:6.0', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '0d39607a911d680151ccaee4e31a4eeb21acbade8e1a9eb7cd5377c4796e012e', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-redis-deployment-68df56c9d5-9kt42', 'service': 'kubelet'}, 'value': [1678851455.479, '0.00870912500000587']}, {'metric': {'container': 'tmp-shell', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod9cbe7477_0ea6_463d_8c1e_33eb5efda051.slice/cri-containerd-9093ed8c6f94ca6b98db8362a28e0ee47cc31e863e7c131462759af96d66c3e9.scope', 'image': 'docker.io/nicolaka/netshoot:latest', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '9093ed8c6f94ca6b98db8362a28e0ee47cc31e863e7c131462759af96d66c3e9', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'tmp-shell', 'service': 'kubelet'}, 'value': [1678851455.479, '0']}]
2023-03-14 20:37:35,494 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=sum(container_memory_working_set_bytes{namespace="default",container!="", image!=""}) by (pod)
2023-03-14 20:37:35,494 - INFO - metric_name is: memory_usage
2023-03-14 20:37:35,494 - INFO - result is: [{'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-06-59c94bd6dd-7fqpw'}, 'value': [1678851455.483, '386166784']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-02-59c94bd6dd-hf2k2'}, 'value': [1678851455.483, '386437120']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-05-59c94bd6dd-2vw5v'}, 'value': [1678851455.483, '386445312']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-04-59c94bd6dd-whjrf'}, 'value': [1678851455.483, '386273280']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-03-59c94bd6dd-57bn5'}, 'value': [1678851455.483, '386523136']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-01-59c94bd6dd-n5rdt'}, 'value': [1678851455.483, '386002944']}, {'metric': {'pod': 'ei-gateway-server-deployment-694bf969dd-xhbg9'}, 'value': [1678851455.483, '56774656']}, {'metric': {'pod': 'ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9'}, 'value': [1678851455.483, '538976256']}, {'metric': {'pod': 'ei-websocket-server-deployment-b4f68d987-95vnz'}, 'value': [1678851455.483, '5093306368']}, {'metric': {'pod': 'nfs-subdir-external-provisioner-6f66496f8f-529tg'}, 'value': [1678851455.483, '15171584']}, {'metric': {'pod': 'ei-redis-deployment-68df56c9d5-9kt42'}, 'value': [1678851455.483, '2454622208']}, {'metric': {'pod': 'tmp-shell'}, 'value': [1678851455.483, '847872']}]
2023-03-14 20:37:35,494 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_infer_fps{namespace="default"}[2m])
2023-03-14 20:37:35,494 - INFO - metric_name is: ei_infer_fps
2023-03-14 20:37:35,494 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.61:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678851455.487, '0.2824314917112881']}]
2023-03-14 20:37:35,494 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_drop_fps{namespace="default"}[2m])
2023-03-14 20:37:35,494 - INFO - metric_name is: ei_drop_fps
2023-03-14 20:37:35,495 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.61:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678851455.49, '169.99113471093187']}]
2023-03-14 20:37:35,495 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_scale_ratio{namespace="default"}[2m])
2023-03-14 20:37:35,495 - INFO - metric_name is: ei_scale_ratio
2023-03-14 20:37:35,495 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.61:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678851455.494, '604.6666666666667']}]
2023-03-14 20:37:35,495 - INFO - Results written to metrics/E086_NON_AMX_BF16_metrics_20230314_203735.txt
2023-03-14 20:37:35,562 - INFO - sleep 120 seconds for the next round ...
2023-03-14 20:39:35,566 - INFO - -----------loop num:3/3------------
2023-03-14 20:39:45,572 - INFO - 1.  fetch_emon.sh
2023-03-14 20:39:45,574 - INFO - pwd=/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon
2023-03-14 20:39:47,433 - INFO - 10.45.247.200 | SUCCESS => {
2023-03-14 20:39:47,434 - INFO - "ansible_facts": {
2023-03-14 20:39:47,434 - INFO - "discovered_interpreter_python": "/usr/bin/python3"
2023-03-14 20:39:47,434 - INFO - },
2023-03-14 20:39:47,434 - INFO - "changed": false,
2023-03-14 20:39:47,434 - INFO - "checksum": "1bb1c680bf42bce57bd33e9ee945d27bb8aeaafc",
2023-03-14 20:39:47,434 - INFO - "dest": "runemon.sh",
2023-03-14 20:39:47,434 - INFO - "gid": 1007,
2023-03-14 20:39:47,434 - INFO - "group": "ansible",
2023-03-14 20:39:47,435 - INFO - "mode": "0755",
2023-03-14 20:39:47,435 - INFO - "owner": "ansible",
2023-03-14 20:39:47,435 - INFO - "path": "runemon.sh",
2023-03-14 20:39:47,435 - INFO - "size": 452,
2023-03-14 20:39:47,435 - INFO - "state": "file",
2023-03-14 20:39:47,435 - INFO - "uid": 1006
2023-03-14 20:39:47,435 - INFO - }
2023-03-14 20:39:48,806 - INFO - 10.45.247.200 | SUCCESS => {
2023-03-14 20:39:48,806 - INFO - "ansible_facts": {
2023-03-14 20:39:48,806 - INFO - "discovered_interpreter_python": "/usr/bin/python3"
2023-03-14 20:39:48,806 - INFO - },
2023-03-14 20:39:48,806 - INFO - "changed": false,
2023-03-14 20:39:48,806 - INFO - "checksum": "0b7ce1d178a191ee4962273d5bcbcac8b825066d",
2023-03-14 20:39:48,807 - INFO - "dest": "sapphirerapids_server_events_private.txt",
2023-03-14 20:39:48,807 - INFO - "gid": 1007,
2023-03-14 20:39:48,807 - INFO - "group": "ansible",
2023-03-14 20:39:48,807 - INFO - "mode": "0664",
2023-03-14 20:39:48,807 - INFO - "owner": "ansible",
2023-03-14 20:39:48,807 - INFO - "path": "sapphirerapids_server_events_private.txt",
2023-03-14 20:39:48,807 - INFO - "size": 23423,
2023-03-14 20:39:48,807 - INFO - "state": "file",
2023-03-14 20:39:48,807 - INFO - "uid": 1006
2023-03-14 20:39:48,807 - INFO - }
2023-03-14 20:39:49,858 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:39:49,858 - INFO - 
2023-03-14 20:39:50,900 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:39:50,900 - INFO - 
2023-03-14 20:39:51,000 - INFO - Sleep 5 seconds then collect emon data for 30 seconds
2023-03-14 20:39:56,003 - INFO - Collecting 30 seconds sar data background
2023-03-14 20:39:57,967 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:39:57,968 - INFO - 
2023-03-14 20:40:00,041 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:40:00,041 - INFO - 
2023-03-14 20:40:02,083 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:40:02,083 - INFO - 
2023-03-14 20:40:04,133 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:40:04,133 - INFO - 
2023-03-14 20:40:04,255 - INFO - Collecting EMON data
2023-03-14 20:40:35,902 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:40:35,903 - INFO - Usage: sep_vars.sh [emon_api]
2023-03-14 20:40:35,903 - INFO - PATH=/opt/intel/sep/bin64:/opt/intel/sep/android_target:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin
2023-03-14 20:40:35,903 - INFO - CPATH=/opt/intel/sep/config/emon_api:
2023-03-14 20:40:35,903 - INFO - LIBRARY_PATH=/opt/intel/sep/lib64:
2023-03-14 20:40:35,903 - INFO - LD_LIBRARY_PATH=
2023-03-14 20:40:35,903 - INFO - SEP_BASE_DIR=/opt/intel/sep/bin64
2023-03-14 20:40:35,904 - INFO - SEP is currently installed under /opt/intel/sep/bin64
2023-03-14 20:40:35,904 - INFO - EMON collector successfully stopped.
2023-03-14 20:40:36,004 - INFO - Sleep another 30 seconds to make sure the previous run exit
2023-03-14 20:41:06,007 - INFO - Copy dat files
2023-03-14 20:41:07,069 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:41:07,070 - INFO - "changed": true,
2023-03-14 20:41:07,070 - INFO - "checksum": "5e84cbaa425f6ab0bb2c0484cac6b3d31b352e3f",
2023-03-14 20:41:07,070 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/cpuutil.log",
2023-03-14 20:41:07,070 - INFO - "md5sum": "cf661da88dc87fb6628d0b36d5a46312",
2023-03-14 20:41:07,070 - INFO - "remote_checksum": "5e84cbaa425f6ab0bb2c0484cac6b3d31b352e3f",
2023-03-14 20:41:07,070 - INFO - "remote_md5sum": null
2023-03-14 20:41:07,070 - INFO - }
2023-03-14 20:41:08,163 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:41:08,163 - INFO - "changed": true,
2023-03-14 20:41:08,163 - INFO - "checksum": "d0af5a77cc62dd6406047fb718b125abd4c29e3b",
2023-03-14 20:41:08,163 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/diskutil.log",
2023-03-14 20:41:08,163 - INFO - "md5sum": "65b54b5647b496d24b4dcb9109ae2a33",
2023-03-14 20:41:08,163 - INFO - "remote_checksum": "d0af5a77cc62dd6406047fb718b125abd4c29e3b",
2023-03-14 20:41:08,164 - INFO - "remote_md5sum": null
2023-03-14 20:41:08,164 - INFO - }
2023-03-14 20:41:09,262 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:41:09,263 - INFO - "changed": true,
2023-03-14 20:41:09,263 - INFO - "checksum": "b853a19b195d31c5d60010012104daea58b6a816",
2023-03-14 20:41:09,263 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/netutil.log",
2023-03-14 20:41:09,263 - INFO - "md5sum": "7b3f556b308a42178062870a09dbd878",
2023-03-14 20:41:09,263 - INFO - "remote_checksum": "b853a19b195d31c5d60010012104daea58b6a816",
2023-03-14 20:41:09,263 - INFO - "remote_md5sum": null
2023-03-14 20:41:09,263 - INFO - }
2023-03-14 20:41:10,438 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:41:10,439 - INFO - "changed": true,
2023-03-14 20:41:10,439 - INFO - "checksum": "bef01e6cd7f88defa676c71254b61a56254285ea",
2023-03-14 20:41:10,439 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/top.log",
2023-03-14 20:41:10,439 - INFO - "md5sum": "199153921912ea28cacc0f54566e2ddb",
2023-03-14 20:41:10,439 - INFO - "remote_checksum": "bef01e6cd7f88defa676c71254b61a56254285ea",
2023-03-14 20:41:10,439 - INFO - "remote_md5sum": null
2023-03-14 20:41:10,439 - INFO - }
2023-03-14 20:41:11,530 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:41:11,530 - INFO - "changed": true,
2023-03-14 20:41:11,530 - INFO - "checksum": "0eecf027044a52ff57e87a1ef1f9277e1ceb146e",
2023-03-14 20:41:11,531 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon-v.dat",
2023-03-14 20:41:11,531 - INFO - "md5sum": "9ed6ca61f164c3a1ddac82b3adb8e41f",
2023-03-14 20:41:11,531 - INFO - "remote_checksum": "0eecf027044a52ff57e87a1ef1f9277e1ceb146e",
2023-03-14 20:41:11,531 - INFO - "remote_md5sum": null
2023-03-14 20:41:11,531 - INFO - }
2023-03-14 20:41:12,622 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:41:12,623 - INFO - "changed": true,
2023-03-14 20:41:12,623 - INFO - "checksum": "553de59ae1f861c17499a345947edac24f5ef5e6",
2023-03-14 20:41:12,623 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon-M.dat",
2023-03-14 20:41:12,623 - INFO - "md5sum": "82b2e5d1d33c2feb6e5d5290b113dd3f",
2023-03-14 20:41:12,623 - INFO - "remote_checksum": "553de59ae1f861c17499a345947edac24f5ef5e6",
2023-03-14 20:41:12,623 - INFO - "remote_md5sum": null
2023-03-14 20:41:12,623 - INFO - }
2023-03-14 20:41:14,255 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:41:14,255 - INFO - "changed": true,
2023-03-14 20:41:14,255 - INFO - "checksum": "fe09297e773babefeab91e3e85e42982dabc4052",
2023-03-14 20:41:14,256 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon.dat",
2023-03-14 20:41:14,256 - INFO - "md5sum": "17027fd533f4933c4895b1b00c6b32e2",
2023-03-14 20:41:14,256 - INFO - "remote_checksum": "fe09297e773babefeab91e3e85e42982dabc4052",
2023-03-14 20:41:14,256 - INFO - "remote_md5sum": null
2023-03-14 20:41:14,256 - INFO - }
2023-03-14 20:41:14,361 - INFO - 2. fetch the matrics of ai_pipeline
2023-03-14 20:41:14,362 - INFO - 3.  collect the result
2023-03-14 20:41:14,523 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(rate(container_cpu_usage_seconds_total{namespace="default", container!=""}[2m])[2m:])
2023-03-14 20:41:14,524 - INFO - metric_name is: cpu_usage
2023-03-14 20:41:14,538 - INFO - result is: [{'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod37bfe08c_1a35_4f31_aee2_d3ed773045f6.slice/cri-containerd-32957fce66e8ca89850f6a363f2bad55c4c434f4dd10e8ee22d59409d4d63156.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '32957fce66e8ca89850f6a363f2bad55c4c434f4dd10e8ee22d59409d4d63156', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-06-59c94bd6dd-7fqpw', 'service': 'kubelet'}, 'value': [1678851674.523, '0.0669087027778005']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod443d56fd_7192_407b_aa7f_3a19c6164b35.slice/cri-containerd-8ef35ec5e997b42b467e9a537ce481f8b80255b055daf3b4d653e511cc959b79.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '8ef35ec5e997b42b467e9a537ce481f8b80255b055daf3b4d653e511cc959b79', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-02-59c94bd6dd-hf2k2', 'service': 'kubelet'}, 'value': [1678851674.523, '0.07177596666662996']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod5b20665e_1471_41e3_a906_37dbadf61ded.slice/cri-containerd-1903d9a29e2cc9280c983cf212ed426789dd4724ed212d8d6aaa692b7099b21d.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '1903d9a29e2cc9280c983cf212ed426789dd4724ed212d8d6aaa692b7099b21d', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-05-59c94bd6dd-2vw5v', 'service': 'kubelet'}, 'value': [1678851674.523, '0.06810300277781303']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podc1b02e88_e7c7_494d_b700_42e46c1f306d.slice/cri-containerd-8eb30a61e0cb53f9f0a8c0c18dc645c56eb3686a459ce4441c537113ae8007ae.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '8eb30a61e0cb53f9f0a8c0c18dc645c56eb3686a459ce4441c537113ae8007ae', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-04-59c94bd6dd-whjrf', 'service': 'kubelet'}, 'value': [1678851674.523, '0.07174102222221941']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podf0bbadd5_e728_4dc7_ac09_67de87ab9ed9.slice/cri-containerd-d2606d2272b90c545952113b692da741b7958b163650096e2f624aeee76293a8.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'd2606d2272b90c545952113b692da741b7958b163650096e2f624aeee76293a8', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-03-59c94bd6dd-57bn5', 'service': 'kubelet'}, 'value': [1678851674.523, '0.07141741944445432']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podf765b16c_07f8_4261_9b64_3517dc6bafb7.slice/cri-containerd-88d725ffe5a1ce389c7c711b044f1cbdd7b97a922268c6d9d0735d1ba203f048.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '88d725ffe5a1ce389c7c711b044f1cbdd7b97a922268c6d9d0735d1ba203f048', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-01-59c94bd6dd-n5rdt', 'service': 'kubelet'}, 'value': [1678851674.523, '0.0718420194444358']}, {'metric': {'container': 'ei-gws', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podaf221d52_33c6_40a0_b6bf_e5e2bc7b88db.slice/cri-containerd-870edc8724b46c501ca89d89b821712566f2c55b1d2077b638d4cbb0f32dcada.scope', 'image': 'ccr-registry.caas.intel.com/cnbench/ei-gateway-server:2022WW51-ws-8080', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '870edc8724b46c501ca89d89b821712566f2c55b1d2077b638d4cbb0f32dcada', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-gateway-server-deployment-694bf969dd-xhbg9', 'service': 'kubelet'}, 'value': [1678851674.523, '0.0011850722222220612']}, {'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-burstable.slice/kubepods-burstable-pod7c5c60f1_091a_4773_84dc_ffc0b6e9c14b.slice/cri-containerd-7e7eb669303b7c73e6c9301cb1dce84e7efa20fce7b6e3ac4d285baaf30b35ae.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-inference-service-tensorflow:2022WW49', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '7e7eb669303b7c73e6c9301cb1dce84e7efa20fce7b6e3ac4d285baaf30b35ae', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9', 'service': 'kubelet'}, 'value': [1678851674.523, '2.0112215305555545']}, {'metric': {'container': 'ei-wss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podd781997c_c6e4_4a9a_8814_f1a5e364edb4.slice/cri-containerd-d43dd1ddebde49d8cd5407a60d348e56d9384fcda992f264ae9ca5887ba0ab87.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-websocket-server:2022WW51', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'd43dd1ddebde49d8cd5407a60d348e56d9384fcda992f264ae9ca5887ba0ab87', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-websocket-server-deployment-b4f68d987-95vnz', 'service': 'kubelet'}, 'value': [1678851674.523, '0.000482661111118432']}, {'metric': {'container': 'nfs-subdir-external-provisioner', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod008ca2f8_cd34_4bb5_9e75_b46ec5ce9a23.slice/cri-containerd-710ae0fcfaef79b8c1cbf5871a10727a0da4ef1ca22a1fd9e475a740588b43e4.scope', 'image': 'k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '710ae0fcfaef79b8c1cbf5871a10727a0da4ef1ca22a1fd9e475a740588b43e4', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'nfs-subdir-external-provisioner-6f66496f8f-529tg', 'service': 'kubelet'}, 'value': [1678851674.523, '0.0012374305555529948']}, {'metric': {'container': 'redis', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod0d8f249f_8e44_4dae_82d3_618b15befd15.slice/cri-containerd-0d39607a911d680151ccaee4e31a4eeb21acbade8e1a9eb7cd5377c4796e012e.scope', 'image': 'docker.io/library/redis:6.0', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '0d39607a911d680151ccaee4e31a4eeb21acbade8e1a9eb7cd5377c4796e012e', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-redis-deployment-68df56c9d5-9kt42', 'service': 'kubelet'}, 'value': [1678851674.523, '0.009048686111110428']}, {'metric': {'container': 'tmp-shell', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod9cbe7477_0ea6_463d_8c1e_33eb5efda051.slice/cri-containerd-9093ed8c6f94ca6b98db8362a28e0ee47cc31e863e7c131462759af96d66c3e9.scope', 'image': 'docker.io/nicolaka/netshoot:latest', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '9093ed8c6f94ca6b98db8362a28e0ee47cc31e863e7c131462759af96d66c3e9', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'tmp-shell', 'service': 'kubelet'}, 'value': [1678851674.523, '0']}]
2023-03-14 20:41:14,538 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=sum(container_memory_working_set_bytes{namespace="default",container!="", image!=""}) by (pod)
2023-03-14 20:41:14,538 - INFO - metric_name is: memory_usage
2023-03-14 20:41:14,539 - INFO - result is: [{'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-06-59c94bd6dd-7fqpw'}, 'value': [1678851674.528, '386289664']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-02-59c94bd6dd-hf2k2'}, 'value': [1678851674.528, '386437120']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-05-59c94bd6dd-2vw5v'}, 'value': [1678851674.528, '386441216']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-04-59c94bd6dd-whjrf'}, 'value': [1678851674.528, '386293760']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-03-59c94bd6dd-57bn5'}, 'value': [1678851674.528, '386498560']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-01-59c94bd6dd-n5rdt'}, 'value': [1678851674.528, '386007040']}, {'metric': {'pod': 'ei-gateway-server-deployment-694bf969dd-xhbg9'}, 'value': [1678851674.528, '56774656']}, {'metric': {'pod': 'ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9'}, 'value': [1678851674.528, '538873856']}, {'metric': {'pod': 'ei-websocket-server-deployment-b4f68d987-95vnz'}, 'value': [1678851674.528, '5093175296']}, {'metric': {'pod': 'nfs-subdir-external-provisioner-6f66496f8f-529tg'}, 'value': [1678851674.528, '15564800']}, {'metric': {'pod': 'ei-redis-deployment-68df56c9d5-9kt42'}, 'value': [1678851674.528, '2448134144']}, {'metric': {'pod': 'tmp-shell'}, 'value': [1678851674.528, '847872']}]
2023-03-14 20:41:14,539 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_infer_fps{namespace="default"}[2m])
2023-03-14 20:41:14,539 - INFO - metric_name is: ei_infer_fps
2023-03-14 20:41:14,539 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.61:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678851674.532, '0.28622737561121997']}]
2023-03-14 20:41:14,539 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_drop_fps{namespace="default"}[2m])
2023-03-14 20:41:14,539 - INFO - metric_name is: ei_drop_fps
2023-03-14 20:41:14,539 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.61:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678851674.535, '170.38869354160147']}]
2023-03-14 20:41:14,539 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_scale_ratio{namespace="default"}[2m])
2023-03-14 20:41:14,539 - INFO - metric_name is: ei_scale_ratio
2023-03-14 20:41:14,539 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.61:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678851674.538, '601.0729166666667']}]
2023-03-14 20:41:14,539 - INFO - Results written to metrics/E086_NON_AMX_BF16_metrics_20230314_204114.txt
2023-03-14 20:41:14,608 - INFO - ------------- scenario: 3/5 ------------
2023-03-14 20:41:14,609 - INFO - Begin set_deployment_env of scenario : VNNI_INT8 ...
2023-03-14 20:41:14,662 - INFO - Setting environment variables for scenario VNNI_INT8...
2023-03-14 20:41:14,680 - INFO - Setting resource requests and limits for scenario VNNI_INT8...
2023-03-14 20:41:14,698 - INFO - after patch_body wait for 30 seconds to enable the new pods
2023-03-14 20:41:44,728 - INFO - Waiting for 1 pods to be ready for scenario VNNI_INT8...
2023-03-14 20:41:44,809 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9 status:Running
2023-03-14 20:41:44,809 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2 status:Pending
2023-03-14 20:41:44,809 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario VNNI_INT8. Elapsed time: 0.08 seconds
2023-03-14 20:41:54,844 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9 status:Running
2023-03-14 20:41:54,845 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2 status:Pending
2023-03-14 20:41:54,845 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario VNNI_INT8. Elapsed time: 10.12 seconds
2023-03-14 20:42:04,880 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9 status:Running
2023-03-14 20:42:04,880 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2 status:Pending
2023-03-14 20:42:04,881 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario VNNI_INT8. Elapsed time: 20.15 seconds
2023-03-14 20:42:14,916 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9 status:Running
2023-03-14 20:42:14,916 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2 status:Pending
2023-03-14 20:42:14,916 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario VNNI_INT8. Elapsed time: 30.19 seconds
2023-03-14 20:42:24,954 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9 status:Running
2023-03-14 20:42:24,955 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2 status:Pending
2023-03-14 20:42:24,955 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario VNNI_INT8. Elapsed time: 40.23 seconds
2023-03-14 20:42:34,992 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9 status:Running
2023-03-14 20:42:34,993 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2 status:Pending
2023-03-14 20:42:34,993 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario VNNI_INT8. Elapsed time: 50.26 seconds
2023-03-14 20:42:45,028 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9 status:Running
2023-03-14 20:42:45,028 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2 status:Pending
2023-03-14 20:42:45,028 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario VNNI_INT8. Elapsed time: 60.30 seconds
2023-03-14 20:42:55,064 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7cd4bfdc46-qtmb9 status:Running
2023-03-14 20:42:55,064 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2 status:Running
2023-03-14 20:42:55,064 - INFO - Waiting for -1 more pods to be ready, there are 0 not ready pods for scenario VNNI_INT8. Elapsed time: 70.34 seconds
2023-03-14 20:43:05,094 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2 status:Running
2023-03-14 20:43:05,095 - INFO - All 1 pods are ready for scenario VNNI_INT8
2023-03-14 20:43:05,096 - INFO - Finished scenario VNNI_INT8
2023-03-14 20:43:05,096 - INFO - wait for 2m to get stable metrics ...
2023-03-14 20:45:05,197 - INFO - Running benchmarking script for scenario VNNI_INT8...
2023-03-14 20:45:05,210 - INFO - TS=20230314204505
2023-03-14 20:45:07,198 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:45:07,198 - INFO - Reading package lists...
2023-03-14 20:45:07,198 - INFO - Building dependency tree...
2023-03-14 20:45:07,198 - INFO - Reading state information...
2023-03-14 20:45:07,198 - INFO - linux-tools-5.15.0-60-generic is already the newest version (5.15.0-60.66).
2023-03-14 20:45:07,198 - INFO - sysstat is already the newest version (12.5.2-2ubuntu0.1).
2023-03-14 20:45:07,198 - INFO - The following packages were automatically installed and are no longer required:
2023-03-14 20:45:07,198 - INFO - cgroupfs-mount libltdl7 pigz
2023-03-14 20:45:07,199 - INFO - Use 'sudo apt autoremove' to remove them.
2023-03-14 20:45:07,199 - INFO - 0 upgraded, 0 newly installed, 0 to remove and 44 not upgraded.
2023-03-14 20:45:07,199 - INFO - WARNING: apt does not have a stable CLI interface. Use with caution in scripts.
2023-03-14 20:45:08,293 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:45:08,294 - INFO - 
2023-03-14 20:45:09,362 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:45:09,363 - INFO - performance
2023-03-14 20:45:09,460 - INFO - Run on test AiPipeline_20230314204505_E086_VNNI_INT8_6
2023-03-14 20:45:09,461 - INFO - TT=AiPipeline_20230314204505_E086_VNNI_INT8_6,WRKDIR=/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon
2023-03-14 20:45:09,466 - INFO - -----------loop num:1/3------------
2023-03-14 20:45:19,472 - INFO - 1.  fetch_emon.sh
2023-03-14 20:45:19,474 - INFO - pwd=/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon
2023-03-14 20:45:20,771 - INFO - 10.45.247.200 | SUCCESS => {
2023-03-14 20:45:20,772 - INFO - "ansible_facts": {
2023-03-14 20:45:20,772 - INFO - "discovered_interpreter_python": "/usr/bin/python3"
2023-03-14 20:45:20,772 - INFO - },
2023-03-14 20:45:20,772 - INFO - "changed": false,
2023-03-14 20:45:20,772 - INFO - "checksum": "1bb1c680bf42bce57bd33e9ee945d27bb8aeaafc",
2023-03-14 20:45:20,772 - INFO - "dest": "runemon.sh",
2023-03-14 20:45:20,772 - INFO - "gid": 1007,
2023-03-14 20:45:20,772 - INFO - "group": "ansible",
2023-03-14 20:45:20,772 - INFO - "mode": "0755",
2023-03-14 20:45:20,773 - INFO - "owner": "ansible",
2023-03-14 20:45:20,773 - INFO - "path": "runemon.sh",
2023-03-14 20:45:20,773 - INFO - "size": 452,
2023-03-14 20:45:20,773 - INFO - "state": "file",
2023-03-14 20:45:20,773 - INFO - "uid": 1006
2023-03-14 20:45:20,773 - INFO - }
2023-03-14 20:45:22,179 - INFO - 10.45.247.200 | SUCCESS => {
2023-03-14 20:45:22,180 - INFO - "ansible_facts": {
2023-03-14 20:45:22,180 - INFO - "discovered_interpreter_python": "/usr/bin/python3"
2023-03-14 20:45:22,180 - INFO - },
2023-03-14 20:45:22,180 - INFO - "changed": false,
2023-03-14 20:45:22,180 - INFO - "checksum": "0b7ce1d178a191ee4962273d5bcbcac8b825066d",
2023-03-14 20:45:22,180 - INFO - "dest": "sapphirerapids_server_events_private.txt",
2023-03-14 20:45:22,180 - INFO - "gid": 1007,
2023-03-14 20:45:22,180 - INFO - "group": "ansible",
2023-03-14 20:45:22,180 - INFO - "mode": "0664",
2023-03-14 20:45:22,180 - INFO - "owner": "ansible",
2023-03-14 20:45:22,181 - INFO - "path": "sapphirerapids_server_events_private.txt",
2023-03-14 20:45:22,181 - INFO - "size": 23423,
2023-03-14 20:45:22,181 - INFO - "state": "file",
2023-03-14 20:45:22,181 - INFO - "uid": 1006
2023-03-14 20:45:22,181 - INFO - }
2023-03-14 20:45:23,247 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:45:23,247 - INFO - 
2023-03-14 20:45:24,312 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:45:24,313 - INFO - 
2023-03-14 20:45:24,409 - INFO - Sleep 5 seconds then collect emon data for 30 seconds
2023-03-14 20:45:29,413 - INFO - Collecting 30 seconds sar data background
2023-03-14 20:45:31,386 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:45:31,386 - INFO - 
2023-03-14 20:45:33,457 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:45:33,457 - INFO - 
2023-03-14 20:45:35,552 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:45:35,553 - INFO - 
2023-03-14 20:45:37,619 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:45:37,619 - INFO - 
2023-03-14 20:45:37,719 - INFO - Collecting EMON data
2023-03-14 20:46:09,232 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:46:09,233 - INFO - Usage: sep_vars.sh [emon_api]
2023-03-14 20:46:09,233 - INFO - PATH=/opt/intel/sep/bin64:/opt/intel/sep/android_target:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin
2023-03-14 20:46:09,233 - INFO - CPATH=/opt/intel/sep/config/emon_api:
2023-03-14 20:46:09,233 - INFO - LIBRARY_PATH=/opt/intel/sep/lib64:
2023-03-14 20:46:09,233 - INFO - LD_LIBRARY_PATH=
2023-03-14 20:46:09,233 - INFO - SEP_BASE_DIR=/opt/intel/sep/bin64
2023-03-14 20:46:09,233 - INFO - SEP is currently installed under /opt/intel/sep/bin64
2023-03-14 20:46:09,233 - INFO - EMON collector successfully stopped.
2023-03-14 20:46:09,329 - INFO - Sleep another 30 seconds to make sure the previous run exit
2023-03-14 20:46:39,333 - INFO - Copy dat files
2023-03-14 20:46:40,357 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:46:40,357 - INFO - "changed": true,
2023-03-14 20:46:40,357 - INFO - "checksum": "a7311a4dc569c721ba2a91d21efa661a87b072cf",
2023-03-14 20:46:40,357 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/cpuutil.log",
2023-03-14 20:46:40,357 - INFO - "md5sum": "f03253773415851012cbf1e302f994a5",
2023-03-14 20:46:40,357 - INFO - "remote_checksum": "a7311a4dc569c721ba2a91d21efa661a87b072cf",
2023-03-14 20:46:40,357 - INFO - "remote_md5sum": null
2023-03-14 20:46:40,358 - INFO - }
2023-03-14 20:46:41,463 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:46:41,464 - INFO - "changed": true,
2023-03-14 20:46:41,464 - INFO - "checksum": "04bd6fc1b5a55177401c42ea32d459c1c4dce827",
2023-03-14 20:46:41,464 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/diskutil.log",
2023-03-14 20:46:41,464 - INFO - "md5sum": "dde1bd5aabc05513801094807e29b6f7",
2023-03-14 20:46:41,464 - INFO - "remote_checksum": "04bd6fc1b5a55177401c42ea32d459c1c4dce827",
2023-03-14 20:46:41,464 - INFO - "remote_md5sum": null
2023-03-14 20:46:41,464 - INFO - }
2023-03-14 20:46:42,572 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:46:42,573 - INFO - "changed": true,
2023-03-14 20:46:42,573 - INFO - "checksum": "9538e80caec150b7bf42f95e71f36064443a7453",
2023-03-14 20:46:42,573 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/netutil.log",
2023-03-14 20:46:42,573 - INFO - "md5sum": "81c4e5f6a2a2e40cd55bd511133be7c0",
2023-03-14 20:46:42,573 - INFO - "remote_checksum": "9538e80caec150b7bf42f95e71f36064443a7453",
2023-03-14 20:46:42,573 - INFO - "remote_md5sum": null
2023-03-14 20:46:42,573 - INFO - }
2023-03-14 20:46:43,713 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:46:43,714 - INFO - "changed": true,
2023-03-14 20:46:43,714 - INFO - "checksum": "3e36d58c52a7a3a03d3fc5c5846c36d15b705477",
2023-03-14 20:46:43,714 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/top.log",
2023-03-14 20:46:43,714 - INFO - "md5sum": "d4f5de2ab7d456bf71701caa079de3f4",
2023-03-14 20:46:43,714 - INFO - "remote_checksum": "3e36d58c52a7a3a03d3fc5c5846c36d15b705477",
2023-03-14 20:46:43,714 - INFO - "remote_md5sum": null
2023-03-14 20:46:43,714 - INFO - }
2023-03-14 20:46:44,864 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:46:44,864 - INFO - "changed": true,
2023-03-14 20:46:44,865 - INFO - "checksum": "0eecf027044a52ff57e87a1ef1f9277e1ceb146e",
2023-03-14 20:46:44,865 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon-v.dat",
2023-03-14 20:46:44,865 - INFO - "md5sum": "9ed6ca61f164c3a1ddac82b3adb8e41f",
2023-03-14 20:46:44,865 - INFO - "remote_checksum": "0eecf027044a52ff57e87a1ef1f9277e1ceb146e",
2023-03-14 20:46:44,865 - INFO - "remote_md5sum": null
2023-03-14 20:46:44,865 - INFO - }
2023-03-14 20:46:45,970 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:46:45,970 - INFO - "changed": true,
2023-03-14 20:46:45,970 - INFO - "checksum": "553de59ae1f861c17499a345947edac24f5ef5e6",
2023-03-14 20:46:45,970 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon-M.dat",
2023-03-14 20:46:45,970 - INFO - "md5sum": "82b2e5d1d33c2feb6e5d5290b113dd3f",
2023-03-14 20:46:45,970 - INFO - "remote_checksum": "553de59ae1f861c17499a345947edac24f5ef5e6",
2023-03-14 20:46:45,970 - INFO - "remote_md5sum": null
2023-03-14 20:46:45,970 - INFO - }
2023-03-14 20:46:47,587 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:46:47,587 - INFO - "changed": true,
2023-03-14 20:46:47,587 - INFO - "checksum": "f8297d9903333039622662ddbd45865b25284388",
2023-03-14 20:46:47,587 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon.dat",
2023-03-14 20:46:47,587 - INFO - "md5sum": "c52f5e76c048ba0785df94d7aa863eec",
2023-03-14 20:46:47,587 - INFO - "remote_checksum": "f8297d9903333039622662ddbd45865b25284388",
2023-03-14 20:46:47,587 - INFO - "remote_md5sum": null
2023-03-14 20:46:47,588 - INFO - }
2023-03-14 20:46:47,679 - INFO - 2. fetch the matrics of ai_pipeline
2023-03-14 20:46:47,680 - INFO - 3.  collect the result
2023-03-14 20:46:47,841 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(rate(container_cpu_usage_seconds_total{namespace="default", container!=""}[2m])[2m:])
2023-03-14 20:46:47,841 - INFO - metric_name is: cpu_usage
2023-03-14 20:46:47,855 - INFO - result is: [{'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod37bfe08c_1a35_4f31_aee2_d3ed773045f6.slice/cri-containerd-32957fce66e8ca89850f6a363f2bad55c4c434f4dd10e8ee22d59409d4d63156.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '32957fce66e8ca89850f6a363f2bad55c4c434f4dd10e8ee22d59409d4d63156', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-06-59c94bd6dd-7fqpw', 'service': 'kubelet'}, 'value': [1678852007.84, '0.07061693055554011']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod443d56fd_7192_407b_aa7f_3a19c6164b35.slice/cri-containerd-8ef35ec5e997b42b467e9a537ce481f8b80255b055daf3b4d653e511cc959b79.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '8ef35ec5e997b42b467e9a537ce481f8b80255b055daf3b4d653e511cc959b79', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-02-59c94bd6dd-hf2k2', 'service': 'kubelet'}, 'value': [1678852007.84, '0.07180113333332781']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod5b20665e_1471_41e3_a906_37dbadf61ded.slice/cri-containerd-1903d9a29e2cc9280c983cf212ed426789dd4724ed212d8d6aaa692b7099b21d.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '1903d9a29e2cc9280c983cf212ed426789dd4724ed212d8d6aaa692b7099b21d', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-05-59c94bd6dd-2vw5v', 'service': 'kubelet'}, 'value': [1678852007.84, '0.07287470277775962']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podc1b02e88_e7c7_494d_b700_42e46c1f306d.slice/cri-containerd-8eb30a61e0cb53f9f0a8c0c18dc645c56eb3686a459ce4441c537113ae8007ae.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '8eb30a61e0cb53f9f0a8c0c18dc645c56eb3686a459ce4441c537113ae8007ae', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-04-59c94bd6dd-whjrf', 'service': 'kubelet'}, 'value': [1678852007.84, '0.07075765833332197']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podf0bbadd5_e728_4dc7_ac09_67de87ab9ed9.slice/cri-containerd-d2606d2272b90c545952113b692da741b7958b163650096e2f624aeee76293a8.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'd2606d2272b90c545952113b692da741b7958b163650096e2f624aeee76293a8', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-03-59c94bd6dd-57bn5', 'service': 'kubelet'}, 'value': [1678852007.84, '0.07691758611112567']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podf765b16c_07f8_4261_9b64_3517dc6bafb7.slice/cri-containerd-88d725ffe5a1ce389c7c711b044f1cbdd7b97a922268c6d9d0735d1ba203f048.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '88d725ffe5a1ce389c7c711b044f1cbdd7b97a922268c6d9d0735d1ba203f048', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-01-59c94bd6dd-n5rdt', 'service': 'kubelet'}, 'value': [1678852007.84, '0.0728868555555487']}, {'metric': {'container': 'ei-gws', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podaf221d52_33c6_40a0_b6bf_e5e2bc7b88db.slice/cri-containerd-870edc8724b46c501ca89d89b821712566f2c55b1d2077b638d4cbb0f32dcada.scope', 'image': 'ccr-registry.caas.intel.com/cnbench/ei-gateway-server:2022WW51-ws-8080', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '870edc8724b46c501ca89d89b821712566f2c55b1d2077b638d4cbb0f32dcada', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-gateway-server-deployment-694bf969dd-xhbg9', 'service': 'kubelet'}, 'value': [1678852007.84, '0.0011670333333332413']}, {'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-burstable.slice/kubepods-burstable-pod9d4da322_c1b7_4228_a637_9187fbbdcf9a.slice/cri-containerd-b58767e4f2a4cee87d88c10cf05e62ee7dd643544df26046d11983e46bcb37fe.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-inference-service-tensorflow:2022WW49', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'b58767e4f2a4cee87d88c10cf05e62ee7dd643544df26046d11983e46bcb37fe', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2', 'service': 'kubelet'}, 'value': [1678852007.84, '1.4941513745867594']}, {'metric': {'container': 'ei-wss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podd781997c_c6e4_4a9a_8814_f1a5e364edb4.slice/cri-containerd-d43dd1ddebde49d8cd5407a60d348e56d9384fcda992f264ae9ca5887ba0ab87.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-websocket-server:2022WW51', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'd43dd1ddebde49d8cd5407a60d348e56d9384fcda992f264ae9ca5887ba0ab87', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-websocket-server-deployment-b4f68d987-95vnz', 'service': 'kubelet'}, 'value': [1678852007.84, '0.010511333333331803']}, {'metric': {'container': 'nfs-subdir-external-provisioner', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod008ca2f8_cd34_4bb5_9e75_b46ec5ce9a23.slice/cri-containerd-710ae0fcfaef79b8c1cbf5871a10727a0da4ef1ca22a1fd9e475a740588b43e4.scope', 'image': 'k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '710ae0fcfaef79b8c1cbf5871a10727a0da4ef1ca22a1fd9e475a740588b43e4', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'nfs-subdir-external-provisioner-6f66496f8f-529tg', 'service': 'kubelet'}, 'value': [1678852007.84, '0.001125727777779654']}, {'metric': {'container': 'redis', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod0d8f249f_8e44_4dae_82d3_618b15befd15.slice/cri-containerd-0d39607a911d680151ccaee4e31a4eeb21acbade8e1a9eb7cd5377c4796e012e.scope', 'image': 'docker.io/library/redis:6.0', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '0d39607a911d680151ccaee4e31a4eeb21acbade8e1a9eb7cd5377c4796e012e', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-redis-deployment-68df56c9d5-9kt42', 'service': 'kubelet'}, 'value': [1678852007.84, '0.015001605555552387']}, {'metric': {'container': 'tmp-shell', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod9cbe7477_0ea6_463d_8c1e_33eb5efda051.slice/cri-containerd-9093ed8c6f94ca6b98db8362a28e0ee47cc31e863e7c131462759af96d66c3e9.scope', 'image': 'docker.io/nicolaka/netshoot:latest', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '9093ed8c6f94ca6b98db8362a28e0ee47cc31e863e7c131462759af96d66c3e9', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'tmp-shell', 'service': 'kubelet'}, 'value': [1678852007.84, '0']}]
2023-03-14 20:46:47,856 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=sum(container_memory_working_set_bytes{namespace="default",container!="", image!=""}) by (pod)
2023-03-14 20:46:47,856 - INFO - metric_name is: memory_usage
2023-03-14 20:46:47,856 - INFO - result is: [{'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-06-59c94bd6dd-7fqpw'}, 'value': [1678852007.845, '386293760']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-02-59c94bd6dd-hf2k2'}, 'value': [1678852007.845, '386543616']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-05-59c94bd6dd-2vw5v'}, 'value': [1678852007.845, '386596864']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-04-59c94bd6dd-whjrf'}, 'value': [1678852007.845, '386162688']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-03-59c94bd6dd-57bn5'}, 'value': [1678852007.845, '386498560']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-01-59c94bd6dd-n5rdt'}, 'value': [1678852007.845, '386134016']}, {'metric': {'pod': 'ei-gateway-server-deployment-694bf969dd-xhbg9'}, 'value': [1678852007.845, '56774656']}, {'metric': {'pod': 'ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2'}, 'value': [1678852007.845, '325685248']}, {'metric': {'pod': 'ei-websocket-server-deployment-b4f68d987-95vnz'}, 'value': [1678852007.845, '5093191680']}, {'metric': {'pod': 'nfs-subdir-external-provisioner-6f66496f8f-529tg'}, 'value': [1678852007.845, '15298560']}, {'metric': {'pod': 'ei-redis-deployment-68df56c9d5-9kt42'}, 'value': [1678852007.845, '2445307904']}, {'metric': {'pod': 'tmp-shell'}, 'value': [1678852007.845, '847872']}]
2023-03-14 20:46:47,856 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_infer_fps{namespace="default"}[2m])
2023-03-14 20:46:47,856 - INFO - metric_name is: ei_infer_fps
2023-03-14 20:46:47,856 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.50:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678852007.849, '103.06666147390696']}]
2023-03-14 20:46:47,856 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_drop_fps{namespace="default"}[2m])
2023-03-14 20:46:47,856 - INFO - metric_name is: ei_drop_fps
2023-03-14 20:46:47,856 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.50:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678852007.852, '67.13257062909469']}]
2023-03-14 20:46:47,856 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_scale_ratio{namespace="default"}[2m])
2023-03-14 20:46:47,857 - INFO - metric_name is: ei_scale_ratio
2023-03-14 20:46:47,857 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.50:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678852007.856, '1.6515419875731854']}]
2023-03-14 20:46:47,857 - INFO - Results written to metrics/E086_VNNI_INT8_metrics_20230314_204647.txt
2023-03-14 20:46:47,925 - INFO - sleep 120 seconds for the next round ...
2023-03-14 20:48:47,928 - INFO - -----------loop num:2/3------------
2023-03-14 20:48:57,935 - INFO - 1.  fetch_emon.sh
2023-03-14 20:48:57,937 - INFO - pwd=/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon
2023-03-14 20:48:59,848 - INFO - 10.45.247.200 | SUCCESS => {
2023-03-14 20:48:59,849 - INFO - "ansible_facts": {
2023-03-14 20:48:59,849 - INFO - "discovered_interpreter_python": "/usr/bin/python3"
2023-03-14 20:48:59,849 - INFO - },
2023-03-14 20:48:59,849 - INFO - "changed": false,
2023-03-14 20:48:59,849 - INFO - "checksum": "1bb1c680bf42bce57bd33e9ee945d27bb8aeaafc",
2023-03-14 20:48:59,849 - INFO - "dest": "runemon.sh",
2023-03-14 20:48:59,849 - INFO - "gid": 1007,
2023-03-14 20:48:59,849 - INFO - "group": "ansible",
2023-03-14 20:48:59,849 - INFO - "mode": "0755",
2023-03-14 20:48:59,849 - INFO - "owner": "ansible",
2023-03-14 20:48:59,849 - INFO - "path": "runemon.sh",
2023-03-14 20:48:59,850 - INFO - "size": 452,
2023-03-14 20:48:59,850 - INFO - "state": "file",
2023-03-14 20:48:59,850 - INFO - "uid": 1006
2023-03-14 20:48:59,850 - INFO - }
2023-03-14 20:49:01,252 - INFO - 10.45.247.200 | SUCCESS => {
2023-03-14 20:49:01,252 - INFO - "ansible_facts": {
2023-03-14 20:49:01,253 - INFO - "discovered_interpreter_python": "/usr/bin/python3"
2023-03-14 20:49:01,253 - INFO - },
2023-03-14 20:49:01,253 - INFO - "changed": false,
2023-03-14 20:49:01,253 - INFO - "checksum": "0b7ce1d178a191ee4962273d5bcbcac8b825066d",
2023-03-14 20:49:01,253 - INFO - "dest": "sapphirerapids_server_events_private.txt",
2023-03-14 20:49:01,253 - INFO - "gid": 1007,
2023-03-14 20:49:01,253 - INFO - "group": "ansible",
2023-03-14 20:49:01,253 - INFO - "mode": "0664",
2023-03-14 20:49:01,253 - INFO - "owner": "ansible",
2023-03-14 20:49:01,253 - INFO - "path": "sapphirerapids_server_events_private.txt",
2023-03-14 20:49:01,253 - INFO - "size": 23423,
2023-03-14 20:49:01,253 - INFO - "state": "file",
2023-03-14 20:49:01,253 - INFO - "uid": 1006
2023-03-14 20:49:01,254 - INFO - }
2023-03-14 20:49:02,331 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:49:02,332 - INFO - 
2023-03-14 20:49:03,379 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:49:03,379 - INFO - 
2023-03-14 20:49:03,475 - INFO - Sleep 5 seconds then collect emon data for 30 seconds
2023-03-14 20:49:08,479 - INFO - Collecting 30 seconds sar data background
2023-03-14 20:49:10,578 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:49:10,578 - INFO - 
2023-03-14 20:49:12,655 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:49:12,656 - INFO - 
2023-03-14 20:49:14,749 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:49:14,750 - INFO - 
2023-03-14 20:49:16,809 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:49:16,809 - INFO - 
2023-03-14 20:49:16,905 - INFO - Collecting EMON data
2023-03-14 20:49:48,400 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:49:48,401 - INFO - Usage: sep_vars.sh [emon_api]
2023-03-14 20:49:48,401 - INFO - PATH=/opt/intel/sep/bin64:/opt/intel/sep/android_target:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin
2023-03-14 20:49:48,401 - INFO - CPATH=/opt/intel/sep/config/emon_api:
2023-03-14 20:49:48,401 - INFO - LIBRARY_PATH=/opt/intel/sep/lib64:
2023-03-14 20:49:48,401 - INFO - LD_LIBRARY_PATH=
2023-03-14 20:49:48,401 - INFO - SEP_BASE_DIR=/opt/intel/sep/bin64
2023-03-14 20:49:48,401 - INFO - SEP is currently installed under /opt/intel/sep/bin64
2023-03-14 20:49:48,402 - INFO - EMON collector successfully stopped.
2023-03-14 20:49:48,511 - INFO - Sleep another 30 seconds to make sure the previous run exit
2023-03-14 20:50:18,514 - INFO - Copy dat files
2023-03-14 20:50:19,516 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:50:19,516 - INFO - "changed": true,
2023-03-14 20:50:19,516 - INFO - "checksum": "bc78a39e5860fbc5ce1ef411db78e19761f56859",
2023-03-14 20:50:19,516 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/cpuutil.log",
2023-03-14 20:50:19,516 - INFO - "md5sum": "4f7eccc3fab2e6e48a1c0348d3c8c540",
2023-03-14 20:50:19,516 - INFO - "remote_checksum": "bc78a39e5860fbc5ce1ef411db78e19761f56859",
2023-03-14 20:50:19,516 - INFO - "remote_md5sum": null
2023-03-14 20:50:19,517 - INFO - }
2023-03-14 20:50:20,635 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:50:20,635 - INFO - "changed": true,
2023-03-14 20:50:20,636 - INFO - "checksum": "f8e0f7330935067cd83bcbc03337a879ff521b21",
2023-03-14 20:50:20,636 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/diskutil.log",
2023-03-14 20:50:20,636 - INFO - "md5sum": "549eea34849cd3fbb05c062662a011dd",
2023-03-14 20:50:20,636 - INFO - "remote_checksum": "f8e0f7330935067cd83bcbc03337a879ff521b21",
2023-03-14 20:50:20,636 - INFO - "remote_md5sum": null
2023-03-14 20:50:20,636 - INFO - }
2023-03-14 20:50:21,750 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:50:21,751 - INFO - "changed": true,
2023-03-14 20:50:21,751 - INFO - "checksum": "d3405cc65dc4f9e1154ec6462e1953d02982d240",
2023-03-14 20:50:21,751 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/netutil.log",
2023-03-14 20:50:21,751 - INFO - "md5sum": "1c48df6bba82d380ae8740783d1a18f0",
2023-03-14 20:50:21,751 - INFO - "remote_checksum": "d3405cc65dc4f9e1154ec6462e1953d02982d240",
2023-03-14 20:50:21,751 - INFO - "remote_md5sum": null
2023-03-14 20:50:21,751 - INFO - }
2023-03-14 20:50:22,874 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:50:22,874 - INFO - "changed": true,
2023-03-14 20:50:22,874 - INFO - "checksum": "93f67ab1b6aa634ca15f411597fa114018d12819",
2023-03-14 20:50:22,875 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/top.log",
2023-03-14 20:50:22,875 - INFO - "md5sum": "66bca2464e31662287c634e65b944443",
2023-03-14 20:50:22,875 - INFO - "remote_checksum": "93f67ab1b6aa634ca15f411597fa114018d12819",
2023-03-14 20:50:22,875 - INFO - "remote_md5sum": null
2023-03-14 20:50:22,875 - INFO - }
2023-03-14 20:50:24,000 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:50:24,000 - INFO - "changed": true,
2023-03-14 20:50:24,000 - INFO - "checksum": "0eecf027044a52ff57e87a1ef1f9277e1ceb146e",
2023-03-14 20:50:24,000 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon-v.dat",
2023-03-14 20:50:24,000 - INFO - "md5sum": "9ed6ca61f164c3a1ddac82b3adb8e41f",
2023-03-14 20:50:24,001 - INFO - "remote_checksum": "0eecf027044a52ff57e87a1ef1f9277e1ceb146e",
2023-03-14 20:50:24,001 - INFO - "remote_md5sum": null
2023-03-14 20:50:24,001 - INFO - }
2023-03-14 20:50:25,142 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:50:25,142 - INFO - "changed": true,
2023-03-14 20:50:25,142 - INFO - "checksum": "553de59ae1f861c17499a345947edac24f5ef5e6",
2023-03-14 20:50:25,142 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon-M.dat",
2023-03-14 20:50:25,142 - INFO - "md5sum": "82b2e5d1d33c2feb6e5d5290b113dd3f",
2023-03-14 20:50:25,142 - INFO - "remote_checksum": "553de59ae1f861c17499a345947edac24f5ef5e6",
2023-03-14 20:50:25,142 - INFO - "remote_md5sum": null
2023-03-14 20:50:25,143 - INFO - }
2023-03-14 20:50:26,750 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:50:26,750 - INFO - "changed": true,
2023-03-14 20:50:26,751 - INFO - "checksum": "bc60796c07fb00238152638b423972360c14a7b0",
2023-03-14 20:50:26,751 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon.dat",
2023-03-14 20:50:26,751 - INFO - "md5sum": "422ebabcacb3be85ad57d81d0656fb29",
2023-03-14 20:50:26,751 - INFO - "remote_checksum": "bc60796c07fb00238152638b423972360c14a7b0",
2023-03-14 20:50:26,751 - INFO - "remote_md5sum": null
2023-03-14 20:50:26,751 - INFO - }
2023-03-14 20:50:26,849 - INFO - 2. fetch the matrics of ai_pipeline
2023-03-14 20:50:26,849 - INFO - 3.  collect the result
2023-03-14 20:50:27,010 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(rate(container_cpu_usage_seconds_total{namespace="default", container!=""}[2m])[2m:])
2023-03-14 20:50:27,010 - INFO - metric_name is: cpu_usage
2023-03-14 20:50:27,025 - INFO - result is: [{'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod37bfe08c_1a35_4f31_aee2_d3ed773045f6.slice/cri-containerd-32957fce66e8ca89850f6a363f2bad55c4c434f4dd10e8ee22d59409d4d63156.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '32957fce66e8ca89850f6a363f2bad55c4c434f4dd10e8ee22d59409d4d63156', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-06-59c94bd6dd-7fqpw', 'service': 'kubelet'}, 'value': [1678852227.009, '0.07352046388888184']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod443d56fd_7192_407b_aa7f_3a19c6164b35.slice/cri-containerd-8ef35ec5e997b42b467e9a537ce481f8b80255b055daf3b4d653e511cc959b79.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '8ef35ec5e997b42b467e9a537ce481f8b80255b055daf3b4d653e511cc959b79', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-02-59c94bd6dd-hf2k2', 'service': 'kubelet'}, 'value': [1678852227.009, '0.07315038055555002']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod5b20665e_1471_41e3_a906_37dbadf61ded.slice/cri-containerd-1903d9a29e2cc9280c983cf212ed426789dd4724ed212d8d6aaa692b7099b21d.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '1903d9a29e2cc9280c983cf212ed426789dd4724ed212d8d6aaa692b7099b21d', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-05-59c94bd6dd-2vw5v', 'service': 'kubelet'}, 'value': [1678852227.009, '0.07635352222223446']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podc1b02e88_e7c7_494d_b700_42e46c1f306d.slice/cri-containerd-8eb30a61e0cb53f9f0a8c0c18dc645c56eb3686a459ce4441c537113ae8007ae.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '8eb30a61e0cb53f9f0a8c0c18dc645c56eb3686a459ce4441c537113ae8007ae', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-04-59c94bd6dd-whjrf', 'service': 'kubelet'}, 'value': [1678852227.009, '0.07036417777776983']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podf0bbadd5_e728_4dc7_ac09_67de87ab9ed9.slice/cri-containerd-d2606d2272b90c545952113b692da741b7958b163650096e2f624aeee76293a8.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'd2606d2272b90c545952113b692da741b7958b163650096e2f624aeee76293a8', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-03-59c94bd6dd-57bn5', 'service': 'kubelet'}, 'value': [1678852227.009, '0.06936235555555564']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podf765b16c_07f8_4261_9b64_3517dc6bafb7.slice/cri-containerd-88d725ffe5a1ce389c7c711b044f1cbdd7b97a922268c6d9d0735d1ba203f048.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '88d725ffe5a1ce389c7c711b044f1cbdd7b97a922268c6d9d0735d1ba203f048', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-01-59c94bd6dd-n5rdt', 'service': 'kubelet'}, 'value': [1678852227.009, '0.07448438888887823']}, {'metric': {'container': 'ei-gws', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podaf221d52_33c6_40a0_b6bf_e5e2bc7b88db.slice/cri-containerd-870edc8724b46c501ca89d89b821712566f2c55b1d2077b638d4cbb0f32dcada.scope', 'image': 'ccr-registry.caas.intel.com/cnbench/ei-gateway-server:2022WW51-ws-8080', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '870edc8724b46c501ca89d89b821712566f2c55b1d2077b638d4cbb0f32dcada', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-gateway-server-deployment-694bf969dd-xhbg9', 'service': 'kubelet'}, 'value': [1678852227.009, '0.0012111888888884752']}, {'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-burstable.slice/kubepods-burstable-pod9d4da322_c1b7_4228_a637_9187fbbdcf9a.slice/cri-containerd-b58767e4f2a4cee87d88c10cf05e62ee7dd643544df26046d11983e46bcb37fe.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-inference-service-tensorflow:2022WW49', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'b58767e4f2a4cee87d88c10cf05e62ee7dd643544df26046d11983e46bcb37fe', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2', 'service': 'kubelet'}, 'value': [1678852227.009, '1.4927106583333334']}, {'metric': {'container': 'ei-wss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podd781997c_c6e4_4a9a_8814_f1a5e364edb4.slice/cri-containerd-d43dd1ddebde49d8cd5407a60d348e56d9384fcda992f264ae9ca5887ba0ab87.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-websocket-server:2022WW51', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'd43dd1ddebde49d8cd5407a60d348e56d9384fcda992f264ae9ca5887ba0ab87', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-websocket-server-deployment-b4f68d987-95vnz', 'service': 'kubelet'}, 'value': [1678852227.009, '0.01044052222222389']}, {'metric': {'container': 'nfs-subdir-external-provisioner', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod008ca2f8_cd34_4bb5_9e75_b46ec5ce9a23.slice/cri-containerd-710ae0fcfaef79b8c1cbf5871a10727a0da4ef1ca22a1fd9e475a740588b43e4.scope', 'image': 'k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '710ae0fcfaef79b8c1cbf5871a10727a0da4ef1ca22a1fd9e475a740588b43e4', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'nfs-subdir-external-provisioner-6f66496f8f-529tg', 'service': 'kubelet'}, 'value': [1678852227.009, '0.0010302222222233265']}, {'metric': {'container': 'redis', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod0d8f249f_8e44_4dae_82d3_618b15befd15.slice/cri-containerd-0d39607a911d680151ccaee4e31a4eeb21acbade8e1a9eb7cd5377c4796e012e.scope', 'image': 'docker.io/library/redis:6.0', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '0d39607a911d680151ccaee4e31a4eeb21acbade8e1a9eb7cd5377c4796e012e', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-redis-deployment-68df56c9d5-9kt42', 'service': 'kubelet'}, 'value': [1678852227.009, '0.014281936111112574']}, {'metric': {'container': 'tmp-shell', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod9cbe7477_0ea6_463d_8c1e_33eb5efda051.slice/cri-containerd-9093ed8c6f94ca6b98db8362a28e0ee47cc31e863e7c131462759af96d66c3e9.scope', 'image': 'docker.io/nicolaka/netshoot:latest', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '9093ed8c6f94ca6b98db8362a28e0ee47cc31e863e7c131462759af96d66c3e9', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'tmp-shell', 'service': 'kubelet'}, 'value': [1678852227.009, '0']}]
2023-03-14 20:50:27,025 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=sum(container_memory_working_set_bytes{namespace="default",container!="", image!=""}) by (pod)
2023-03-14 20:50:27,025 - INFO - metric_name is: memory_usage
2023-03-14 20:50:27,026 - INFO - result is: [{'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-06-59c94bd6dd-7fqpw'}, 'value': [1678852227.014, '386166784']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-02-59c94bd6dd-hf2k2'}, 'value': [1678852227.014, '386564096']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-05-59c94bd6dd-2vw5v'}, 'value': [1678852227.014, '386572288']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-04-59c94bd6dd-whjrf'}, 'value': [1678852227.014, '386293760']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-03-59c94bd6dd-57bn5'}, 'value': [1678852227.014, '386498560']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-01-59c94bd6dd-n5rdt'}, 'value': [1678852227.014, '386002944']}, {'metric': {'pod': 'ei-gateway-server-deployment-694bf969dd-xhbg9'}, 'value': [1678852227.014, '56774656']}, {'metric': {'pod': 'ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2'}, 'value': [1678852227.014, '325558272']}, {'metric': {'pod': 'ei-websocket-server-deployment-b4f68d987-95vnz'}, 'value': [1678852227.014, '5093060608']}, {'metric': {'pod': 'nfs-subdir-external-provisioner-6f66496f8f-529tg'}, 'value': [1678852227.014, '15298560']}, {'metric': {'pod': 'ei-redis-deployment-68df56c9d5-9kt42'}, 'value': [1678852227.014, '2445275136']}, {'metric': {'pod': 'tmp-shell'}, 'value': [1678852227.014, '847872']}]
2023-03-14 20:50:27,026 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_infer_fps{namespace="default"}[2m])
2023-03-14 20:50:27,026 - INFO - metric_name is: ei_infer_fps
2023-03-14 20:50:27,026 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.50:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678852227.018, '102.12423387782115']}]
2023-03-14 20:50:27,026 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_drop_fps{namespace="default"}[2m])
2023-03-14 20:50:27,026 - INFO - metric_name is: ei_drop_fps
2023-03-14 20:50:27,026 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.50:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678852227.021, '67.8120858749663']}]
2023-03-14 20:50:27,026 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_scale_ratio{namespace="default"}[2m])
2023-03-14 20:50:27,026 - INFO - metric_name is: ei_scale_ratio
2023-03-14 20:50:27,026 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.50:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678852227.025, '1.664466892711024']}]
2023-03-14 20:50:27,026 - INFO - Results written to metrics/E086_VNNI_INT8_metrics_20230314_205027.txt
2023-03-14 20:50:27,095 - INFO - sleep 120 seconds for the next round ...
2023-03-14 20:52:27,098 - INFO - -----------loop num:3/3------------
2023-03-14 20:52:37,105 - INFO - 1.  fetch_emon.sh
2023-03-14 20:52:37,107 - INFO - pwd=/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon
2023-03-14 20:52:38,961 - INFO - 10.45.247.200 | SUCCESS => {
2023-03-14 20:52:38,962 - INFO - "ansible_facts": {
2023-03-14 20:52:38,962 - INFO - "discovered_interpreter_python": "/usr/bin/python3"
2023-03-14 20:52:38,962 - INFO - },
2023-03-14 20:52:38,962 - INFO - "changed": false,
2023-03-14 20:52:38,962 - INFO - "checksum": "1bb1c680bf42bce57bd33e9ee945d27bb8aeaafc",
2023-03-14 20:52:38,962 - INFO - "dest": "runemon.sh",
2023-03-14 20:52:38,962 - INFO - "gid": 1007,
2023-03-14 20:52:38,962 - INFO - "group": "ansible",
2023-03-14 20:52:38,962 - INFO - "mode": "0755",
2023-03-14 20:52:38,962 - INFO - "owner": "ansible",
2023-03-14 20:52:38,963 - INFO - "path": "runemon.sh",
2023-03-14 20:52:38,963 - INFO - "size": 452,
2023-03-14 20:52:38,963 - INFO - "state": "file",
2023-03-14 20:52:38,963 - INFO - "uid": 1006
2023-03-14 20:52:38,963 - INFO - }
2023-03-14 20:52:40,382 - INFO - 10.45.247.200 | SUCCESS => {
2023-03-14 20:52:40,382 - INFO - "ansible_facts": {
2023-03-14 20:52:40,382 - INFO - "discovered_interpreter_python": "/usr/bin/python3"
2023-03-14 20:52:40,382 - INFO - },
2023-03-14 20:52:40,382 - INFO - "changed": false,
2023-03-14 20:52:40,382 - INFO - "checksum": "0b7ce1d178a191ee4962273d5bcbcac8b825066d",
2023-03-14 20:52:40,383 - INFO - "dest": "sapphirerapids_server_events_private.txt",
2023-03-14 20:52:40,383 - INFO - "gid": 1007,
2023-03-14 20:52:40,383 - INFO - "group": "ansible",
2023-03-14 20:52:40,383 - INFO - "mode": "0664",
2023-03-14 20:52:40,383 - INFO - "owner": "ansible",
2023-03-14 20:52:40,383 - INFO - "path": "sapphirerapids_server_events_private.txt",
2023-03-14 20:52:40,383 - INFO - "size": 23423,
2023-03-14 20:52:40,383 - INFO - "state": "file",
2023-03-14 20:52:40,383 - INFO - "uid": 1006
2023-03-14 20:52:40,383 - INFO - }
2023-03-14 20:52:41,458 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:52:41,458 - INFO - 
2023-03-14 20:52:42,519 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:52:42,519 - INFO - 
2023-03-14 20:52:42,618 - INFO - Sleep 5 seconds then collect emon data for 30 seconds
2023-03-14 20:52:47,621 - INFO - Collecting 30 seconds sar data background
2023-03-14 20:52:49,580 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:52:49,581 - INFO - 
2023-03-14 20:52:51,642 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:52:51,642 - INFO - 
2023-03-14 20:52:53,703 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:52:53,704 - INFO - 
2023-03-14 20:52:55,783 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:52:55,783 - INFO - 
2023-03-14 20:52:55,887 - INFO - Collecting EMON data
2023-03-14 20:53:27,489 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:53:27,489 - INFO - Usage: sep_vars.sh [emon_api]
2023-03-14 20:53:27,489 - INFO - PATH=/opt/intel/sep/bin64:/opt/intel/sep/android_target:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin
2023-03-14 20:53:27,489 - INFO - CPATH=/opt/intel/sep/config/emon_api:
2023-03-14 20:53:27,489 - INFO - LIBRARY_PATH=/opt/intel/sep/lib64:
2023-03-14 20:53:27,489 - INFO - LD_LIBRARY_PATH=
2023-03-14 20:53:27,489 - INFO - SEP_BASE_DIR=/opt/intel/sep/bin64
2023-03-14 20:53:27,490 - INFO - SEP is currently installed under /opt/intel/sep/bin64
2023-03-14 20:53:27,490 - INFO - EMON collector successfully stopped.
2023-03-14 20:53:27,592 - INFO - Sleep another 30 seconds to make sure the previous run exit
2023-03-14 20:53:57,595 - INFO - Copy dat files
2023-03-14 20:53:58,616 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:53:58,616 - INFO - "changed": true,
2023-03-14 20:53:58,617 - INFO - "checksum": "01af57b3ab3ff403e5601fa5f203498716a52d93",
2023-03-14 20:53:58,617 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/cpuutil.log",
2023-03-14 20:53:58,617 - INFO - "md5sum": "f4dc3bd8348128e9d28a7df3ec33c27b",
2023-03-14 20:53:58,617 - INFO - "remote_checksum": "01af57b3ab3ff403e5601fa5f203498716a52d93",
2023-03-14 20:53:58,617 - INFO - "remote_md5sum": null
2023-03-14 20:53:58,617 - INFO - }
2023-03-14 20:53:59,737 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:53:59,737 - INFO - "changed": true,
2023-03-14 20:53:59,737 - INFO - "checksum": "06688313b77fde39d2d1da401c26183f0cff93f9",
2023-03-14 20:53:59,737 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/diskutil.log",
2023-03-14 20:53:59,738 - INFO - "md5sum": "0a33245dc570099f722e237953e04542",
2023-03-14 20:53:59,738 - INFO - "remote_checksum": "06688313b77fde39d2d1da401c26183f0cff93f9",
2023-03-14 20:53:59,738 - INFO - "remote_md5sum": null
2023-03-14 20:53:59,738 - INFO - }
2023-03-14 20:54:00,845 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:54:00,845 - INFO - "changed": true,
2023-03-14 20:54:00,845 - INFO - "checksum": "a07e257e99df6bb234e3d9ea9a1f29ca538edfb0",
2023-03-14 20:54:00,845 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/netutil.log",
2023-03-14 20:54:00,845 - INFO - "md5sum": "860a907541008591c11646f1d5f1b645",
2023-03-14 20:54:00,846 - INFO - "remote_checksum": "a07e257e99df6bb234e3d9ea9a1f29ca538edfb0",
2023-03-14 20:54:00,846 - INFO - "remote_md5sum": null
2023-03-14 20:54:00,846 - INFO - }
2023-03-14 20:54:01,995 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:54:01,995 - INFO - "changed": true,
2023-03-14 20:54:01,996 - INFO - "checksum": "e0e3a81ba73014d6e036a17b1523578b02051029",
2023-03-14 20:54:01,996 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/top.log",
2023-03-14 20:54:01,996 - INFO - "md5sum": "38bc617dfbd3102968b7aa157a1fddd9",
2023-03-14 20:54:01,996 - INFO - "remote_checksum": "e0e3a81ba73014d6e036a17b1523578b02051029",
2023-03-14 20:54:01,996 - INFO - "remote_md5sum": null
2023-03-14 20:54:01,996 - INFO - }
2023-03-14 20:54:03,096 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:54:03,097 - INFO - "changed": true,
2023-03-14 20:54:03,097 - INFO - "checksum": "0eecf027044a52ff57e87a1ef1f9277e1ceb146e",
2023-03-14 20:54:03,097 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon-v.dat",
2023-03-14 20:54:03,097 - INFO - "md5sum": "9ed6ca61f164c3a1ddac82b3adb8e41f",
2023-03-14 20:54:03,097 - INFO - "remote_checksum": "0eecf027044a52ff57e87a1ef1f9277e1ceb146e",
2023-03-14 20:54:03,097 - INFO - "remote_md5sum": null
2023-03-14 20:54:03,097 - INFO - }
2023-03-14 20:54:04,236 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:54:04,236 - INFO - "changed": true,
2023-03-14 20:54:04,237 - INFO - "checksum": "553de59ae1f861c17499a345947edac24f5ef5e6",
2023-03-14 20:54:04,237 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon-M.dat",
2023-03-14 20:54:04,237 - INFO - "md5sum": "82b2e5d1d33c2feb6e5d5290b113dd3f",
2023-03-14 20:54:04,237 - INFO - "remote_checksum": "553de59ae1f861c17499a345947edac24f5ef5e6",
2023-03-14 20:54:04,237 - INFO - "remote_md5sum": null
2023-03-14 20:54:04,237 - INFO - }
2023-03-14 20:54:05,852 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 20:54:05,852 - INFO - "changed": true,
2023-03-14 20:54:05,852 - INFO - "checksum": "73cfa154d3b4a3f75500a795f3985c769c6e5eb2",
2023-03-14 20:54:05,852 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon.dat",
2023-03-14 20:54:05,852 - INFO - "md5sum": "abefe65caa2a42e5e15c1d68985fe204",
2023-03-14 20:54:05,852 - INFO - "remote_checksum": "73cfa154d3b4a3f75500a795f3985c769c6e5eb2",
2023-03-14 20:54:05,852 - INFO - "remote_md5sum": null
2023-03-14 20:54:05,852 - INFO - }
2023-03-14 20:54:05,954 - INFO - 2. fetch the matrics of ai_pipeline
2023-03-14 20:54:05,954 - INFO - 3.  collect the result
2023-03-14 20:54:06,117 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(rate(container_cpu_usage_seconds_total{namespace="default", container!=""}[2m])[2m:])
2023-03-14 20:54:06,118 - INFO - metric_name is: cpu_usage
2023-03-14 20:54:06,133 - INFO - result is: [{'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod37bfe08c_1a35_4f31_aee2_d3ed773045f6.slice/cri-containerd-32957fce66e8ca89850f6a363f2bad55c4c434f4dd10e8ee22d59409d4d63156.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '32957fce66e8ca89850f6a363f2bad55c4c434f4dd10e8ee22d59409d4d63156', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-06-59c94bd6dd-7fqpw', 'service': 'kubelet'}, 'value': [1678852446.117, '0.0750516277777529']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod443d56fd_7192_407b_aa7f_3a19c6164b35.slice/cri-containerd-8ef35ec5e997b42b467e9a537ce481f8b80255b055daf3b4d653e511cc959b79.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '8ef35ec5e997b42b467e9a537ce481f8b80255b055daf3b4d653e511cc959b79', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-02-59c94bd6dd-hf2k2', 'service': 'kubelet'}, 'value': [1678852446.117, '0.07421463611111297']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod5b20665e_1471_41e3_a906_37dbadf61ded.slice/cri-containerd-1903d9a29e2cc9280c983cf212ed426789dd4724ed212d8d6aaa692b7099b21d.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '1903d9a29e2cc9280c983cf212ed426789dd4724ed212d8d6aaa692b7099b21d', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-05-59c94bd6dd-2vw5v', 'service': 'kubelet'}, 'value': [1678852446.117, '0.07604366111109913']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podc1b02e88_e7c7_494d_b700_42e46c1f306d.slice/cri-containerd-8eb30a61e0cb53f9f0a8c0c18dc645c56eb3686a459ce4441c537113ae8007ae.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '8eb30a61e0cb53f9f0a8c0c18dc645c56eb3686a459ce4441c537113ae8007ae', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-04-59c94bd6dd-whjrf', 'service': 'kubelet'}, 'value': [1678852446.117, '0.07322995000001052']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podf0bbadd5_e728_4dc7_ac09_67de87ab9ed9.slice/cri-containerd-d2606d2272b90c545952113b692da741b7958b163650096e2f624aeee76293a8.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'd2606d2272b90c545952113b692da741b7958b163650096e2f624aeee76293a8', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-03-59c94bd6dd-57bn5', 'service': 'kubelet'}, 'value': [1678852446.117, '0.06949746666666921']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podf765b16c_07f8_4261_9b64_3517dc6bafb7.slice/cri-containerd-88d725ffe5a1ce389c7c711b044f1cbdd7b97a922268c6d9d0735d1ba203f048.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '88d725ffe5a1ce389c7c711b044f1cbdd7b97a922268c6d9d0735d1ba203f048', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-01-59c94bd6dd-n5rdt', 'service': 'kubelet'}, 'value': [1678852446.117, '0.07485797777775992']}, {'metric': {'container': 'ei-gws', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podaf221d52_33c6_40a0_b6bf_e5e2bc7b88db.slice/cri-containerd-870edc8724b46c501ca89d89b821712566f2c55b1d2077b638d4cbb0f32dcada.scope', 'image': 'ccr-registry.caas.intel.com/cnbench/ei-gateway-server:2022WW51-ws-8080', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '870edc8724b46c501ca89d89b821712566f2c55b1d2077b638d4cbb0f32dcada', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-gateway-server-deployment-694bf969dd-xhbg9', 'service': 'kubelet'}, 'value': [1678852446.117, '0.0012499194444444582']}, {'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-burstable.slice/kubepods-burstable-pod9d4da322_c1b7_4228_a637_9187fbbdcf9a.slice/cri-containerd-b58767e4f2a4cee87d88c10cf05e62ee7dd643544df26046d11983e46bcb37fe.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-inference-service-tensorflow:2022WW49', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'b58767e4f2a4cee87d88c10cf05e62ee7dd643544df26046d11983e46bcb37fe', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2', 'service': 'kubelet'}, 'value': [1678852446.117, '1.4419424500000002']}, {'metric': {'container': 'ei-wss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podd781997c_c6e4_4a9a_8814_f1a5e364edb4.slice/cri-containerd-d43dd1ddebde49d8cd5407a60d348e56d9384fcda992f264ae9ca5887ba0ab87.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-websocket-server:2022WW51', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'd43dd1ddebde49d8cd5407a60d348e56d9384fcda992f264ae9ca5887ba0ab87', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-websocket-server-deployment-b4f68d987-95vnz', 'service': 'kubelet'}, 'value': [1678852446.117, '0.010717169444448397']}, {'metric': {'container': 'nfs-subdir-external-provisioner', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod008ca2f8_cd34_4bb5_9e75_b46ec5ce9a23.slice/cri-containerd-710ae0fcfaef79b8c1cbf5871a10727a0da4ef1ca22a1fd9e475a740588b43e4.scope', 'image': 'k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '710ae0fcfaef79b8c1cbf5871a10727a0da4ef1ca22a1fd9e475a740588b43e4', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'nfs-subdir-external-provisioner-6f66496f8f-529tg', 'service': 'kubelet'}, 'value': [1678852446.117, '0.000984238888889245']}, {'metric': {'container': 'redis', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod0d8f249f_8e44_4dae_82d3_618b15befd15.slice/cri-containerd-0d39607a911d680151ccaee4e31a4eeb21acbade8e1a9eb7cd5377c4796e012e.scope', 'image': 'docker.io/library/redis:6.0', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '0d39607a911d680151ccaee4e31a4eeb21acbade8e1a9eb7cd5377c4796e012e', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-redis-deployment-68df56c9d5-9kt42', 'service': 'kubelet'}, 'value': [1678852446.117, '0.014499483333328397']}, {'metric': {'container': 'tmp-shell', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod9cbe7477_0ea6_463d_8c1e_33eb5efda051.slice/cri-containerd-9093ed8c6f94ca6b98db8362a28e0ee47cc31e863e7c131462759af96d66c3e9.scope', 'image': 'docker.io/nicolaka/netshoot:latest', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '9093ed8c6f94ca6b98db8362a28e0ee47cc31e863e7c131462759af96d66c3e9', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'tmp-shell', 'service': 'kubelet'}, 'value': [1678852446.117, '0']}]
2023-03-14 20:54:06,133 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=sum(container_memory_working_set_bytes{namespace="default",container!="", image!=""}) by (pod)
2023-03-14 20:54:06,133 - INFO - metric_name is: memory_usage
2023-03-14 20:54:06,134 - INFO - result is: [{'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-06-59c94bd6dd-7fqpw'}, 'value': [1678852446.122, '386187264']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-02-59c94bd6dd-hf2k2'}, 'value': [1678852446.122, '386437120']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-05-59c94bd6dd-2vw5v'}, 'value': [1678852446.122, '386572288']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-04-59c94bd6dd-whjrf'}, 'value': [1678852446.122, '386293760']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-03-59c94bd6dd-57bn5'}, 'value': [1678852446.122, '386498560']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-01-59c94bd6dd-n5rdt'}, 'value': [1678852446.122, '386023424']}, {'metric': {'pod': 'ei-gateway-server-deployment-694bf969dd-xhbg9'}, 'value': [1678852446.122, '56774656']}, {'metric': {'pod': 'ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2'}, 'value': [1678852446.122, '325537792']}, {'metric': {'pod': 'ei-websocket-server-deployment-b4f68d987-95vnz'}, 'value': [1678852446.122, '5093191680']}, {'metric': {'pod': 'nfs-subdir-external-provisioner-6f66496f8f-529tg'}, 'value': [1678852446.122, '15298560']}, {'metric': {'pod': 'ei-redis-deployment-68df56c9d5-9kt42'}, 'value': [1678852446.122, '2445348864']}, {'metric': {'pod': 'tmp-shell'}, 'value': [1678852446.122, '847872']}]
2023-03-14 20:54:06,134 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_infer_fps{namespace="default"}[2m])
2023-03-14 20:54:06,134 - INFO - metric_name is: ei_infer_fps
2023-03-14 20:54:06,134 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.50:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678852446.126, '102.65142147546138']}]
2023-03-14 20:54:06,134 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_drop_fps{namespace="default"}[2m])
2023-03-14 20:54:06,134 - INFO - metric_name is: ei_drop_fps
2023-03-14 20:54:06,134 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.50:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678852446.13, '67.14769441506196']}]
2023-03-14 20:54:06,134 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_scale_ratio{namespace="default"}[2m])
2023-03-14 20:54:06,134 - INFO - metric_name is: ei_scale_ratio
2023-03-14 20:54:06,134 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.50:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678852446.133, '1.654300764621571']}]
2023-03-14 20:54:06,134 - INFO - Results written to metrics/E086_VNNI_INT8_metrics_20230314_205406.txt
2023-03-14 20:54:06,205 - INFO - ------------- scenario: 4/5 ------------
2023-03-14 20:54:06,205 - INFO - Begin set_deployment_env of scenario : NON_VNNI_INT8 ...
2023-03-14 20:54:06,258 - INFO - Setting environment variables for scenario NON_VNNI_INT8...
2023-03-14 20:54:06,279 - INFO - Setting resource requests and limits for scenario NON_VNNI_INT8...
2023-03-14 20:54:06,297 - INFO - after patch_body wait for 30 seconds to enable the new pods
2023-03-14 20:54:36,327 - INFO - Waiting for 1 pods to be ready for scenario NON_VNNI_INT8...
2023-03-14 20:54:36,407 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2 status:Running
2023-03-14 20:54:36,408 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q status:Pending
2023-03-14 20:54:36,408 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_VNNI_INT8. Elapsed time: 0.08 seconds
2023-03-14 20:54:46,444 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2 status:Running
2023-03-14 20:54:46,445 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q status:Pending
2023-03-14 20:54:46,445 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_VNNI_INT8. Elapsed time: 10.12 seconds
2023-03-14 20:54:56,480 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2 status:Running
2023-03-14 20:54:56,481 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q status:Pending
2023-03-14 20:54:56,481 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_VNNI_INT8. Elapsed time: 20.15 seconds
2023-03-14 20:55:06,516 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2 status:Running
2023-03-14 20:55:06,516 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q status:Pending
2023-03-14 20:55:06,516 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_VNNI_INT8. Elapsed time: 30.19 seconds
2023-03-14 20:55:16,552 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2 status:Running
2023-03-14 20:55:16,553 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q status:Pending
2023-03-14 20:55:16,553 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_VNNI_INT8. Elapsed time: 40.22 seconds
2023-03-14 20:55:26,589 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2 status:Running
2023-03-14 20:55:26,590 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q status:Pending
2023-03-14 20:55:26,590 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_VNNI_INT8. Elapsed time: 50.26 seconds
2023-03-14 20:55:36,626 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2 status:Running
2023-03-14 20:55:36,627 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q status:Pending
2023-03-14 20:55:36,627 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_VNNI_INT8. Elapsed time: 60.30 seconds
2023-03-14 20:55:46,661 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2 status:Running
2023-03-14 20:55:46,662 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q status:Pending
2023-03-14 20:55:46,662 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_VNNI_INT8. Elapsed time: 70.33 seconds
2023-03-14 20:55:56,696 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2 status:Running
2023-03-14 20:55:56,697 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q status:Pending
2023-03-14 20:55:56,697 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_VNNI_INT8. Elapsed time: 80.37 seconds
2023-03-14 20:56:06,731 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2 status:Running
2023-03-14 20:56:06,731 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q status:Pending
2023-03-14 20:56:06,731 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_VNNI_INT8. Elapsed time: 90.40 seconds
2023-03-14 20:56:16,766 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2 status:Running
2023-03-14 20:56:16,766 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q status:Pending
2023-03-14 20:56:16,766 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_VNNI_INT8. Elapsed time: 100.44 seconds
2023-03-14 20:56:26,803 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-7f556f77dd-khbn2 status:Running
2023-03-14 20:56:26,803 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q status:Pending
2023-03-14 20:56:26,803 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario NON_VNNI_INT8. Elapsed time: 110.48 seconds
2023-03-14 20:56:36,833 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q status:Running
2023-03-14 20:56:36,833 - INFO - All 1 pods are ready for scenario NON_VNNI_INT8
2023-03-14 20:56:36,835 - INFO - Finished scenario NON_VNNI_INT8
2023-03-14 20:56:36,835 - INFO - wait for 2m to get stable metrics ...
2023-03-14 20:58:36,935 - INFO - Running benchmarking script for scenario NON_VNNI_INT8...
2023-03-14 20:58:36,948 - INFO - TS=20230314205836
2023-03-14 20:58:39,187 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:58:39,187 - INFO - Reading package lists...
2023-03-14 20:58:39,187 - INFO - Building dependency tree...
2023-03-14 20:58:39,187 - INFO - Reading state information...
2023-03-14 20:58:39,188 - INFO - linux-tools-5.15.0-60-generic is already the newest version (5.15.0-60.66).
2023-03-14 20:58:39,188 - INFO - sysstat is already the newest version (12.5.2-2ubuntu0.1).
2023-03-14 20:58:39,188 - INFO - The following packages were automatically installed and are no longer required:
2023-03-14 20:58:39,188 - INFO - cgroupfs-mount libltdl7 pigz
2023-03-14 20:58:39,188 - INFO - Use 'sudo apt autoremove' to remove them.
2023-03-14 20:58:39,188 - INFO - 0 upgraded, 0 newly installed, 0 to remove and 44 not upgraded.
2023-03-14 20:58:39,188 - INFO - WARNING: apt does not have a stable CLI interface. Use with caution in scripts.
2023-03-14 20:58:40,302 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:58:40,303 - INFO - 
2023-03-14 20:58:41,392 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:58:41,392 - INFO - performance
2023-03-14 20:58:41,494 - INFO - Run on test AiPipeline_20230314205836_E086_NON_VNNI_INT8_6
2023-03-14 20:58:41,494 - INFO - TT=AiPipeline_20230314205836_E086_NON_VNNI_INT8_6,WRKDIR=/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon
2023-03-14 20:58:41,500 - INFO - -----------loop num:1/3------------
2023-03-14 20:58:51,507 - INFO - 1.  fetch_emon.sh
2023-03-14 20:58:51,508 - INFO - pwd=/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon
2023-03-14 20:58:52,836 - INFO - 10.45.247.200 | SUCCESS => {
2023-03-14 20:58:52,837 - INFO - "ansible_facts": {
2023-03-14 20:58:52,837 - INFO - "discovered_interpreter_python": "/usr/bin/python3"
2023-03-14 20:58:52,837 - INFO - },
2023-03-14 20:58:52,837 - INFO - "changed": false,
2023-03-14 20:58:52,837 - INFO - "checksum": "1bb1c680bf42bce57bd33e9ee945d27bb8aeaafc",
2023-03-14 20:58:52,837 - INFO - "dest": "runemon.sh",
2023-03-14 20:58:52,837 - INFO - "gid": 1007,
2023-03-14 20:58:52,837 - INFO - "group": "ansible",
2023-03-14 20:58:52,837 - INFO - "mode": "0755",
2023-03-14 20:58:52,837 - INFO - "owner": "ansible",
2023-03-14 20:58:52,837 - INFO - "path": "runemon.sh",
2023-03-14 20:58:52,838 - INFO - "size": 452,
2023-03-14 20:58:52,838 - INFO - "state": "file",
2023-03-14 20:58:52,838 - INFO - "uid": 1006
2023-03-14 20:58:52,838 - INFO - }
2023-03-14 20:58:54,258 - INFO - 10.45.247.200 | SUCCESS => {
2023-03-14 20:58:54,258 - INFO - "ansible_facts": {
2023-03-14 20:58:54,258 - INFO - "discovered_interpreter_python": "/usr/bin/python3"
2023-03-14 20:58:54,258 - INFO - },
2023-03-14 20:58:54,258 - INFO - "changed": false,
2023-03-14 20:58:54,259 - INFO - "checksum": "0b7ce1d178a191ee4962273d5bcbcac8b825066d",
2023-03-14 20:58:54,259 - INFO - "dest": "sapphirerapids_server_events_private.txt",
2023-03-14 20:58:54,259 - INFO - "gid": 1007,
2023-03-14 20:58:54,259 - INFO - "group": "ansible",
2023-03-14 20:58:54,259 - INFO - "mode": "0664",
2023-03-14 20:58:54,259 - INFO - "owner": "ansible",
2023-03-14 20:58:54,259 - INFO - "path": "sapphirerapids_server_events_private.txt",
2023-03-14 20:58:54,259 - INFO - "size": 23423,
2023-03-14 20:58:54,259 - INFO - "state": "file",
2023-03-14 20:58:54,259 - INFO - "uid": 1006
2023-03-14 20:58:54,259 - INFO - }
2023-03-14 20:58:55,346 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:58:55,347 - INFO - 
2023-03-14 20:58:56,409 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:58:56,410 - INFO - 
2023-03-14 20:58:56,507 - INFO - Sleep 5 seconds then collect emon data for 30 seconds
2023-03-14 20:59:01,511 - INFO - Collecting 30 seconds sar data background
2023-03-14 20:59:03,471 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:59:03,471 - INFO - 
2023-03-14 20:59:05,584 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:59:05,585 - INFO - 
2023-03-14 20:59:07,667 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:59:07,667 - INFO - 
2023-03-14 20:59:09,739 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:59:09,739 - INFO - 
2023-03-14 20:59:09,842 - INFO - Collecting EMON data
2023-03-14 20:59:41,339 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 20:59:41,339 - INFO - Usage: sep_vars.sh [emon_api]
2023-03-14 20:59:41,340 - INFO - PATH=/opt/intel/sep/bin64:/opt/intel/sep/android_target:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin
2023-03-14 20:59:41,340 - INFO - CPATH=/opt/intel/sep/config/emon_api:
2023-03-14 20:59:41,340 - INFO - LIBRARY_PATH=/opt/intel/sep/lib64:
2023-03-14 20:59:41,340 - INFO - LD_LIBRARY_PATH=
2023-03-14 20:59:41,340 - INFO - SEP_BASE_DIR=/opt/intel/sep/bin64
2023-03-14 20:59:41,340 - INFO - SEP is currently installed under /opt/intel/sep/bin64
2023-03-14 20:59:41,340 - INFO - EMON collector successfully stopped.
2023-03-14 20:59:41,444 - INFO - Sleep another 30 seconds to make sure the previous run exit
2023-03-14 21:00:11,447 - INFO - Copy dat files
2023-03-14 21:00:12,463 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:00:12,464 - INFO - "changed": true,
2023-03-14 21:00:12,464 - INFO - "checksum": "7950919c849a0eff0e8553763f3107e8a3e7e45f",
2023-03-14 21:00:12,464 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/cpuutil.log",
2023-03-14 21:00:12,464 - INFO - "md5sum": "0e027e3bd4091c1bdd6f8e139577bf4c",
2023-03-14 21:00:12,464 - INFO - "remote_checksum": "7950919c849a0eff0e8553763f3107e8a3e7e45f",
2023-03-14 21:00:12,464 - INFO - "remote_md5sum": null
2023-03-14 21:00:12,464 - INFO - }
2023-03-14 21:00:13,571 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:00:13,571 - INFO - "changed": true,
2023-03-14 21:00:13,571 - INFO - "checksum": "52233affb852f1a5105c5d1a9476ae06445af68c",
2023-03-14 21:00:13,572 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/diskutil.log",
2023-03-14 21:00:13,572 - INFO - "md5sum": "178ce158b42300fcd77455946692acd3",
2023-03-14 21:00:13,572 - INFO - "remote_checksum": "52233affb852f1a5105c5d1a9476ae06445af68c",
2023-03-14 21:00:13,572 - INFO - "remote_md5sum": null
2023-03-14 21:00:13,572 - INFO - }
2023-03-14 21:00:14,755 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:00:14,755 - INFO - "changed": true,
2023-03-14 21:00:14,755 - INFO - "checksum": "a9301206f2561f7d6c02b5d92730920540f312eb",
2023-03-14 21:00:14,755 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/netutil.log",
2023-03-14 21:00:14,755 - INFO - "md5sum": "0c05a91fe47d07c7ab99a9d9b4a733e9",
2023-03-14 21:00:14,755 - INFO - "remote_checksum": "a9301206f2561f7d6c02b5d92730920540f312eb",
2023-03-14 21:00:14,755 - INFO - "remote_md5sum": null
2023-03-14 21:00:14,756 - INFO - }
2023-03-14 21:00:15,907 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:00:15,907 - INFO - "changed": true,
2023-03-14 21:00:15,908 - INFO - "checksum": "84d7ef83cd341280f07776ed9a0b1d38b68ff123",
2023-03-14 21:00:15,908 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/top.log",
2023-03-14 21:00:15,908 - INFO - "md5sum": "4c38f2ceeaec0da40dfc6492d76f57d7",
2023-03-14 21:00:15,908 - INFO - "remote_checksum": "84d7ef83cd341280f07776ed9a0b1d38b68ff123",
2023-03-14 21:00:15,908 - INFO - "remote_md5sum": null
2023-03-14 21:00:15,908 - INFO - }
2023-03-14 21:00:17,018 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:00:17,019 - INFO - "changed": true,
2023-03-14 21:00:17,019 - INFO - "checksum": "0eecf027044a52ff57e87a1ef1f9277e1ceb146e",
2023-03-14 21:00:17,019 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon-v.dat",
2023-03-14 21:00:17,019 - INFO - "md5sum": "9ed6ca61f164c3a1ddac82b3adb8e41f",
2023-03-14 21:00:17,019 - INFO - "remote_checksum": "0eecf027044a52ff57e87a1ef1f9277e1ceb146e",
2023-03-14 21:00:17,019 - INFO - "remote_md5sum": null
2023-03-14 21:00:17,019 - INFO - }
2023-03-14 21:00:18,109 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:00:18,109 - INFO - "changed": true,
2023-03-14 21:00:18,109 - INFO - "checksum": "553de59ae1f861c17499a345947edac24f5ef5e6",
2023-03-14 21:00:18,109 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon-M.dat",
2023-03-14 21:00:18,110 - INFO - "md5sum": "82b2e5d1d33c2feb6e5d5290b113dd3f",
2023-03-14 21:00:18,110 - INFO - "remote_checksum": "553de59ae1f861c17499a345947edac24f5ef5e6",
2023-03-14 21:00:18,110 - INFO - "remote_md5sum": null
2023-03-14 21:00:18,110 - INFO - }
2023-03-14 21:00:19,699 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:00:19,700 - INFO - "changed": true,
2023-03-14 21:00:19,700 - INFO - "checksum": "63106fa7afed5783c0a0563368dac3d2212362d9",
2023-03-14 21:00:19,700 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon.dat",
2023-03-14 21:00:19,700 - INFO - "md5sum": "c10d3d3932611b45df707393f2bea645",
2023-03-14 21:00:19,700 - INFO - "remote_checksum": "63106fa7afed5783c0a0563368dac3d2212362d9",
2023-03-14 21:00:19,700 - INFO - "remote_md5sum": null
2023-03-14 21:00:19,700 - INFO - }
2023-03-14 21:00:19,800 - INFO - 2. fetch the matrics of ai_pipeline
2023-03-14 21:00:19,800 - INFO - 3.  collect the result
2023-03-14 21:00:19,950 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(rate(container_cpu_usage_seconds_total{namespace="default", container!=""}[2m])[2m:])
2023-03-14 21:00:19,950 - INFO - metric_name is: cpu_usage
2023-03-14 21:00:19,965 - INFO - result is: [{'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod37bfe08c_1a35_4f31_aee2_d3ed773045f6.slice/cri-containerd-32957fce66e8ca89850f6a363f2bad55c4c434f4dd10e8ee22d59409d4d63156.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '32957fce66e8ca89850f6a363f2bad55c4c434f4dd10e8ee22d59409d4d63156', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-06-59c94bd6dd-7fqpw', 'service': 'kubelet'}, 'value': [1678852819.95, '0.07633871111110137']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod443d56fd_7192_407b_aa7f_3a19c6164b35.slice/cri-containerd-8ef35ec5e997b42b467e9a537ce481f8b80255b055daf3b4d653e511cc959b79.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '8ef35ec5e997b42b467e9a537ce481f8b80255b055daf3b4d653e511cc959b79', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-02-59c94bd6dd-hf2k2', 'service': 'kubelet'}, 'value': [1678852819.95, '0.07661872222221669']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod5b20665e_1471_41e3_a906_37dbadf61ded.slice/cri-containerd-1903d9a29e2cc9280c983cf212ed426789dd4724ed212d8d6aaa692b7099b21d.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '1903d9a29e2cc9280c983cf212ed426789dd4724ed212d8d6aaa692b7099b21d', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-05-59c94bd6dd-2vw5v', 'service': 'kubelet'}, 'value': [1678852819.95, '0.07366042777779916']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podc1b02e88_e7c7_494d_b700_42e46c1f306d.slice/cri-containerd-8eb30a61e0cb53f9f0a8c0c18dc645c56eb3686a459ce4441c537113ae8007ae.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '8eb30a61e0cb53f9f0a8c0c18dc645c56eb3686a459ce4441c537113ae8007ae', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-04-59c94bd6dd-whjrf', 'service': 'kubelet'}, 'value': [1678852819.95, '0.07369467777777268']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podf0bbadd5_e728_4dc7_ac09_67de87ab9ed9.slice/cri-containerd-d2606d2272b90c545952113b692da741b7958b163650096e2f624aeee76293a8.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'd2606d2272b90c545952113b692da741b7958b163650096e2f624aeee76293a8', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-03-59c94bd6dd-57bn5', 'service': 'kubelet'}, 'value': [1678852819.95, '0.06993068055554533']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podf765b16c_07f8_4261_9b64_3517dc6bafb7.slice/cri-containerd-88d725ffe5a1ce389c7c711b044f1cbdd7b97a922268c6d9d0735d1ba203f048.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '88d725ffe5a1ce389c7c711b044f1cbdd7b97a922268c6d9d0735d1ba203f048', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-01-59c94bd6dd-n5rdt', 'service': 'kubelet'}, 'value': [1678852819.95, '0.07108617222220345']}, {'metric': {'container': 'ei-gws', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podaf221d52_33c6_40a0_b6bf_e5e2bc7b88db.slice/cri-containerd-870edc8724b46c501ca89d89b821712566f2c55b1d2077b638d4cbb0f32dcada.scope', 'image': 'ccr-registry.caas.intel.com/cnbench/ei-gateway-server:2022WW51-ws-8080', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '870edc8724b46c501ca89d89b821712566f2c55b1d2077b638d4cbb0f32dcada', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-gateway-server-deployment-694bf969dd-xhbg9', 'service': 'kubelet'}, 'value': [1678852819.95, '0.0012614861111109753']}, {'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-burstable.slice/kubepods-burstable-podb3ef5929_0e73_4f5b_9a44_e1b1c9694dff.slice/cri-containerd-010abd7c71ab0c24925e8ae5898c0cafd7cbac3725d1c407e4c34edc1f90e2ae.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-inference-service-tensorflow:2022WW49', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '010abd7c71ab0c24925e8ae5898c0cafd7cbac3725d1c407e4c34edc1f90e2ae', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q', 'service': 'kubelet'}, 'value': [1678852819.95, '1.2517802409800924']}, {'metric': {'container': 'ei-wss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podd781997c_c6e4_4a9a_8814_f1a5e364edb4.slice/cri-containerd-d43dd1ddebde49d8cd5407a60d348e56d9384fcda992f264ae9ca5887ba0ab87.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-websocket-server:2022WW51', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'd43dd1ddebde49d8cd5407a60d348e56d9384fcda992f264ae9ca5887ba0ab87', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-websocket-server-deployment-b4f68d987-95vnz', 'service': 'kubelet'}, 'value': [1678852819.95, '0.00898778055555643']}, {'metric': {'container': 'nfs-subdir-external-provisioner', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod008ca2f8_cd34_4bb5_9e75_b46ec5ce9a23.slice/cri-containerd-710ae0fcfaef79b8c1cbf5871a10727a0da4ef1ca22a1fd9e475a740588b43e4.scope', 'image': 'k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '710ae0fcfaef79b8c1cbf5871a10727a0da4ef1ca22a1fd9e475a740588b43e4', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'nfs-subdir-external-provisioner-6f66496f8f-529tg', 'service': 'kubelet'}, 'value': [1678852819.95, '0.000971372222223484']}, {'metric': {'container': 'redis', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod0d8f249f_8e44_4dae_82d3_618b15befd15.slice/cri-containerd-0d39607a911d680151ccaee4e31a4eeb21acbade8e1a9eb7cd5377c4796e012e.scope', 'image': 'docker.io/library/redis:6.0', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '0d39607a911d680151ccaee4e31a4eeb21acbade8e1a9eb7cd5377c4796e012e', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-redis-deployment-68df56c9d5-9kt42', 'service': 'kubelet'}, 'value': [1678852819.95, '0.011983127777779776']}, {'metric': {'container': 'tmp-shell', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod9cbe7477_0ea6_463d_8c1e_33eb5efda051.slice/cri-containerd-9093ed8c6f94ca6b98db8362a28e0ee47cc31e863e7c131462759af96d66c3e9.scope', 'image': 'docker.io/nicolaka/netshoot:latest', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '9093ed8c6f94ca6b98db8362a28e0ee47cc31e863e7c131462759af96d66c3e9', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'tmp-shell', 'service': 'kubelet'}, 'value': [1678852819.95, '0']}]
2023-03-14 21:00:19,965 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=sum(container_memory_working_set_bytes{namespace="default",container!="", image!=""}) by (pod)
2023-03-14 21:00:19,966 - INFO - metric_name is: memory_usage
2023-03-14 21:00:19,966 - INFO - result is: [{'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-06-59c94bd6dd-7fqpw'}, 'value': [1678852819.954, '386293760']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-02-59c94bd6dd-hf2k2'}, 'value': [1678852819.954, '386433024']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-05-59c94bd6dd-2vw5v'}, 'value': [1678852819.954, '386441216']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-04-59c94bd6dd-whjrf'}, 'value': [1678852819.954, '386166784']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-03-59c94bd6dd-57bn5'}, 'value': [1678852819.954, '386498560']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-01-59c94bd6dd-n5rdt'}, 'value': [1678852819.954, '386007040']}, {'metric': {'pod': 'ei-gateway-server-deployment-694bf969dd-xhbg9'}, 'value': [1678852819.954, '56774656']}, {'metric': {'pod': 'ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q'}, 'value': [1678852819.954, '330551296']}, {'metric': {'pod': 'ei-websocket-server-deployment-b4f68d987-95vnz'}, 'value': [1678852819.954, '5093060608']}, {'metric': {'pod': 'nfs-subdir-external-provisioner-6f66496f8f-529tg'}, 'value': [1678852819.954, '15171584']}, {'metric': {'pod': 'ei-redis-deployment-68df56c9d5-9kt42'}, 'value': [1678852819.954, '2445389824']}, {'metric': {'pod': 'tmp-shell'}, 'value': [1678852819.954, '847872']}]
2023-03-14 21:00:19,966 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_infer_fps{namespace="default"}[2m])
2023-03-14 21:00:19,966 - INFO - metric_name is: ei_infer_fps
2023-03-14 21:00:19,966 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.12:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678852819.959, '64.24419615334152']}]
2023-03-14 21:00:19,966 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_drop_fps{namespace="default"}[2m])
2023-03-14 21:00:19,966 - INFO - metric_name is: ei_drop_fps
2023-03-14 21:00:19,966 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.12:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678852819.962, '105.55025309271326']}]
2023-03-14 21:00:19,966 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_scale_ratio{namespace="default"}[2m])
2023-03-14 21:00:19,966 - INFO - metric_name is: ei_scale_ratio
2023-03-14 21:00:19,966 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.12:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678852819.966, '2.6432075441903544']}]
2023-03-14 21:00:19,966 - INFO - Results written to metrics/E086_NON_VNNI_INT8_metrics_20230314_210019.txt
2023-03-14 21:00:20,074 - INFO - sleep 120 seconds for the next round ...
2023-03-14 21:02:20,077 - INFO - -----------loop num:2/3------------
2023-03-14 21:02:30,084 - INFO - 1.  fetch_emon.sh
2023-03-14 21:02:30,086 - INFO - pwd=/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon
2023-03-14 21:02:32,033 - INFO - 10.45.247.200 | SUCCESS => {
2023-03-14 21:02:32,034 - INFO - "ansible_facts": {
2023-03-14 21:02:32,034 - INFO - "discovered_interpreter_python": "/usr/bin/python3"
2023-03-14 21:02:32,034 - INFO - },
2023-03-14 21:02:32,034 - INFO - "changed": false,
2023-03-14 21:02:32,034 - INFO - "checksum": "1bb1c680bf42bce57bd33e9ee945d27bb8aeaafc",
2023-03-14 21:02:32,034 - INFO - "dest": "runemon.sh",
2023-03-14 21:02:32,034 - INFO - "gid": 1007,
2023-03-14 21:02:32,034 - INFO - "group": "ansible",
2023-03-14 21:02:32,034 - INFO - "mode": "0755",
2023-03-14 21:02:32,034 - INFO - "owner": "ansible",
2023-03-14 21:02:32,035 - INFO - "path": "runemon.sh",
2023-03-14 21:02:32,035 - INFO - "size": 452,
2023-03-14 21:02:32,035 - INFO - "state": "file",
2023-03-14 21:02:32,035 - INFO - "uid": 1006
2023-03-14 21:02:32,035 - INFO - }
2023-03-14 21:02:33,451 - INFO - 10.45.247.200 | SUCCESS => {
2023-03-14 21:02:33,451 - INFO - "ansible_facts": {
2023-03-14 21:02:33,451 - INFO - "discovered_interpreter_python": "/usr/bin/python3"
2023-03-14 21:02:33,451 - INFO - },
2023-03-14 21:02:33,451 - INFO - "changed": false,
2023-03-14 21:02:33,452 - INFO - "checksum": "0b7ce1d178a191ee4962273d5bcbcac8b825066d",
2023-03-14 21:02:33,452 - INFO - "dest": "sapphirerapids_server_events_private.txt",
2023-03-14 21:02:33,452 - INFO - "gid": 1007,
2023-03-14 21:02:33,452 - INFO - "group": "ansible",
2023-03-14 21:02:33,452 - INFO - "mode": "0664",
2023-03-14 21:02:33,452 - INFO - "owner": "ansible",
2023-03-14 21:02:33,452 - INFO - "path": "sapphirerapids_server_events_private.txt",
2023-03-14 21:02:33,452 - INFO - "size": 23423,
2023-03-14 21:02:33,452 - INFO - "state": "file",
2023-03-14 21:02:33,452 - INFO - "uid": 1006
2023-03-14 21:02:33,452 - INFO - }
2023-03-14 21:02:34,545 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:02:34,545 - INFO - 
2023-03-14 21:02:35,603 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:02:35,604 - INFO - 
2023-03-14 21:02:35,699 - INFO - Sleep 5 seconds then collect emon data for 30 seconds
2023-03-14 21:02:40,702 - INFO - Collecting 30 seconds sar data background
2023-03-14 21:02:42,657 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:02:42,658 - INFO - 
2023-03-14 21:02:44,726 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:02:44,727 - INFO - 
2023-03-14 21:02:46,765 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:02:46,766 - INFO - 
2023-03-14 21:02:48,824 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:02:48,825 - INFO - 
2023-03-14 21:02:48,925 - INFO - Collecting EMON data
2023-03-14 21:03:20,397 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:03:20,397 - INFO - Usage: sep_vars.sh [emon_api]
2023-03-14 21:03:20,397 - INFO - PATH=/opt/intel/sep/bin64:/opt/intel/sep/android_target:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin
2023-03-14 21:03:20,397 - INFO - CPATH=/opt/intel/sep/config/emon_api:
2023-03-14 21:03:20,397 - INFO - LIBRARY_PATH=/opt/intel/sep/lib64:
2023-03-14 21:03:20,397 - INFO - LD_LIBRARY_PATH=
2023-03-14 21:03:20,398 - INFO - SEP_BASE_DIR=/opt/intel/sep/bin64
2023-03-14 21:03:20,398 - INFO - SEP is currently installed under /opt/intel/sep/bin64
2023-03-14 21:03:20,398 - INFO - EMON collector successfully stopped.
2023-03-14 21:03:20,500 - INFO - Sleep another 30 seconds to make sure the previous run exit
2023-03-14 21:03:50,504 - INFO - Copy dat files
2023-03-14 21:03:51,522 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:03:51,522 - INFO - "changed": true,
2023-03-14 21:03:51,522 - INFO - "checksum": "4b7bffe34b7e300df9e119c5bedad50f2a7a27b7",
2023-03-14 21:03:51,522 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/cpuutil.log",
2023-03-14 21:03:51,522 - INFO - "md5sum": "5fac213c8707c4ceffa14b8db9b9d1ae",
2023-03-14 21:03:51,522 - INFO - "remote_checksum": "4b7bffe34b7e300df9e119c5bedad50f2a7a27b7",
2023-03-14 21:03:51,522 - INFO - "remote_md5sum": null
2023-03-14 21:03:51,522 - INFO - }
2023-03-14 21:03:52,626 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:03:52,627 - INFO - "changed": true,
2023-03-14 21:03:52,627 - INFO - "checksum": "5bbdd19b07dc10ef66528b7594a49689272c983d",
2023-03-14 21:03:52,627 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/diskutil.log",
2023-03-14 21:03:52,627 - INFO - "md5sum": "19e2e683a694f9979c32c52439b2c829",
2023-03-14 21:03:52,627 - INFO - "remote_checksum": "5bbdd19b07dc10ef66528b7594a49689272c983d",
2023-03-14 21:03:52,627 - INFO - "remote_md5sum": null
2023-03-14 21:03:52,627 - INFO - }
2023-03-14 21:03:53,887 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:03:53,888 - INFO - "changed": true,
2023-03-14 21:03:53,888 - INFO - "checksum": "2bcef80382eef3ca1b768f5b558593aa866aa357",
2023-03-14 21:03:53,888 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/netutil.log",
2023-03-14 21:03:53,888 - INFO - "md5sum": "e7b362afe46e1a1b1aa6975806d67909",
2023-03-14 21:03:53,888 - INFO - "remote_checksum": "2bcef80382eef3ca1b768f5b558593aa866aa357",
2023-03-14 21:03:53,889 - INFO - "remote_md5sum": null
2023-03-14 21:03:53,889 - INFO - }
2023-03-14 21:03:55,069 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:03:55,070 - INFO - "changed": true,
2023-03-14 21:03:55,070 - INFO - "checksum": "c03ffcd3328b822c50c86e5ef203adf3b00a5142",
2023-03-14 21:03:55,070 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/top.log",
2023-03-14 21:03:55,070 - INFO - "md5sum": "8cb67d47def424f698be30dfbf20fc87",
2023-03-14 21:03:55,070 - INFO - "remote_checksum": "c03ffcd3328b822c50c86e5ef203adf3b00a5142",
2023-03-14 21:03:55,070 - INFO - "remote_md5sum": null
2023-03-14 21:03:55,070 - INFO - }
2023-03-14 21:03:56,176 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:03:56,177 - INFO - "changed": true,
2023-03-14 21:03:56,177 - INFO - "checksum": "0eecf027044a52ff57e87a1ef1f9277e1ceb146e",
2023-03-14 21:03:56,177 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon-v.dat",
2023-03-14 21:03:56,177 - INFO - "md5sum": "9ed6ca61f164c3a1ddac82b3adb8e41f",
2023-03-14 21:03:56,177 - INFO - "remote_checksum": "0eecf027044a52ff57e87a1ef1f9277e1ceb146e",
2023-03-14 21:03:56,177 - INFO - "remote_md5sum": null
2023-03-14 21:03:56,177 - INFO - }
2023-03-14 21:03:57,320 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:03:57,320 - INFO - "changed": true,
2023-03-14 21:03:57,321 - INFO - "checksum": "553de59ae1f861c17499a345947edac24f5ef5e6",
2023-03-14 21:03:57,321 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon-M.dat",
2023-03-14 21:03:57,321 - INFO - "md5sum": "82b2e5d1d33c2feb6e5d5290b113dd3f",
2023-03-14 21:03:57,321 - INFO - "remote_checksum": "553de59ae1f861c17499a345947edac24f5ef5e6",
2023-03-14 21:03:57,321 - INFO - "remote_md5sum": null
2023-03-14 21:03:57,321 - INFO - }
2023-03-14 21:03:58,921 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:03:58,921 - INFO - "changed": true,
2023-03-14 21:03:58,921 - INFO - "checksum": "27937a538934f3f04d2bdc17337a7faf5af086eb",
2023-03-14 21:03:58,921 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon.dat",
2023-03-14 21:03:58,921 - INFO - "md5sum": "debd6dd57126e6e7beaa9878143652b1",
2023-03-14 21:03:58,921 - INFO - "remote_checksum": "27937a538934f3f04d2bdc17337a7faf5af086eb",
2023-03-14 21:03:58,922 - INFO - "remote_md5sum": null
2023-03-14 21:03:58,922 - INFO - }
2023-03-14 21:03:59,025 - INFO - 2. fetch the matrics of ai_pipeline
2023-03-14 21:03:59,025 - INFO - 3.  collect the result
2023-03-14 21:03:59,187 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(rate(container_cpu_usage_seconds_total{namespace="default", container!=""}[2m])[2m:])
2023-03-14 21:03:59,187 - INFO - metric_name is: cpu_usage
2023-03-14 21:03:59,201 - INFO - result is: [{'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod37bfe08c_1a35_4f31_aee2_d3ed773045f6.slice/cri-containerd-32957fce66e8ca89850f6a363f2bad55c4c434f4dd10e8ee22d59409d4d63156.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '32957fce66e8ca89850f6a363f2bad55c4c434f4dd10e8ee22d59409d4d63156', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-06-59c94bd6dd-7fqpw', 'service': 'kubelet'}, 'value': [1678853039.187, '0.06824127777779519']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod443d56fd_7192_407b_aa7f_3a19c6164b35.slice/cri-containerd-8ef35ec5e997b42b467e9a537ce481f8b80255b055daf3b4d653e511cc959b79.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '8ef35ec5e997b42b467e9a537ce481f8b80255b055daf3b4d653e511cc959b79', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-02-59c94bd6dd-hf2k2', 'service': 'kubelet'}, 'value': [1678853039.187, '0.07346791388889767']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod5b20665e_1471_41e3_a906_37dbadf61ded.slice/cri-containerd-1903d9a29e2cc9280c983cf212ed426789dd4724ed212d8d6aaa692b7099b21d.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '1903d9a29e2cc9280c983cf212ed426789dd4724ed212d8d6aaa692b7099b21d', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-05-59c94bd6dd-2vw5v', 'service': 'kubelet'}, 'value': [1678853039.187, '0.07022525555556866']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podc1b02e88_e7c7_494d_b700_42e46c1f306d.slice/cri-containerd-8eb30a61e0cb53f9f0a8c0c18dc645c56eb3686a459ce4441c537113ae8007ae.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '8eb30a61e0cb53f9f0a8c0c18dc645c56eb3686a459ce4441c537113ae8007ae', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-04-59c94bd6dd-whjrf', 'service': 'kubelet'}, 'value': [1678853039.187, '0.07084430555555123']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podf0bbadd5_e728_4dc7_ac09_67de87ab9ed9.slice/cri-containerd-d2606d2272b90c545952113b692da741b7958b163650096e2f624aeee76293a8.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'd2606d2272b90c545952113b692da741b7958b163650096e2f624aeee76293a8', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-03-59c94bd6dd-57bn5', 'service': 'kubelet'}, 'value': [1678853039.187, '0.07156553333332137']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podf765b16c_07f8_4261_9b64_3517dc6bafb7.slice/cri-containerd-88d725ffe5a1ce389c7c711b044f1cbdd7b97a922268c6d9d0735d1ba203f048.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '88d725ffe5a1ce389c7c711b044f1cbdd7b97a922268c6d9d0735d1ba203f048', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-01-59c94bd6dd-n5rdt', 'service': 'kubelet'}, 'value': [1678853039.187, '0.07242310833335067']}, {'metric': {'container': 'ei-gws', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podaf221d52_33c6_40a0_b6bf_e5e2bc7b88db.slice/cri-containerd-870edc8724b46c501ca89d89b821712566f2c55b1d2077b638d4cbb0f32dcada.scope', 'image': 'ccr-registry.caas.intel.com/cnbench/ei-gateway-server:2022WW51-ws-8080', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '870edc8724b46c501ca89d89b821712566f2c55b1d2077b638d4cbb0f32dcada', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-gateway-server-deployment-694bf969dd-xhbg9', 'service': 'kubelet'}, 'value': [1678853039.187, '0.0012464555555557883']}, {'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-burstable.slice/kubepods-burstable-podb3ef5929_0e73_4f5b_9a44_e1b1c9694dff.slice/cri-containerd-010abd7c71ab0c24925e8ae5898c0cafd7cbac3725d1c407e4c34edc1f90e2ae.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-inference-service-tensorflow:2022WW49', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '010abd7c71ab0c24925e8ae5898c0cafd7cbac3725d1c407e4c34edc1f90e2ae', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q', 'service': 'kubelet'}, 'value': [1678853039.187, '1.223209136111111']}, {'metric': {'container': 'ei-wss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podd781997c_c6e4_4a9a_8814_f1a5e364edb4.slice/cri-containerd-d43dd1ddebde49d8cd5407a60d348e56d9384fcda992f264ae9ca5887ba0ab87.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-websocket-server:2022WW51', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'd43dd1ddebde49d8cd5407a60d348e56d9384fcda992f264ae9ca5887ba0ab87', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-websocket-server-deployment-b4f68d987-95vnz', 'service': 'kubelet'}, 'value': [1678853039.187, '0.00871768333334128']}, {'metric': {'container': 'nfs-subdir-external-provisioner', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod008ca2f8_cd34_4bb5_9e75_b46ec5ce9a23.slice/cri-containerd-710ae0fcfaef79b8c1cbf5871a10727a0da4ef1ca22a1fd9e475a740588b43e4.scope', 'image': 'k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '710ae0fcfaef79b8c1cbf5871a10727a0da4ef1ca22a1fd9e475a740588b43e4', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'nfs-subdir-external-provisioner-6f66496f8f-529tg', 'service': 'kubelet'}, 'value': [1678853039.187, '0.0010199222222228045']}, {'metric': {'container': 'redis', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod0d8f249f_8e44_4dae_82d3_618b15befd15.slice/cri-containerd-0d39607a911d680151ccaee4e31a4eeb21acbade8e1a9eb7cd5377c4796e012e.scope', 'image': 'docker.io/library/redis:6.0', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '0d39607a911d680151ccaee4e31a4eeb21acbade8e1a9eb7cd5377c4796e012e', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-redis-deployment-68df56c9d5-9kt42', 'service': 'kubelet'}, 'value': [1678853039.187, '0.012054338888891732']}, {'metric': {'container': 'tmp-shell', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod9cbe7477_0ea6_463d_8c1e_33eb5efda051.slice/cri-containerd-9093ed8c6f94ca6b98db8362a28e0ee47cc31e863e7c131462759af96d66c3e9.scope', 'image': 'docker.io/nicolaka/netshoot:latest', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '9093ed8c6f94ca6b98db8362a28e0ee47cc31e863e7c131462759af96d66c3e9', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'tmp-shell', 'service': 'kubelet'}, 'value': [1678853039.187, '0']}]
2023-03-14 21:03:59,202 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=sum(container_memory_working_set_bytes{namespace="default",container!="", image!=""}) by (pod)
2023-03-14 21:03:59,202 - INFO - metric_name is: memory_usage
2023-03-14 21:03:59,202 - INFO - result is: [{'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-06-59c94bd6dd-7fqpw'}, 'value': [1678853039.191, '386162688']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-02-59c94bd6dd-hf2k2'}, 'value': [1678853039.191, '386437120']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-05-59c94bd6dd-2vw5v'}, 'value': [1678853039.191, '386568192']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-04-59c94bd6dd-whjrf'}, 'value': [1678853039.191, '386166784']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-03-59c94bd6dd-57bn5'}, 'value': [1678853039.191, '386580480']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-01-59c94bd6dd-n5rdt'}, 'value': [1678853039.191, '386002944']}, {'metric': {'pod': 'ei-gateway-server-deployment-694bf969dd-xhbg9'}, 'value': [1678853039.191, '56774656']}, {'metric': {'pod': 'ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q'}, 'value': [1678853039.191, '330694656']}, {'metric': {'pod': 'ei-websocket-server-deployment-b4f68d987-95vnz'}, 'value': [1678853039.191, '5093191680']}, {'metric': {'pod': 'nfs-subdir-external-provisioner-6f66496f8f-529tg'}, 'value': [1678853039.191, '15306752']}, {'metric': {'pod': 'ei-redis-deployment-68df56c9d5-9kt42'}, 'value': [1678853039.191, '2445201408']}, {'metric': {'pod': 'tmp-shell'}, 'value': [1678853039.191, '847872']}]
2023-03-14 21:03:59,202 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_infer_fps{namespace="default"}[2m])
2023-03-14 21:03:59,202 - INFO - metric_name is: ei_infer_fps
2023-03-14 21:03:59,202 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.12:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678853039.195, '64.66219121708606']}]
2023-03-14 21:03:59,202 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_drop_fps{namespace="default"}[2m])
2023-03-14 21:03:59,202 - INFO - metric_name is: ei_drop_fps
2023-03-14 21:03:59,202 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.12:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678853039.199, '105.33072174276785']}]
2023-03-14 21:03:59,202 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_scale_ratio{namespace="default"}[2m])
2023-03-14 21:03:59,202 - INFO - metric_name is: ei_scale_ratio
2023-03-14 21:03:59,202 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.12:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678853039.202, '2.6292624719167024']}]
2023-03-14 21:03:59,203 - INFO - Results written to metrics/E086_NON_VNNI_INT8_metrics_20230314_210359.txt
2023-03-14 21:03:59,269 - INFO - sleep 120 seconds for the next round ...
2023-03-14 21:05:59,273 - INFO - -----------loop num:3/3------------
2023-03-14 21:06:09,279 - INFO - 1.  fetch_emon.sh
2023-03-14 21:06:09,281 - INFO - pwd=/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon
2023-03-14 21:06:11,160 - INFO - 10.45.247.200 | SUCCESS => {
2023-03-14 21:06:11,160 - INFO - "ansible_facts": {
2023-03-14 21:06:11,160 - INFO - "discovered_interpreter_python": "/usr/bin/python3"
2023-03-14 21:06:11,160 - INFO - },
2023-03-14 21:06:11,160 - INFO - "changed": false,
2023-03-14 21:06:11,160 - INFO - "checksum": "1bb1c680bf42bce57bd33e9ee945d27bb8aeaafc",
2023-03-14 21:06:11,161 - INFO - "dest": "runemon.sh",
2023-03-14 21:06:11,161 - INFO - "gid": 1007,
2023-03-14 21:06:11,161 - INFO - "group": "ansible",
2023-03-14 21:06:11,161 - INFO - "mode": "0755",
2023-03-14 21:06:11,161 - INFO - "owner": "ansible",
2023-03-14 21:06:11,161 - INFO - "path": "runemon.sh",
2023-03-14 21:06:11,161 - INFO - "size": 452,
2023-03-14 21:06:11,161 - INFO - "state": "file",
2023-03-14 21:06:11,161 - INFO - "uid": 1006
2023-03-14 21:06:11,161 - INFO - }
2023-03-14 21:06:12,550 - INFO - 10.45.247.200 | SUCCESS => {
2023-03-14 21:06:12,551 - INFO - "ansible_facts": {
2023-03-14 21:06:12,551 - INFO - "discovered_interpreter_python": "/usr/bin/python3"
2023-03-14 21:06:12,551 - INFO - },
2023-03-14 21:06:12,551 - INFO - "changed": false,
2023-03-14 21:06:12,551 - INFO - "checksum": "0b7ce1d178a191ee4962273d5bcbcac8b825066d",
2023-03-14 21:06:12,551 - INFO - "dest": "sapphirerapids_server_events_private.txt",
2023-03-14 21:06:12,551 - INFO - "gid": 1007,
2023-03-14 21:06:12,551 - INFO - "group": "ansible",
2023-03-14 21:06:12,551 - INFO - "mode": "0664",
2023-03-14 21:06:12,552 - INFO - "owner": "ansible",
2023-03-14 21:06:12,552 - INFO - "path": "sapphirerapids_server_events_private.txt",
2023-03-14 21:06:12,552 - INFO - "size": 23423,
2023-03-14 21:06:12,552 - INFO - "state": "file",
2023-03-14 21:06:12,552 - INFO - "uid": 1006
2023-03-14 21:06:12,552 - INFO - }
2023-03-14 21:06:13,663 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:06:13,663 - INFO - 
2023-03-14 21:06:14,781 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:06:14,781 - INFO - 
2023-03-14 21:06:14,877 - INFO - Sleep 5 seconds then collect emon data for 30 seconds
2023-03-14 21:06:19,881 - INFO - Collecting 30 seconds sar data background
2023-03-14 21:06:21,845 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:06:21,846 - INFO - 
2023-03-14 21:06:23,913 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:06:23,913 - INFO - 
2023-03-14 21:06:26,004 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:06:26,004 - INFO - 
2023-03-14 21:06:28,105 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:06:28,105 - INFO - 
2023-03-14 21:06:28,202 - INFO - Collecting EMON data
2023-03-14 21:06:59,702 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:06:59,702 - INFO - Usage: sep_vars.sh [emon_api]
2023-03-14 21:06:59,702 - INFO - PATH=/opt/intel/sep/bin64:/opt/intel/sep/android_target:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin
2023-03-14 21:06:59,702 - INFO - CPATH=/opt/intel/sep/config/emon_api:
2023-03-14 21:06:59,702 - INFO - LIBRARY_PATH=/opt/intel/sep/lib64:
2023-03-14 21:06:59,702 - INFO - LD_LIBRARY_PATH=
2023-03-14 21:06:59,703 - INFO - SEP_BASE_DIR=/opt/intel/sep/bin64
2023-03-14 21:06:59,703 - INFO - SEP is currently installed under /opt/intel/sep/bin64
2023-03-14 21:06:59,703 - INFO - EMON collector successfully stopped.
2023-03-14 21:06:59,806 - INFO - Sleep another 30 seconds to make sure the previous run exit
2023-03-14 21:07:29,809 - INFO - Copy dat files
2023-03-14 21:07:30,818 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:07:30,818 - INFO - "changed": true,
2023-03-14 21:07:30,818 - INFO - "checksum": "a3ee0801ca5668f9c2bf2f4b09526264271a752d",
2023-03-14 21:07:30,818 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/cpuutil.log",
2023-03-14 21:07:30,818 - INFO - "md5sum": "6d13f6fce41729c47e103f3d832a806f",
2023-03-14 21:07:30,818 - INFO - "remote_checksum": "a3ee0801ca5668f9c2bf2f4b09526264271a752d",
2023-03-14 21:07:30,818 - INFO - "remote_md5sum": null
2023-03-14 21:07:30,818 - INFO - }
2023-03-14 21:07:31,926 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:07:31,926 - INFO - "changed": true,
2023-03-14 21:07:31,926 - INFO - "checksum": "40057e9f755b543c60dd4fdaa4692f9fbb042d41",
2023-03-14 21:07:31,926 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/diskutil.log",
2023-03-14 21:07:31,927 - INFO - "md5sum": "b00b747a40ec72af5454606a8bdccaa2",
2023-03-14 21:07:31,927 - INFO - "remote_checksum": "40057e9f755b543c60dd4fdaa4692f9fbb042d41",
2023-03-14 21:07:31,927 - INFO - "remote_md5sum": null
2023-03-14 21:07:31,927 - INFO - }
2023-03-14 21:07:33,028 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:07:33,029 - INFO - "changed": true,
2023-03-14 21:07:33,029 - INFO - "checksum": "c2e6a8ef40abb81a72450056af0e86c089e59bd8",
2023-03-14 21:07:33,029 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/netutil.log",
2023-03-14 21:07:33,029 - INFO - "md5sum": "5bd3303668a595a0a8a3aa79fbda9ccd",
2023-03-14 21:07:33,029 - INFO - "remote_checksum": "c2e6a8ef40abb81a72450056af0e86c089e59bd8",
2023-03-14 21:07:33,029 - INFO - "remote_md5sum": null
2023-03-14 21:07:33,029 - INFO - }
2023-03-14 21:07:34,171 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:07:34,172 - INFO - "changed": true,
2023-03-14 21:07:34,172 - INFO - "checksum": "b484f9ce6f4894c5f74467a7adaab702996a003c",
2023-03-14 21:07:34,172 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/top.log",
2023-03-14 21:07:34,172 - INFO - "md5sum": "23b7e3c806225b07483acc91ff6839c5",
2023-03-14 21:07:34,172 - INFO - "remote_checksum": "b484f9ce6f4894c5f74467a7adaab702996a003c",
2023-03-14 21:07:34,172 - INFO - "remote_md5sum": null
2023-03-14 21:07:34,172 - INFO - }
2023-03-14 21:07:35,296 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:07:35,296 - INFO - "changed": true,
2023-03-14 21:07:35,296 - INFO - "checksum": "0eecf027044a52ff57e87a1ef1f9277e1ceb146e",
2023-03-14 21:07:35,297 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon-v.dat",
2023-03-14 21:07:35,297 - INFO - "md5sum": "9ed6ca61f164c3a1ddac82b3adb8e41f",
2023-03-14 21:07:35,297 - INFO - "remote_checksum": "0eecf027044a52ff57e87a1ef1f9277e1ceb146e",
2023-03-14 21:07:35,297 - INFO - "remote_md5sum": null
2023-03-14 21:07:35,297 - INFO - }
2023-03-14 21:07:36,387 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:07:36,387 - INFO - "changed": true,
2023-03-14 21:07:36,387 - INFO - "checksum": "553de59ae1f861c17499a345947edac24f5ef5e6",
2023-03-14 21:07:36,387 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon-M.dat",
2023-03-14 21:07:36,387 - INFO - "md5sum": "82b2e5d1d33c2feb6e5d5290b113dd3f",
2023-03-14 21:07:36,387 - INFO - "remote_checksum": "553de59ae1f861c17499a345947edac24f5ef5e6",
2023-03-14 21:07:36,387 - INFO - "remote_md5sum": null
2023-03-14 21:07:36,388 - INFO - }
2023-03-14 21:07:37,993 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:07:37,993 - INFO - "changed": true,
2023-03-14 21:07:37,993 - INFO - "checksum": "d08dbb5c547846d9603a0ba2472bfab7c82abdfb",
2023-03-14 21:07:37,994 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon.dat",
2023-03-14 21:07:37,994 - INFO - "md5sum": "650c16c78613a9a1cd3b3170ae3aed25",
2023-03-14 21:07:37,994 - INFO - "remote_checksum": "d08dbb5c547846d9603a0ba2472bfab7c82abdfb",
2023-03-14 21:07:37,994 - INFO - "remote_md5sum": null
2023-03-14 21:07:37,994 - INFO - }
2023-03-14 21:07:38,096 - INFO - 2. fetch the matrics of ai_pipeline
2023-03-14 21:07:38,096 - INFO - 3.  collect the result
2023-03-14 21:07:38,257 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(rate(container_cpu_usage_seconds_total{namespace="default", container!=""}[2m])[2m:])
2023-03-14 21:07:38,258 - INFO - metric_name is: cpu_usage
2023-03-14 21:07:38,274 - INFO - result is: [{'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod37bfe08c_1a35_4f31_aee2_d3ed773045f6.slice/cri-containerd-32957fce66e8ca89850f6a363f2bad55c4c434f4dd10e8ee22d59409d4d63156.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '32957fce66e8ca89850f6a363f2bad55c4c434f4dd10e8ee22d59409d4d63156', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-06-59c94bd6dd-7fqpw', 'service': 'kubelet'}, 'value': [1678853258.257, '0.06482291666664726']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod443d56fd_7192_407b_aa7f_3a19c6164b35.slice/cri-containerd-8ef35ec5e997b42b467e9a537ce481f8b80255b055daf3b4d653e511cc959b79.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '8ef35ec5e997b42b467e9a537ce481f8b80255b055daf3b4d653e511cc959b79', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-02-59c94bd6dd-hf2k2', 'service': 'kubelet'}, 'value': [1678853258.257, '0.07343635833335105']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod5b20665e_1471_41e3_a906_37dbadf61ded.slice/cri-containerd-1903d9a29e2cc9280c983cf212ed426789dd4724ed212d8d6aaa692b7099b21d.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '1903d9a29e2cc9280c983cf212ed426789dd4724ed212d8d6aaa692b7099b21d', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-05-59c94bd6dd-2vw5v', 'service': 'kubelet'}, 'value': [1678853258.257, '0.07145613333335253']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podc1b02e88_e7c7_494d_b700_42e46c1f306d.slice/cri-containerd-8eb30a61e0cb53f9f0a8c0c18dc645c56eb3686a459ce4441c537113ae8007ae.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '8eb30a61e0cb53f9f0a8c0c18dc645c56eb3686a459ce4441c537113ae8007ae', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-04-59c94bd6dd-whjrf', 'service': 'kubelet'}, 'value': [1678853258.257, '0.06732765555556802']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podf0bbadd5_e728_4dc7_ac09_67de87ab9ed9.slice/cri-containerd-d2606d2272b90c545952113b692da741b7958b163650096e2f624aeee76293a8.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'd2606d2272b90c545952113b692da741b7958b163650096e2f624aeee76293a8', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-03-59c94bd6dd-57bn5', 'service': 'kubelet'}, 'value': [1678853258.257, '0.06979685277779532']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podf765b16c_07f8_4261_9b64_3517dc6bafb7.slice/cri-containerd-88d725ffe5a1ce389c7c711b044f1cbdd7b97a922268c6d9d0735d1ba203f048.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '88d725ffe5a1ce389c7c711b044f1cbdd7b97a922268c6d9d0735d1ba203f048', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-01-59c94bd6dd-n5rdt', 'service': 'kubelet'}, 'value': [1678853258.257, '0.07037573333333663']}, {'metric': {'container': 'ei-gws', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podaf221d52_33c6_40a0_b6bf_e5e2bc7b88db.slice/cri-containerd-870edc8724b46c501ca89d89b821712566f2c55b1d2077b638d4cbb0f32dcada.scope', 'image': 'ccr-registry.caas.intel.com/cnbench/ei-gateway-server:2022WW51-ws-8080', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '870edc8724b46c501ca89d89b821712566f2c55b1d2077b638d4cbb0f32dcada', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-gateway-server-deployment-694bf969dd-xhbg9', 'service': 'kubelet'}, 'value': [1678853258.257, '0.0013201749999994816']}, {'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-burstable.slice/kubepods-burstable-podb3ef5929_0e73_4f5b_9a44_e1b1c9694dff.slice/cri-containerd-010abd7c71ab0c24925e8ae5898c0cafd7cbac3725d1c407e4c34edc1f90e2ae.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-inference-service-tensorflow:2022WW49', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '010abd7c71ab0c24925e8ae5898c0cafd7cbac3725d1c407e4c34edc1f90e2ae', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q', 'service': 'kubelet'}, 'value': [1678853258.257, '1.23965185']}, {'metric': {'container': 'ei-wss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podd781997c_c6e4_4a9a_8814_f1a5e364edb4.slice/cri-containerd-d43dd1ddebde49d8cd5407a60d348e56d9384fcda992f264ae9ca5887ba0ab87.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-websocket-server:2022WW51', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'd43dd1ddebde49d8cd5407a60d348e56d9384fcda992f264ae9ca5887ba0ab87', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-websocket-server-deployment-b4f68d987-95vnz', 'service': 'kubelet'}, 'value': [1678853258.257, '0.008806805555559549']}, {'metric': {'container': 'nfs-subdir-external-provisioner', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod008ca2f8_cd34_4bb5_9e75_b46ec5ce9a23.slice/cri-containerd-710ae0fcfaef79b8c1cbf5871a10727a0da4ef1ca22a1fd9e475a740588b43e4.scope', 'image': 'k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '710ae0fcfaef79b8c1cbf5871a10727a0da4ef1ca22a1fd9e475a740588b43e4', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'nfs-subdir-external-provisioner-6f66496f8f-529tg', 'service': 'kubelet'}, 'value': [1678853258.257, '0.0009303083333331111']}, {'metric': {'container': 'redis', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod0d8f249f_8e44_4dae_82d3_618b15befd15.slice/cri-containerd-0d39607a911d680151ccaee4e31a4eeb21acbade8e1a9eb7cd5377c4796e012e.scope', 'image': 'docker.io/library/redis:6.0', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '0d39607a911d680151ccaee4e31a4eeb21acbade8e1a9eb7cd5377c4796e012e', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-redis-deployment-68df56c9d5-9kt42', 'service': 'kubelet'}, 'value': [1678853258.257, '0.011917158333335464']}, {'metric': {'container': 'tmp-shell', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod9cbe7477_0ea6_463d_8c1e_33eb5efda051.slice/cri-containerd-9093ed8c6f94ca6b98db8362a28e0ee47cc31e863e7c131462759af96d66c3e9.scope', 'image': 'docker.io/nicolaka/netshoot:latest', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '9093ed8c6f94ca6b98db8362a28e0ee47cc31e863e7c131462759af96d66c3e9', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'tmp-shell', 'service': 'kubelet'}, 'value': [1678853258.257, '0']}]
2023-03-14 21:07:38,275 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=sum(container_memory_working_set_bytes{namespace="default",container!="", image!=""}) by (pod)
2023-03-14 21:07:38,275 - INFO - metric_name is: memory_usage
2023-03-14 21:07:38,275 - INFO - result is: [{'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-06-59c94bd6dd-7fqpw'}, 'value': [1678853258.262, '386162688']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-02-59c94bd6dd-hf2k2'}, 'value': [1678853258.262, '386564096']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-05-59c94bd6dd-2vw5v'}, 'value': [1678853258.262, '386551808']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-04-59c94bd6dd-whjrf'}, 'value': [1678853258.262, '386166784']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-03-59c94bd6dd-57bn5'}, 'value': [1678853258.262, '386605056']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-01-59c94bd6dd-n5rdt'}, 'value': [1678853258.262, '386134016']}, {'metric': {'pod': 'ei-gateway-server-deployment-694bf969dd-xhbg9'}, 'value': [1678853258.262, '56774656']}, {'metric': {'pod': 'ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q'}, 'value': [1678853258.262, '330559488']}, {'metric': {'pod': 'ei-websocket-server-deployment-b4f68d987-95vnz'}, 'value': [1678853258.262, '5093191680']}, {'metric': {'pod': 'nfs-subdir-external-provisioner-6f66496f8f-529tg'}, 'value': [1678853258.262, '15429632']}, {'metric': {'pod': 'ei-redis-deployment-68df56c9d5-9kt42'}, 'value': [1678853258.262, '2445275136']}, {'metric': {'pod': 'tmp-shell'}, 'value': [1678853258.262, '847872']}]
2023-03-14 21:07:38,275 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_infer_fps{namespace="default"}[2m])
2023-03-14 21:07:38,275 - INFO - metric_name is: ei_infer_fps
2023-03-14 21:07:38,275 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.12:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678853258.266, '64.74498050713073']}]
2023-03-14 21:07:38,275 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_drop_fps{namespace="default"}[2m])
2023-03-14 21:07:38,275 - INFO - metric_name is: ei_drop_fps
2023-03-14 21:07:38,275 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.12:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678853258.27, '105.44382285464415']}]
2023-03-14 21:07:38,275 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_scale_ratio{namespace="default"}[2m])
2023-03-14 21:07:38,276 - INFO - metric_name is: ei_scale_ratio
2023-03-14 21:07:38,276 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.12:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678853258.273, '2.6289219322523114']}]
2023-03-14 21:07:38,276 - INFO - Results written to metrics/E086_NON_VNNI_INT8_metrics_20230314_210738.txt
2023-03-14 21:07:38,344 - INFO - ------------- scenario: 5/5 ------------
2023-03-14 21:07:38,345 - INFO - Begin set_deployment_env of scenario : AMX_IN8 ...
2023-03-14 21:07:38,401 - INFO - Setting environment variables for scenario AMX_IN8...
2023-03-14 21:07:38,422 - INFO - Setting resource requests and limits for scenario AMX_IN8...
2023-03-14 21:07:38,442 - INFO - after patch_body wait for 30 seconds to enable the new pods
2023-03-14 21:08:08,472 - INFO - Waiting for 1 pods to be ready for scenario AMX_IN8...
2023-03-14 21:08:08,544 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-5767795f6f-mhn8x status:Pending
2023-03-14 21:08:08,544 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q status:Running
2023-03-14 21:08:08,544 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_IN8. Elapsed time: 0.07 seconds
2023-03-14 21:08:18,579 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-5767795f6f-mhn8x status:Pending
2023-03-14 21:08:18,579 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q status:Running
2023-03-14 21:08:18,579 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_IN8. Elapsed time: 10.11 seconds
2023-03-14 21:08:28,613 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-5767795f6f-mhn8x status:Pending
2023-03-14 21:08:28,614 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q status:Running
2023-03-14 21:08:28,614 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_IN8. Elapsed time: 20.14 seconds
2023-03-14 21:08:38,649 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-5767795f6f-mhn8x status:Pending
2023-03-14 21:08:38,649 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q status:Running
2023-03-14 21:08:38,649 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_IN8. Elapsed time: 30.18 seconds
2023-03-14 21:08:48,679 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-5767795f6f-mhn8x status:Pending
2023-03-14 21:08:48,679 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q status:Running
2023-03-14 21:08:48,679 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_IN8. Elapsed time: 40.21 seconds
2023-03-14 21:08:58,714 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-5767795f6f-mhn8x status:Pending
2023-03-14 21:08:58,714 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q status:Running
2023-03-14 21:08:58,714 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_IN8. Elapsed time: 50.24 seconds
2023-03-14 21:09:08,746 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-5767795f6f-mhn8x status:Pending
2023-03-14 21:09:08,747 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q status:Running
2023-03-14 21:09:08,747 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_IN8. Elapsed time: 60.27 seconds
2023-03-14 21:09:18,781 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-5767795f6f-mhn8x status:Pending
2023-03-14 21:09:18,781 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q status:Running
2023-03-14 21:09:18,781 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_IN8. Elapsed time: 70.31 seconds
2023-03-14 21:09:28,813 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-5767795f6f-mhn8x status:Pending
2023-03-14 21:09:28,813 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q status:Running
2023-03-14 21:09:28,813 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_IN8. Elapsed time: 80.34 seconds
2023-03-14 21:09:38,848 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-5767795f6f-mhn8x status:Pending
2023-03-14 21:09:38,848 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q status:Running
2023-03-14 21:09:38,849 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_IN8. Elapsed time: 90.38 seconds
2023-03-14 21:09:48,884 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-5767795f6f-mhn8x status:Pending
2023-03-14 21:09:48,885 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q status:Running
2023-03-14 21:09:48,885 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_IN8. Elapsed time: 100.41 seconds
2023-03-14 21:09:58,920 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-5767795f6f-mhn8x status:Pending
2023-03-14 21:09:58,921 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q status:Running
2023-03-14 21:09:58,921 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_IN8. Elapsed time: 110.45 seconds
2023-03-14 21:10:08,957 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-5767795f6f-mhn8x status:Pending
2023-03-14 21:10:08,957 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q status:Running
2023-03-14 21:10:08,958 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_IN8. Elapsed time: 120.48 seconds
2023-03-14 21:10:18,984 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-5767795f6f-mhn8x status:Pending
2023-03-14 21:10:18,985 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q status:Running
2023-03-14 21:10:18,985 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_IN8. Elapsed time: 130.51 seconds
2023-03-14 21:10:29,021 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-5767795f6f-mhn8x status:Pending
2023-03-14 21:10:29,021 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-db6f57466-gct9q status:Running
2023-03-14 21:10:29,021 - INFO - Waiting for 0 more pods to be ready, there are 1 not ready pods for scenario AMX_IN8. Elapsed time: 140.55 seconds
2023-03-14 21:10:39,050 - INFO - pod: ei-infer-deployment-pose-bf16-amx-01-5767795f6f-mhn8x status:Running
2023-03-14 21:10:39,050 - INFO - All 1 pods are ready for scenario AMX_IN8
2023-03-14 21:10:39,051 - INFO - Finished scenario AMX_IN8
2023-03-14 21:10:39,051 - INFO - wait for 2m to get stable metrics ...
2023-03-14 21:12:39,053 - INFO - Running benchmarking script for scenario AMX_IN8...
2023-03-14 21:12:39,066 - INFO - TS=20230314211239
2023-03-14 21:12:41,008 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:12:41,008 - INFO - Reading package lists...
2023-03-14 21:12:41,009 - INFO - Building dependency tree...
2023-03-14 21:12:41,009 - INFO - Reading state information...
2023-03-14 21:12:41,009 - INFO - linux-tools-5.15.0-60-generic is already the newest version (5.15.0-60.66).
2023-03-14 21:12:41,009 - INFO - sysstat is already the newest version (12.5.2-2ubuntu0.1).
2023-03-14 21:12:41,009 - INFO - The following packages were automatically installed and are no longer required:
2023-03-14 21:12:41,009 - INFO - cgroupfs-mount libltdl7 pigz
2023-03-14 21:12:41,009 - INFO - Use 'sudo apt autoremove' to remove them.
2023-03-14 21:12:41,009 - INFO - 0 upgraded, 0 newly installed, 0 to remove and 44 not upgraded.
2023-03-14 21:12:41,009 - INFO - WARNING: apt does not have a stable CLI interface. Use with caution in scripts.
2023-03-14 21:12:42,113 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:12:42,113 - INFO - 
2023-03-14 21:12:43,172 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:12:43,173 - INFO - performance
2023-03-14 21:12:43,275 - INFO - Run on test AiPipeline_20230314211239_E086_AMX_IN8_6
2023-03-14 21:12:43,275 - INFO - TT=AiPipeline_20230314211239_E086_AMX_IN8_6,WRKDIR=/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon
2023-03-14 21:12:43,281 - INFO - -----------loop num:1/3------------
2023-03-14 21:12:53,286 - INFO - 1.  fetch_emon.sh
2023-03-14 21:12:53,288 - INFO - pwd=/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon
2023-03-14 21:12:54,650 - INFO - 10.45.247.200 | SUCCESS => {
2023-03-14 21:12:54,650 - INFO - "ansible_facts": {
2023-03-14 21:12:54,650 - INFO - "discovered_interpreter_python": "/usr/bin/python3"
2023-03-14 21:12:54,650 - INFO - },
2023-03-14 21:12:54,650 - INFO - "changed": false,
2023-03-14 21:12:54,651 - INFO - "checksum": "1bb1c680bf42bce57bd33e9ee945d27bb8aeaafc",
2023-03-14 21:12:54,651 - INFO - "dest": "runemon.sh",
2023-03-14 21:12:54,651 - INFO - "gid": 1007,
2023-03-14 21:12:54,651 - INFO - "group": "ansible",
2023-03-14 21:12:54,651 - INFO - "mode": "0755",
2023-03-14 21:12:54,651 - INFO - "owner": "ansible",
2023-03-14 21:12:54,651 - INFO - "path": "runemon.sh",
2023-03-14 21:12:54,651 - INFO - "size": 452,
2023-03-14 21:12:54,651 - INFO - "state": "file",
2023-03-14 21:12:54,651 - INFO - "uid": 1006
2023-03-14 21:12:54,651 - INFO - }
2023-03-14 21:12:56,059 - INFO - 10.45.247.200 | SUCCESS => {
2023-03-14 21:12:56,059 - INFO - "ansible_facts": {
2023-03-14 21:12:56,059 - INFO - "discovered_interpreter_python": "/usr/bin/python3"
2023-03-14 21:12:56,060 - INFO - },
2023-03-14 21:12:56,060 - INFO - "changed": false,
2023-03-14 21:12:56,060 - INFO - "checksum": "0b7ce1d178a191ee4962273d5bcbcac8b825066d",
2023-03-14 21:12:56,060 - INFO - "dest": "sapphirerapids_server_events_private.txt",
2023-03-14 21:12:56,060 - INFO - "gid": 1007,
2023-03-14 21:12:56,060 - INFO - "group": "ansible",
2023-03-14 21:12:56,060 - INFO - "mode": "0664",
2023-03-14 21:12:56,060 - INFO - "owner": "ansible",
2023-03-14 21:12:56,060 - INFO - "path": "sapphirerapids_server_events_private.txt",
2023-03-14 21:12:56,060 - INFO - "size": 23423,
2023-03-14 21:12:56,060 - INFO - "state": "file",
2023-03-14 21:12:56,060 - INFO - "uid": 1006
2023-03-14 21:12:56,060 - INFO - }
2023-03-14 21:12:57,142 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:12:57,143 - INFO - 
2023-03-14 21:12:58,216 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:12:58,216 - INFO - 
2023-03-14 21:12:58,312 - INFO - Sleep 5 seconds then collect emon data for 30 seconds
2023-03-14 21:13:03,316 - INFO - Collecting 30 seconds sar data background
2023-03-14 21:13:05,288 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:13:05,289 - INFO - 
2023-03-14 21:13:07,354 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:13:07,354 - INFO - 
2023-03-14 21:13:09,414 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:13:09,415 - INFO - 
2023-03-14 21:13:11,618 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:13:11,619 - INFO - 
2023-03-14 21:13:11,719 - INFO - Collecting EMON data
2023-03-14 21:13:43,226 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:13:43,226 - INFO - Usage: sep_vars.sh [emon_api]
2023-03-14 21:13:43,226 - INFO - PATH=/opt/intel/sep/bin64:/opt/intel/sep/android_target:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin
2023-03-14 21:13:43,226 - INFO - CPATH=/opt/intel/sep/config/emon_api:
2023-03-14 21:13:43,226 - INFO - LIBRARY_PATH=/opt/intel/sep/lib64:
2023-03-14 21:13:43,226 - INFO - LD_LIBRARY_PATH=
2023-03-14 21:13:43,226 - INFO - SEP_BASE_DIR=/opt/intel/sep/bin64
2023-03-14 21:13:43,226 - INFO - SEP is currently installed under /opt/intel/sep/bin64
2023-03-14 21:13:43,226 - INFO - EMON collector successfully stopped.
2023-03-14 21:13:43,303 - INFO - Sleep another 30 seconds to make sure the previous run exit
2023-03-14 21:14:13,306 - INFO - Copy dat files
2023-03-14 21:14:14,321 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:14:14,321 - INFO - "changed": true,
2023-03-14 21:14:14,322 - INFO - "checksum": "dc811d32202d32d436edc18a6e9bdd1d5e3b8339",
2023-03-14 21:14:14,322 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/cpuutil.log",
2023-03-14 21:14:14,322 - INFO - "md5sum": "41613a95e4ef2f4950d82b6d40a3cef9",
2023-03-14 21:14:14,322 - INFO - "remote_checksum": "dc811d32202d32d436edc18a6e9bdd1d5e3b8339",
2023-03-14 21:14:14,322 - INFO - "remote_md5sum": null
2023-03-14 21:14:14,322 - INFO - }
2023-03-14 21:14:15,497 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:14:15,498 - INFO - "changed": true,
2023-03-14 21:14:15,498 - INFO - "checksum": "d3661aae0ade8ee7640d68be4946e343861a3876",
2023-03-14 21:14:15,498 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/diskutil.log",
2023-03-14 21:14:15,498 - INFO - "md5sum": "19d5b0cc1ccadd6fe0a13fe241ee82f8",
2023-03-14 21:14:15,498 - INFO - "remote_checksum": "d3661aae0ade8ee7640d68be4946e343861a3876",
2023-03-14 21:14:15,498 - INFO - "remote_md5sum": null
2023-03-14 21:14:15,498 - INFO - }
2023-03-14 21:14:16,459 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:14:16,459 - INFO - "changed": true,
2023-03-14 21:14:16,459 - INFO - "checksum": "9925dd27d1b5f6a9d36b7ee1776188ddeb59e645",
2023-03-14 21:14:16,459 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/netutil.log",
2023-03-14 21:14:16,460 - INFO - "md5sum": "d6f705f90088abbdf0e1ed42eea323e6",
2023-03-14 21:14:16,460 - INFO - "remote_checksum": "9925dd27d1b5f6a9d36b7ee1776188ddeb59e645",
2023-03-14 21:14:16,460 - INFO - "remote_md5sum": null
2023-03-14 21:14:16,460 - INFO - }
2023-03-14 21:14:17,597 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:14:17,597 - INFO - "changed": true,
2023-03-14 21:14:17,597 - INFO - "checksum": "3b72903cdf0e8eeffc03253f512da430b765045c",
2023-03-14 21:14:17,597 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/top.log",
2023-03-14 21:14:17,598 - INFO - "md5sum": "b0e1b7458aadae44ccc52be2bda82021",
2023-03-14 21:14:17,598 - INFO - "remote_checksum": "3b72903cdf0e8eeffc03253f512da430b765045c",
2023-03-14 21:14:17,598 - INFO - "remote_md5sum": null
2023-03-14 21:14:17,598 - INFO - }
2023-03-14 21:14:18,687 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:14:18,687 - INFO - "changed": true,
2023-03-14 21:14:18,688 - INFO - "checksum": "0eecf027044a52ff57e87a1ef1f9277e1ceb146e",
2023-03-14 21:14:18,688 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon-v.dat",
2023-03-14 21:14:18,688 - INFO - "md5sum": "9ed6ca61f164c3a1ddac82b3adb8e41f",
2023-03-14 21:14:18,688 - INFO - "remote_checksum": "0eecf027044a52ff57e87a1ef1f9277e1ceb146e",
2023-03-14 21:14:18,688 - INFO - "remote_md5sum": null
2023-03-14 21:14:18,688 - INFO - }
2023-03-14 21:14:19,772 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:14:19,773 - INFO - "changed": true,
2023-03-14 21:14:19,773 - INFO - "checksum": "553de59ae1f861c17499a345947edac24f5ef5e6",
2023-03-14 21:14:19,773 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon-M.dat",
2023-03-14 21:14:19,773 - INFO - "md5sum": "82b2e5d1d33c2feb6e5d5290b113dd3f",
2023-03-14 21:14:19,773 - INFO - "remote_checksum": "553de59ae1f861c17499a345947edac24f5ef5e6",
2023-03-14 21:14:19,773 - INFO - "remote_md5sum": null
2023-03-14 21:14:19,773 - INFO - }
2023-03-14 21:14:21,363 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:14:21,364 - INFO - "changed": true,
2023-03-14 21:14:21,364 - INFO - "checksum": "cfd159e231918524f2dcb6aee5fd3e126eaaba30",
2023-03-14 21:14:21,364 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon.dat",
2023-03-14 21:14:21,364 - INFO - "md5sum": "cb24a17e911b129b9067614f2da60615",
2023-03-14 21:14:21,364 - INFO - "remote_checksum": "cfd159e231918524f2dcb6aee5fd3e126eaaba30",
2023-03-14 21:14:21,364 - INFO - "remote_md5sum": null
2023-03-14 21:14:21,364 - INFO - }
2023-03-14 21:14:21,468 - INFO - 2. fetch the matrics of ai_pipeline
2023-03-14 21:14:21,469 - INFO - 3.  collect the result
2023-03-14 21:14:21,614 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(rate(container_cpu_usage_seconds_total{namespace="default", container!=""}[2m])[2m:])
2023-03-14 21:14:21,615 - INFO - metric_name is: cpu_usage
2023-03-14 21:14:21,630 - INFO - result is: [{'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod37bfe08c_1a35_4f31_aee2_d3ed773045f6.slice/cri-containerd-32957fce66e8ca89850f6a363f2bad55c4c434f4dd10e8ee22d59409d4d63156.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '32957fce66e8ca89850f6a363f2bad55c4c434f4dd10e8ee22d59409d4d63156', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-06-59c94bd6dd-7fqpw', 'service': 'kubelet'}, 'value': [1678853661.614, '0.07316230277778635']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod443d56fd_7192_407b_aa7f_3a19c6164b35.slice/cri-containerd-8ef35ec5e997b42b467e9a537ce481f8b80255b055daf3b4d653e511cc959b79.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '8ef35ec5e997b42b467e9a537ce481f8b80255b055daf3b4d653e511cc959b79', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-02-59c94bd6dd-hf2k2', 'service': 'kubelet'}, 'value': [1678853661.614, '0.07882126666667723']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod5b20665e_1471_41e3_a906_37dbadf61ded.slice/cri-containerd-1903d9a29e2cc9280c983cf212ed426789dd4724ed212d8d6aaa692b7099b21d.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '1903d9a29e2cc9280c983cf212ed426789dd4724ed212d8d6aaa692b7099b21d', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-05-59c94bd6dd-2vw5v', 'service': 'kubelet'}, 'value': [1678853661.614, '0.07645199722220342']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podc1b02e88_e7c7_494d_b700_42e46c1f306d.slice/cri-containerd-8eb30a61e0cb53f9f0a8c0c18dc645c56eb3686a459ce4441c537113ae8007ae.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '8eb30a61e0cb53f9f0a8c0c18dc645c56eb3686a459ce4441c537113ae8007ae', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-04-59c94bd6dd-whjrf', 'service': 'kubelet'}, 'value': [1678853661.614, '0.06888409166666759']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podf0bbadd5_e728_4dc7_ac09_67de87ab9ed9.slice/cri-containerd-d2606d2272b90c545952113b692da741b7958b163650096e2f624aeee76293a8.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'd2606d2272b90c545952113b692da741b7958b163650096e2f624aeee76293a8', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-03-59c94bd6dd-57bn5', 'service': 'kubelet'}, 'value': [1678853661.614, '0.07339565833335655']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podf765b16c_07f8_4261_9b64_3517dc6bafb7.slice/cri-containerd-88d725ffe5a1ce389c7c711b044f1cbdd7b97a922268c6d9d0735d1ba203f048.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '88d725ffe5a1ce389c7c711b044f1cbdd7b97a922268c6d9d0735d1ba203f048', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-01-59c94bd6dd-n5rdt', 'service': 'kubelet'}, 'value': [1678853661.614, '0.07192456388889291']}, {'metric': {'container': 'ei-gws', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podaf221d52_33c6_40a0_b6bf_e5e2bc7b88db.slice/cri-containerd-870edc8724b46c501ca89d89b821712566f2c55b1d2077b638d4cbb0f32dcada.scope', 'image': 'ccr-registry.caas.intel.com/cnbench/ei-gateway-server:2022WW51-ws-8080', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '870edc8724b46c501ca89d89b821712566f2c55b1d2077b638d4cbb0f32dcada', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-gateway-server-deployment-694bf969dd-xhbg9', 'service': 'kubelet'}, 'value': [1678853661.614, '0.0012203722222219918']}, {'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-burstable.slice/kubepods-burstable-pod9bf31969_1e12_428a_92ec_e8e7128d5ada.slice/cri-containerd-ee01519dfbf06412fd33468674e1f852e6e6fbf48aac1be50b423b3005b3b3cf.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-inference-service-tensorflow:2022WW49', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'ee01519dfbf06412fd33468674e1f852e6e6fbf48aac1be50b423b3005b3b3cf', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-5767795f6f-mhn8x', 'service': 'kubelet'}, 'value': [1678853661.614, '1.4913756433962961']}, {'metric': {'container': 'ei-wss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podd781997c_c6e4_4a9a_8814_f1a5e364edb4.slice/cri-containerd-d43dd1ddebde49d8cd5407a60d348e56d9384fcda992f264ae9ca5887ba0ab87.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-websocket-server:2022WW51', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'd43dd1ddebde49d8cd5407a60d348e56d9384fcda992f264ae9ca5887ba0ab87', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-websocket-server-deployment-b4f68d987-95vnz', 'service': 'kubelet'}, 'value': [1678853661.614, '0.005869236111109582']}, {'metric': {'container': 'nfs-subdir-external-provisioner', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod008ca2f8_cd34_4bb5_9e75_b46ec5ce9a23.slice/cri-containerd-710ae0fcfaef79b8c1cbf5871a10727a0da4ef1ca22a1fd9e475a740588b43e4.scope', 'image': 'k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '710ae0fcfaef79b8c1cbf5871a10727a0da4ef1ca22a1fd9e475a740588b43e4', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'nfs-subdir-external-provisioner-6f66496f8f-529tg', 'service': 'kubelet'}, 'value': [1678853661.614, '0.0010620888888878551']}, {'metric': {'container': 'redis', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod0d8f249f_8e44_4dae_82d3_618b15befd15.slice/cri-containerd-0d39607a911d680151ccaee4e31a4eeb21acbade8e1a9eb7cd5377c4796e012e.scope', 'image': 'docker.io/library/redis:6.0', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '0d39607a911d680151ccaee4e31a4eeb21acbade8e1a9eb7cd5377c4796e012e', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-redis-deployment-68df56c9d5-9kt42', 'service': 'kubelet'}, 'value': [1678853661.614, '0.015098683333331387']}, {'metric': {'container': 'tmp-shell', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod9cbe7477_0ea6_463d_8c1e_33eb5efda051.slice/cri-containerd-9093ed8c6f94ca6b98db8362a28e0ee47cc31e863e7c131462759af96d66c3e9.scope', 'image': 'docker.io/nicolaka/netshoot:latest', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '9093ed8c6f94ca6b98db8362a28e0ee47cc31e863e7c131462759af96d66c3e9', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'tmp-shell', 'service': 'kubelet'}, 'value': [1678853661.614, '0']}]
2023-03-14 21:14:21,630 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=sum(container_memory_working_set_bytes{namespace="default",container!="", image!=""}) by (pod)
2023-03-14 21:14:21,631 - INFO - metric_name is: memory_usage
2023-03-14 21:14:21,631 - INFO - result is: [{'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-06-59c94bd6dd-7fqpw'}, 'value': [1678853661.619, '386183168']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-02-59c94bd6dd-hf2k2'}, 'value': [1678853661.619, '386564096']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-05-59c94bd6dd-2vw5v'}, 'value': [1678853661.619, '386445312']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-04-59c94bd6dd-whjrf'}, 'value': [1678853661.619, '386166784']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-03-59c94bd6dd-57bn5'}, 'value': [1678853661.619, '386654208']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-01-59c94bd6dd-n5rdt'}, 'value': [1678853661.619, '386134016']}, {'metric': {'pod': 'ei-gateway-server-deployment-694bf969dd-xhbg9'}, 'value': [1678853661.619, '56774656']}, {'metric': {'pod': 'ei-infer-deployment-pose-bf16-amx-01-5767795f6f-mhn8x'}, 'value': [1678853661.619, '339902464']}, {'metric': {'pod': 'ei-websocket-server-deployment-b4f68d987-95vnz'}, 'value': [1678853661.619, '5093191680']}, {'metric': {'pod': 'nfs-subdir-external-provisioner-6f66496f8f-529tg'}, 'value': [1678853661.619, '15581184']}, {'metric': {'pod': 'ei-redis-deployment-68df56c9d5-9kt42'}, 'value': [1678853661.619, '2444951552']}, {'metric': {'pod': 'tmp-shell'}, 'value': [1678853661.619, '847872']}]
2023-03-14 21:14:21,631 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_infer_fps{namespace="default"}[2m])
2023-03-14 21:14:21,631 - INFO - metric_name is: ei_infer_fps
2023-03-14 21:14:21,631 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.5:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-5767795f6f-mhn8x', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678853661.623, '118.84694911986008']}]
2023-03-14 21:14:21,631 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_drop_fps{namespace="default"}[2m])
2023-03-14 21:14:21,631 - INFO - metric_name is: ei_drop_fps
2023-03-14 21:14:21,631 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.5:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-5767795f6f-mhn8x', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678853661.627, '51.15204542252124']}]
2023-03-14 21:14:21,631 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_scale_ratio{namespace="default"}[2m])
2023-03-14 21:14:21,631 - INFO - metric_name is: ei_scale_ratio
2023-03-14 21:14:21,631 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.5:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-5767795f6f-mhn8x', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678853661.631, '1.4306872209349009']}]
2023-03-14 21:14:21,632 - INFO - Results written to metrics/E086_AMX_IN8_metrics_20230314_211421.txt
2023-03-14 21:14:21,699 - INFO - sleep 120 seconds for the next round ...
2023-03-14 21:16:21,702 - INFO - -----------loop num:2/3------------
2023-03-14 21:16:31,709 - INFO - 1.  fetch_emon.sh
2023-03-14 21:16:31,711 - INFO - pwd=/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon
2023-03-14 21:16:33,622 - INFO - 10.45.247.200 | SUCCESS => {
2023-03-14 21:16:33,623 - INFO - "ansible_facts": {
2023-03-14 21:16:33,623 - INFO - "discovered_interpreter_python": "/usr/bin/python3"
2023-03-14 21:16:33,623 - INFO - },
2023-03-14 21:16:33,623 - INFO - "changed": false,
2023-03-14 21:16:33,623 - INFO - "checksum": "1bb1c680bf42bce57bd33e9ee945d27bb8aeaafc",
2023-03-14 21:16:33,623 - INFO - "dest": "runemon.sh",
2023-03-14 21:16:33,623 - INFO - "gid": 1007,
2023-03-14 21:16:33,624 - INFO - "group": "ansible",
2023-03-14 21:16:33,624 - INFO - "mode": "0755",
2023-03-14 21:16:33,624 - INFO - "owner": "ansible",
2023-03-14 21:16:33,624 - INFO - "path": "runemon.sh",
2023-03-14 21:16:33,624 - INFO - "size": 452,
2023-03-14 21:16:33,624 - INFO - "state": "file",
2023-03-14 21:16:33,624 - INFO - "uid": 1006
2023-03-14 21:16:33,624 - INFO - }
2023-03-14 21:16:35,115 - INFO - 10.45.247.200 | SUCCESS => {
2023-03-14 21:16:35,115 - INFO - "ansible_facts": {
2023-03-14 21:16:35,115 - INFO - "discovered_interpreter_python": "/usr/bin/python3"
2023-03-14 21:16:35,115 - INFO - },
2023-03-14 21:16:35,116 - INFO - "changed": false,
2023-03-14 21:16:35,116 - INFO - "checksum": "0b7ce1d178a191ee4962273d5bcbcac8b825066d",
2023-03-14 21:16:35,116 - INFO - "dest": "sapphirerapids_server_events_private.txt",
2023-03-14 21:16:35,116 - INFO - "gid": 1007,
2023-03-14 21:16:35,116 - INFO - "group": "ansible",
2023-03-14 21:16:35,116 - INFO - "mode": "0664",
2023-03-14 21:16:35,116 - INFO - "owner": "ansible",
2023-03-14 21:16:35,116 - INFO - "path": "sapphirerapids_server_events_private.txt",
2023-03-14 21:16:35,116 - INFO - "size": 23423,
2023-03-14 21:16:35,116 - INFO - "state": "file",
2023-03-14 21:16:35,116 - INFO - "uid": 1006
2023-03-14 21:16:35,116 - INFO - }
2023-03-14 21:16:36,225 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:16:36,225 - INFO - 
2023-03-14 21:16:37,327 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:16:37,328 - INFO - 
2023-03-14 21:16:37,429 - INFO - Sleep 5 seconds then collect emon data for 30 seconds
2023-03-14 21:16:42,433 - INFO - Collecting 30 seconds sar data background
2023-03-14 21:16:44,399 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:16:44,399 - INFO - 
2023-03-14 21:16:46,457 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:16:46,457 - INFO - 
2023-03-14 21:16:48,513 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:16:48,513 - INFO - 
2023-03-14 21:16:50,583 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:16:50,584 - INFO - 
2023-03-14 21:16:50,688 - INFO - Collecting EMON data
2023-03-14 21:17:22,240 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:17:22,241 - INFO - Usage: sep_vars.sh [emon_api]
2023-03-14 21:17:22,241 - INFO - PATH=/opt/intel/sep/bin64:/opt/intel/sep/android_target:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin
2023-03-14 21:17:22,241 - INFO - CPATH=/opt/intel/sep/config/emon_api:
2023-03-14 21:17:22,241 - INFO - LIBRARY_PATH=/opt/intel/sep/lib64:
2023-03-14 21:17:22,241 - INFO - LD_LIBRARY_PATH=
2023-03-14 21:17:22,241 - INFO - SEP_BASE_DIR=/opt/intel/sep/bin64
2023-03-14 21:17:22,241 - INFO - SEP is currently installed under /opt/intel/sep/bin64
2023-03-14 21:17:22,241 - INFO - EMON collector successfully stopped.
2023-03-14 21:17:22,342 - INFO - Sleep another 30 seconds to make sure the previous run exit
2023-03-14 21:17:52,345 - INFO - Copy dat files
2023-03-14 21:17:53,368 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:17:53,368 - INFO - "changed": true,
2023-03-14 21:17:53,368 - INFO - "checksum": "2e33d6baf9a9c154aeb6ff3a4b57fd195c1105b9",
2023-03-14 21:17:53,369 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/cpuutil.log",
2023-03-14 21:17:53,369 - INFO - "md5sum": "3c6a3ee194c69e14a4876c3e6d359ae2",
2023-03-14 21:17:53,369 - INFO - "remote_checksum": "2e33d6baf9a9c154aeb6ff3a4b57fd195c1105b9",
2023-03-14 21:17:53,369 - INFO - "remote_md5sum": null
2023-03-14 21:17:53,369 - INFO - }
2023-03-14 21:17:54,597 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:17:54,598 - INFO - "changed": true,
2023-03-14 21:17:54,598 - INFO - "checksum": "446eb05248e65d9d2dc5c5381a92f5e67b2b11b3",
2023-03-14 21:17:54,598 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/diskutil.log",
2023-03-14 21:17:54,598 - INFO - "md5sum": "bb5ff3560c4c4d3f35ac44158beef91d",
2023-03-14 21:17:54,598 - INFO - "remote_checksum": "446eb05248e65d9d2dc5c5381a92f5e67b2b11b3",
2023-03-14 21:17:54,598 - INFO - "remote_md5sum": null
2023-03-14 21:17:54,598 - INFO - }
2023-03-14 21:17:55,710 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:17:55,710 - INFO - "changed": true,
2023-03-14 21:17:55,710 - INFO - "checksum": "e0103684e7957f603ca46ea17db8e24f0e82edac",
2023-03-14 21:17:55,711 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/netutil.log",
2023-03-14 21:17:55,711 - INFO - "md5sum": "f913169134ff405f75619069529d3b72",
2023-03-14 21:17:55,711 - INFO - "remote_checksum": "e0103684e7957f603ca46ea17db8e24f0e82edac",
2023-03-14 21:17:55,711 - INFO - "remote_md5sum": null
2023-03-14 21:17:55,711 - INFO - }
2023-03-14 21:17:56,862 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:17:56,862 - INFO - "changed": true,
2023-03-14 21:17:56,862 - INFO - "checksum": "bfd25772ec7259828f79d7079cff5565dd03f427",
2023-03-14 21:17:56,862 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/top.log",
2023-03-14 21:17:56,862 - INFO - "md5sum": "fb1ca89c28e8cb8d1b02a43042b208bc",
2023-03-14 21:17:56,862 - INFO - "remote_checksum": "bfd25772ec7259828f79d7079cff5565dd03f427",
2023-03-14 21:17:56,862 - INFO - "remote_md5sum": null
2023-03-14 21:17:56,863 - INFO - }
2023-03-14 21:17:57,955 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:17:57,956 - INFO - "changed": true,
2023-03-14 21:17:57,956 - INFO - "checksum": "0eecf027044a52ff57e87a1ef1f9277e1ceb146e",
2023-03-14 21:17:57,956 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon-v.dat",
2023-03-14 21:17:57,956 - INFO - "md5sum": "9ed6ca61f164c3a1ddac82b3adb8e41f",
2023-03-14 21:17:57,956 - INFO - "remote_checksum": "0eecf027044a52ff57e87a1ef1f9277e1ceb146e",
2023-03-14 21:17:57,956 - INFO - "remote_md5sum": null
2023-03-14 21:17:57,956 - INFO - }
2023-03-14 21:17:59,050 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:17:59,050 - INFO - "changed": true,
2023-03-14 21:17:59,050 - INFO - "checksum": "553de59ae1f861c17499a345947edac24f5ef5e6",
2023-03-14 21:17:59,050 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon-M.dat",
2023-03-14 21:17:59,050 - INFO - "md5sum": "82b2e5d1d33c2feb6e5d5290b113dd3f",
2023-03-14 21:17:59,050 - INFO - "remote_checksum": "553de59ae1f861c17499a345947edac24f5ef5e6",
2023-03-14 21:17:59,050 - INFO - "remote_md5sum": null
2023-03-14 21:17:59,051 - INFO - }
2023-03-14 21:18:00,675 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:18:00,676 - INFO - "changed": true,
2023-03-14 21:18:00,676 - INFO - "checksum": "8d798fe708f7791cde3b399ddf6eefcd743607a5",
2023-03-14 21:18:00,676 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon.dat",
2023-03-14 21:18:00,676 - INFO - "md5sum": "504e4141df85265c32b9f849ea2c6f60",
2023-03-14 21:18:00,676 - INFO - "remote_checksum": "8d798fe708f7791cde3b399ddf6eefcd743607a5",
2023-03-14 21:18:00,676 - INFO - "remote_md5sum": null
2023-03-14 21:18:00,676 - INFO - }
2023-03-14 21:18:00,780 - INFO - 2. fetch the matrics of ai_pipeline
2023-03-14 21:18:00,780 - INFO - 3.  collect the result
2023-03-14 21:18:00,941 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(rate(container_cpu_usage_seconds_total{namespace="default", container!=""}[2m])[2m:])
2023-03-14 21:18:00,942 - INFO - metric_name is: cpu_usage
2023-03-14 21:18:00,957 - INFO - result is: [{'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod37bfe08c_1a35_4f31_aee2_d3ed773045f6.slice/cri-containerd-32957fce66e8ca89850f6a363f2bad55c4c434f4dd10e8ee22d59409d4d63156.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '32957fce66e8ca89850f6a363f2bad55c4c434f4dd10e8ee22d59409d4d63156', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-06-59c94bd6dd-7fqpw', 'service': 'kubelet'}, 'value': [1678853880.942, '0.0748259972222311']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod443d56fd_7192_407b_aa7f_3a19c6164b35.slice/cri-containerd-8ef35ec5e997b42b467e9a537ce481f8b80255b055daf3b4d653e511cc959b79.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '8ef35ec5e997b42b467e9a537ce481f8b80255b055daf3b4d653e511cc959b79', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-02-59c94bd6dd-hf2k2', 'service': 'kubelet'}, 'value': [1678853880.942, '0.07432128888889969']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod5b20665e_1471_41e3_a906_37dbadf61ded.slice/cri-containerd-1903d9a29e2cc9280c983cf212ed426789dd4724ed212d8d6aaa692b7099b21d.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '1903d9a29e2cc9280c983cf212ed426789dd4724ed212d8d6aaa692b7099b21d', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-05-59c94bd6dd-2vw5v', 'service': 'kubelet'}, 'value': [1678853880.942, '0.07338105000000925']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podc1b02e88_e7c7_494d_b700_42e46c1f306d.slice/cri-containerd-8eb30a61e0cb53f9f0a8c0c18dc645c56eb3686a459ce4441c537113ae8007ae.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '8eb30a61e0cb53f9f0a8c0c18dc645c56eb3686a459ce4441c537113ae8007ae', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-04-59c94bd6dd-whjrf', 'service': 'kubelet'}, 'value': [1678853880.942, '0.06744988888886938']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podf0bbadd5_e728_4dc7_ac09_67de87ab9ed9.slice/cri-containerd-d2606d2272b90c545952113b692da741b7958b163650096e2f624aeee76293a8.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'd2606d2272b90c545952113b692da741b7958b163650096e2f624aeee76293a8', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-03-59c94bd6dd-57bn5', 'service': 'kubelet'}, 'value': [1678853880.942, '0.07129966111109146']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podf765b16c_07f8_4261_9b64_3517dc6bafb7.slice/cri-containerd-88d725ffe5a1ce389c7c711b044f1cbdd7b97a922268c6d9d0735d1ba203f048.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '88d725ffe5a1ce389c7c711b044f1cbdd7b97a922268c6d9d0735d1ba203f048', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-01-59c94bd6dd-n5rdt', 'service': 'kubelet'}, 'value': [1678853880.942, '0.0747000638888494']}, {'metric': {'container': 'ei-gws', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podaf221d52_33c6_40a0_b6bf_e5e2bc7b88db.slice/cri-containerd-870edc8724b46c501ca89d89b821712566f2c55b1d2077b638d4cbb0f32dcada.scope', 'image': 'ccr-registry.caas.intel.com/cnbench/ei-gateway-server:2022WW51-ws-8080', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '870edc8724b46c501ca89d89b821712566f2c55b1d2077b638d4cbb0f32dcada', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-gateway-server-deployment-694bf969dd-xhbg9', 'service': 'kubelet'}, 'value': [1678853880.942, '0.0011962444444444977']}, {'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-burstable.slice/kubepods-burstable-pod9bf31969_1e12_428a_92ec_e8e7128d5ada.slice/cri-containerd-ee01519dfbf06412fd33468674e1f852e6e6fbf48aac1be50b423b3005b3b3cf.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-inference-service-tensorflow:2022WW49', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'ee01519dfbf06412fd33468674e1f852e6e6fbf48aac1be50b423b3005b3b3cf', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-5767795f6f-mhn8x', 'service': 'kubelet'}, 'value': [1678853880.942, '1.5706111249999999']}, {'metric': {'container': 'ei-wss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podd781997c_c6e4_4a9a_8814_f1a5e364edb4.slice/cri-containerd-d43dd1ddebde49d8cd5407a60d348e56d9384fcda992f264ae9ca5887ba0ab87.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-websocket-server:2022WW51', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'd43dd1ddebde49d8cd5407a60d348e56d9384fcda992f264ae9ca5887ba0ab87', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-websocket-server-deployment-b4f68d987-95vnz', 'service': 'kubelet'}, 'value': [1678853880.942, '0.00650786666666742']}, {'metric': {'container': 'nfs-subdir-external-provisioner', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod008ca2f8_cd34_4bb5_9e75_b46ec5ce9a23.slice/cri-containerd-710ae0fcfaef79b8c1cbf5871a10727a0da4ef1ca22a1fd9e475a740588b43e4.scope', 'image': 'k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '710ae0fcfaef79b8c1cbf5871a10727a0da4ef1ca22a1fd9e475a740588b43e4', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'nfs-subdir-external-provisioner-6f66496f8f-529tg', 'service': 'kubelet'}, 'value': [1678853880.942, '0.0010322000000011636']}, {'metric': {'container': 'redis', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod0d8f249f_8e44_4dae_82d3_618b15befd15.slice/cri-containerd-0d39607a911d680151ccaee4e31a4eeb21acbade8e1a9eb7cd5377c4796e012e.scope', 'image': 'docker.io/library/redis:6.0', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '0d39607a911d680151ccaee4e31a4eeb21acbade8e1a9eb7cd5377c4796e012e', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-redis-deployment-68df56c9d5-9kt42', 'service': 'kubelet'}, 'value': [1678853880.942, '0.01629101944444705']}, {'metric': {'container': 'tmp-shell', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod9cbe7477_0ea6_463d_8c1e_33eb5efda051.slice/cri-containerd-9093ed8c6f94ca6b98db8362a28e0ee47cc31e863e7c131462759af96d66c3e9.scope', 'image': 'docker.io/nicolaka/netshoot:latest', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '9093ed8c6f94ca6b98db8362a28e0ee47cc31e863e7c131462759af96d66c3e9', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'tmp-shell', 'service': 'kubelet'}, 'value': [1678853880.942, '0']}]
2023-03-14 21:18:00,957 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=sum(container_memory_working_set_bytes{namespace="default",container!="", image!=""}) by (pod)
2023-03-14 21:18:00,957 - INFO - metric_name is: memory_usage
2023-03-14 21:18:00,957 - INFO - result is: [{'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-06-59c94bd6dd-7fqpw'}, 'value': [1678853880.946, '386162688']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-02-59c94bd6dd-hf2k2'}, 'value': [1678853880.946, '386433024']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-05-59c94bd6dd-2vw5v'}, 'value': [1678853880.946, '386441216']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-04-59c94bd6dd-whjrf'}, 'value': [1678853880.946, '386166784']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-03-59c94bd6dd-57bn5'}, 'value': [1678853880.946, '386551808']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-01-59c94bd6dd-n5rdt'}, 'value': [1678853880.946, '386134016']}, {'metric': {'pod': 'ei-gateway-server-deployment-694bf969dd-xhbg9'}, 'value': [1678853880.946, '56774656']}, {'metric': {'pod': 'ei-infer-deployment-pose-bf16-amx-01-5767795f6f-mhn8x'}, 'value': [1678853880.946, '340025344']}, {'metric': {'pod': 'ei-websocket-server-deployment-b4f68d987-95vnz'}, 'value': [1678853880.946, '5093060608']}, {'metric': {'pod': 'nfs-subdir-external-provisioner-6f66496f8f-529tg'}, 'value': [1678853880.946, '15171584']}, {'metric': {'pod': 'ei-redis-deployment-68df56c9d5-9kt42'}, 'value': [1678853880.946, '2445291520']}, {'metric': {'pod': 'tmp-shell'}, 'value': [1678853880.946, '847872']}]
2023-03-14 21:18:00,958 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_infer_fps{namespace="default"}[2m])
2023-03-14 21:18:00,958 - INFO - metric_name is: ei_infer_fps
2023-03-14 21:18:00,958 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.5:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-5767795f6f-mhn8x', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678853880.95, '118.78960301180899']}]
2023-03-14 21:18:00,958 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_drop_fps{namespace="default"}[2m])
2023-03-14 21:18:00,958 - INFO - metric_name is: ei_drop_fps
2023-03-14 21:18:00,958 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.5:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-5767795f6f-mhn8x', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678853880.954, '51.4721846480843']}]
2023-03-14 21:18:00,958 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_scale_ratio{namespace="default"}[2m])
2023-03-14 21:18:00,958 - INFO - metric_name is: ei_scale_ratio
2023-03-14 21:18:00,958 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.5:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-5767795f6f-mhn8x', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678853880.958, '1.433436062608144']}]
2023-03-14 21:18:00,958 - INFO - Results written to metrics/E086_AMX_IN8_metrics_20230314_211800.txt
2023-03-14 21:18:01,027 - INFO - sleep 120 seconds for the next round ...
2023-03-14 21:20:01,031 - INFO - -----------loop num:3/3------------
2023-03-14 21:20:11,038 - INFO - 1.  fetch_emon.sh
2023-03-14 21:20:11,039 - INFO - pwd=/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon
2023-03-14 21:20:12,898 - INFO - 10.45.247.200 | SUCCESS => {
2023-03-14 21:20:12,899 - INFO - "ansible_facts": {
2023-03-14 21:20:12,899 - INFO - "discovered_interpreter_python": "/usr/bin/python3"
2023-03-14 21:20:12,899 - INFO - },
2023-03-14 21:20:12,899 - INFO - "changed": false,
2023-03-14 21:20:12,899 - INFO - "checksum": "1bb1c680bf42bce57bd33e9ee945d27bb8aeaafc",
2023-03-14 21:20:12,899 - INFO - "dest": "runemon.sh",
2023-03-14 21:20:12,899 - INFO - "gid": 1007,
2023-03-14 21:20:12,899 - INFO - "group": "ansible",
2023-03-14 21:20:12,900 - INFO - "mode": "0755",
2023-03-14 21:20:12,900 - INFO - "owner": "ansible",
2023-03-14 21:20:12,900 - INFO - "path": "runemon.sh",
2023-03-14 21:20:12,900 - INFO - "size": 452,
2023-03-14 21:20:12,900 - INFO - "state": "file",
2023-03-14 21:20:12,900 - INFO - "uid": 1006
2023-03-14 21:20:12,900 - INFO - }
2023-03-14 21:20:14,427 - INFO - 10.45.247.200 | SUCCESS => {
2023-03-14 21:20:14,427 - INFO - "ansible_facts": {
2023-03-14 21:20:14,427 - INFO - "discovered_interpreter_python": "/usr/bin/python3"
2023-03-14 21:20:14,427 - INFO - },
2023-03-14 21:20:14,427 - INFO - "changed": false,
2023-03-14 21:20:14,427 - INFO - "checksum": "0b7ce1d178a191ee4962273d5bcbcac8b825066d",
2023-03-14 21:20:14,428 - INFO - "dest": "sapphirerapids_server_events_private.txt",
2023-03-14 21:20:14,428 - INFO - "gid": 1007,
2023-03-14 21:20:14,428 - INFO - "group": "ansible",
2023-03-14 21:20:14,428 - INFO - "mode": "0664",
2023-03-14 21:20:14,428 - INFO - "owner": "ansible",
2023-03-14 21:20:14,428 - INFO - "path": "sapphirerapids_server_events_private.txt",
2023-03-14 21:20:14,428 - INFO - "size": 23423,
2023-03-14 21:20:14,428 - INFO - "state": "file",
2023-03-14 21:20:14,428 - INFO - "uid": 1006
2023-03-14 21:20:14,428 - INFO - }
2023-03-14 21:20:15,495 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:20:15,496 - INFO - 
2023-03-14 21:20:16,546 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:20:16,546 - INFO - 
2023-03-14 21:20:16,644 - INFO - Sleep 5 seconds then collect emon data for 30 seconds
2023-03-14 21:20:21,647 - INFO - Collecting 30 seconds sar data background
2023-03-14 21:20:23,619 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:20:23,619 - INFO - 
2023-03-14 21:20:25,690 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:20:25,690 - INFO - 
2023-03-14 21:20:27,758 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:20:27,758 - INFO - 
2023-03-14 21:20:29,827 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:20:29,827 - INFO - 
2023-03-14 21:20:29,924 - INFO - Collecting EMON data
2023-03-14 21:21:01,478 - INFO - 10.45.247.200 | CHANGED | rc=0 >>
2023-03-14 21:21:01,479 - INFO - Usage: sep_vars.sh [emon_api]
2023-03-14 21:21:01,479 - INFO - PATH=/opt/intel/sep/bin64:/opt/intel/sep/android_target:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin
2023-03-14 21:21:01,479 - INFO - CPATH=/opt/intel/sep/config/emon_api:
2023-03-14 21:21:01,479 - INFO - LIBRARY_PATH=/opt/intel/sep/lib64:
2023-03-14 21:21:01,479 - INFO - LD_LIBRARY_PATH=
2023-03-14 21:21:01,479 - INFO - SEP_BASE_DIR=/opt/intel/sep/bin64
2023-03-14 21:21:01,479 - INFO - SEP is currently installed under /opt/intel/sep/bin64
2023-03-14 21:21:01,479 - INFO - EMON collector successfully stopped.
2023-03-14 21:21:01,583 - INFO - Sleep another 30 seconds to make sure the previous run exit
2023-03-14 21:21:31,587 - INFO - Copy dat files
2023-03-14 21:21:32,606 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:21:32,607 - INFO - "changed": true,
2023-03-14 21:21:32,607 - INFO - "checksum": "9d210c48c9952d6c39dfe248e9fa5c09d95b8de6",
2023-03-14 21:21:32,607 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/cpuutil.log",
2023-03-14 21:21:32,607 - INFO - "md5sum": "1ba510a3709f92c642396faaed308435",
2023-03-14 21:21:32,607 - INFO - "remote_checksum": "9d210c48c9952d6c39dfe248e9fa5c09d95b8de6",
2023-03-14 21:21:32,607 - INFO - "remote_md5sum": null
2023-03-14 21:21:32,607 - INFO - }
2023-03-14 21:21:33,710 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:21:33,710 - INFO - "changed": true,
2023-03-14 21:21:33,710 - INFO - "checksum": "4c1a348fff37abdf34ab46ef6386d890e77d1fa9",
2023-03-14 21:21:33,710 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/diskutil.log",
2023-03-14 21:21:33,710 - INFO - "md5sum": "5d3979072a915ec243819ef8d4709f28",
2023-03-14 21:21:33,711 - INFO - "remote_checksum": "4c1a348fff37abdf34ab46ef6386d890e77d1fa9",
2023-03-14 21:21:33,711 - INFO - "remote_md5sum": null
2023-03-14 21:21:33,711 - INFO - }
2023-03-14 21:21:34,858 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:21:34,858 - INFO - "changed": true,
2023-03-14 21:21:34,858 - INFO - "checksum": "22fcf1c352b36d43fa6ee078c70e0be274c5f868",
2023-03-14 21:21:34,858 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/netutil.log",
2023-03-14 21:21:34,859 - INFO - "md5sum": "9b3d8b885585a1e58a50078e6b4d72c8",
2023-03-14 21:21:34,859 - INFO - "remote_checksum": "22fcf1c352b36d43fa6ee078c70e0be274c5f868",
2023-03-14 21:21:34,859 - INFO - "remote_md5sum": null
2023-03-14 21:21:34,859 - INFO - }
2023-03-14 21:21:35,994 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:21:35,994 - INFO - "changed": true,
2023-03-14 21:21:35,994 - INFO - "checksum": "25d58ec92b9122a7b7dae0d4be5a11a3da589892",
2023-03-14 21:21:35,994 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/top.log",
2023-03-14 21:21:35,994 - INFO - "md5sum": "15dc5bc8485c9cc98a1967a6b562c541",
2023-03-14 21:21:35,995 - INFO - "remote_checksum": "25d58ec92b9122a7b7dae0d4be5a11a3da589892",
2023-03-14 21:21:35,995 - INFO - "remote_md5sum": null
2023-03-14 21:21:35,995 - INFO - }
2023-03-14 21:21:37,135 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:21:37,135 - INFO - "changed": true,
2023-03-14 21:21:37,135 - INFO - "checksum": "0eecf027044a52ff57e87a1ef1f9277e1ceb146e",
2023-03-14 21:21:37,136 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon-v.dat",
2023-03-14 21:21:37,136 - INFO - "md5sum": "9ed6ca61f164c3a1ddac82b3adb8e41f",
2023-03-14 21:21:37,136 - INFO - "remote_checksum": "0eecf027044a52ff57e87a1ef1f9277e1ceb146e",
2023-03-14 21:21:37,136 - INFO - "remote_md5sum": null
2023-03-14 21:21:37,136 - INFO - }
2023-03-14 21:21:38,238 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:21:38,238 - INFO - "changed": true,
2023-03-14 21:21:38,238 - INFO - "checksum": "553de59ae1f861c17499a345947edac24f5ef5e6",
2023-03-14 21:21:38,238 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon-M.dat",
2023-03-14 21:21:38,238 - INFO - "md5sum": "82b2e5d1d33c2feb6e5d5290b113dd3f",
2023-03-14 21:21:38,238 - INFO - "remote_checksum": "553de59ae1f861c17499a345947edac24f5ef5e6",
2023-03-14 21:21:38,238 - INFO - "remote_md5sum": null
2023-03-14 21:21:38,239 - INFO - }
2023-03-14 21:21:39,836 - INFO - 10.45.247.200 | CHANGED => {
2023-03-14 21:21:39,836 - INFO - "changed": true,
2023-03-14 21:21:39,836 - INFO - "checksum": "726ab5a2f0404bed9ca6ba92f1fda58e85cbf8b5",
2023-03-14 21:21:39,836 - INFO - "dest": "/home/ansible/yulu/ai_pipeline/ai_pipeline_benchmark/benchmarking/scripts/emon/emon10000/10.45.247.200/emon10000/emon.dat",
2023-03-14 21:21:39,837 - INFO - "md5sum": "f33353f0a8eae90206a2d15e5b165953",
2023-03-14 21:21:39,837 - INFO - "remote_checksum": "726ab5a2f0404bed9ca6ba92f1fda58e85cbf8b5",
2023-03-14 21:21:39,837 - INFO - "remote_md5sum": null
2023-03-14 21:21:39,837 - INFO - }
2023-03-14 21:21:39,938 - INFO - 2. fetch the matrics of ai_pipeline
2023-03-14 21:21:39,938 - INFO - 3.  collect the result
2023-03-14 21:21:40,083 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(rate(container_cpu_usage_seconds_total{namespace="default", container!=""}[2m])[2m:])
2023-03-14 21:21:40,084 - INFO - metric_name is: cpu_usage
2023-03-14 21:21:40,098 - INFO - result is: [{'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod37bfe08c_1a35_4f31_aee2_d3ed773045f6.slice/cri-containerd-32957fce66e8ca89850f6a363f2bad55c4c434f4dd10e8ee22d59409d4d63156.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '32957fce66e8ca89850f6a363f2bad55c4c434f4dd10e8ee22d59409d4d63156', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-06-59c94bd6dd-7fqpw', 'service': 'kubelet'}, 'value': [1678854100.083, '0.06933417222224104']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod443d56fd_7192_407b_aa7f_3a19c6164b35.slice/cri-containerd-8ef35ec5e997b42b467e9a537ce481f8b80255b055daf3b4d653e511cc959b79.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '8ef35ec5e997b42b467e9a537ce481f8b80255b055daf3b4d653e511cc959b79', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-02-59c94bd6dd-hf2k2', 'service': 'kubelet'}, 'value': [1678854100.083, '0.07562251388889207']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod5b20665e_1471_41e3_a906_37dbadf61ded.slice/cri-containerd-1903d9a29e2cc9280c983cf212ed426789dd4724ed212d8d6aaa692b7099b21d.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '1903d9a29e2cc9280c983cf212ed426789dd4724ed212d8d6aaa692b7099b21d', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-05-59c94bd6dd-2vw5v', 'service': 'kubelet'}, 'value': [1678854100.083, '0.07632664722223124']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podc1b02e88_e7c7_494d_b700_42e46c1f306d.slice/cri-containerd-8eb30a61e0cb53f9f0a8c0c18dc645c56eb3686a459ce4441c537113ae8007ae.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '8eb30a61e0cb53f9f0a8c0c18dc645c56eb3686a459ce4441c537113ae8007ae', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-04-59c94bd6dd-whjrf', 'service': 'kubelet'}, 'value': [1678854100.083, '0.07142488888888085']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podf0bbadd5_e728_4dc7_ac09_67de87ab9ed9.slice/cri-containerd-d2606d2272b90c545952113b692da741b7958b163650096e2f624aeee76293a8.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'd2606d2272b90c545952113b692da741b7958b163650096e2f624aeee76293a8', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-03-59c94bd6dd-57bn5', 'service': 'kubelet'}, 'value': [1678854100.083, '0.07159125555556076']}, {'metric': {'container': 'ei-fss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podf765b16c_07f8_4261_9b64_3517dc6bafb7.slice/cri-containerd-88d725ffe5a1ce389c7c711b044f1cbdd7b97a922268c6d9d0735d1ba203f048.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-file-stream-service:2022WW47', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '88d725ffe5a1ce389c7c711b044f1cbdd7b97a922268c6d9d0735d1ba203f048', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-sample-deployment-pose-bf16-amx-01-59c94bd6dd-n5rdt', 'service': 'kubelet'}, 'value': [1678854100.083, '0.0757550833333476']}, {'metric': {'container': 'ei-gws', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podaf221d52_33c6_40a0_b6bf_e5e2bc7b88db.slice/cri-containerd-870edc8724b46c501ca89d89b821712566f2c55b1d2077b638d4cbb0f32dcada.scope', 'image': 'ccr-registry.caas.intel.com/cnbench/ei-gateway-server:2022WW51-ws-8080', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '870edc8724b46c501ca89d89b821712566f2c55b1d2077b638d4cbb0f32dcada', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-gateway-server-deployment-694bf969dd-xhbg9', 'service': 'kubelet'}, 'value': [1678854100.083, '0.0012171249999994415']}, {'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-burstable.slice/kubepods-burstable-pod9bf31969_1e12_428a_92ec_e8e7128d5ada.slice/cri-containerd-ee01519dfbf06412fd33468674e1f852e6e6fbf48aac1be50b423b3005b3b3cf.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-inference-service-tensorflow:2022WW49', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'ee01519dfbf06412fd33468674e1f852e6e6fbf48aac1be50b423b3005b3b3cf', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-5767795f6f-mhn8x', 'service': 'kubelet'}, 'value': [1678854100.083, '1.5482751861111108']}, {'metric': {'container': 'ei-wss', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-podd781997c_c6e4_4a9a_8814_f1a5e364edb4.slice/cri-containerd-d43dd1ddebde49d8cd5407a60d348e56d9384fcda992f264ae9ca5887ba0ab87.scope', 'image': 'gar-registry.caas.intel.com/cpio/ei-websocket-server:2022WW51', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': 'd43dd1ddebde49d8cd5407a60d348e56d9384fcda992f264ae9ca5887ba0ab87', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-websocket-server-deployment-b4f68d987-95vnz', 'service': 'kubelet'}, 'value': [1678854100.083, '0.006789055555555023']}, {'metric': {'container': 'nfs-subdir-external-provisioner', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod008ca2f8_cd34_4bb5_9e75_b46ec5ce9a23.slice/cri-containerd-710ae0fcfaef79b8c1cbf5871a10727a0da4ef1ca22a1fd9e475a740588b43e4.scope', 'image': 'k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '710ae0fcfaef79b8c1cbf5871a10727a0da4ef1ca22a1fd9e475a740588b43e4', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'nfs-subdir-external-provisioner-6f66496f8f-529tg', 'service': 'kubelet'}, 'value': [1678854100.083, '0.0009885694444442884']}, {'metric': {'container': 'redis', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod0d8f249f_8e44_4dae_82d3_618b15befd15.slice/cri-containerd-0d39607a911d680151ccaee4e31a4eeb21acbade8e1a9eb7cd5377c4796e012e.scope', 'image': 'docker.io/library/redis:6.0', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '0d39607a911d680151ccaee4e31a4eeb21acbade8e1a9eb7cd5377c4796e012e', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'ei-redis-deployment-68df56c9d5-9kt42', 'service': 'kubelet'}, 'value': [1678854100.083, '0.01436695555554858']}, {'metric': {'container': 'tmp-shell', 'cpu': 'total', 'endpoint': 'https-metrics', 'id': '/kubepods.slice/kubepods-besteffort.slice/kubepods-besteffort-pod9cbe7477_0ea6_463d_8c1e_33eb5efda051.slice/cri-containerd-9093ed8c6f94ca6b98db8362a28e0ee47cc31e863e7c131462759af96d66c3e9.scope', 'image': 'docker.io/nicolaka/netshoot:latest', 'instance': '10.45.247.200:10250', 'job': 'kubelet', 'metrics_path': '/metrics/cadvisor', 'name': '9093ed8c6f94ca6b98db8362a28e0ee47cc31e863e7c131462759af96d66c3e9', 'namespace': 'default', 'node': 'ai-worker0', 'pod': 'tmp-shell', 'service': 'kubelet'}, 'value': [1678854100.083, '0']}]
2023-03-14 21:21:40,099 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=sum(container_memory_working_set_bytes{namespace="default",container!="", image!=""}) by (pod)
2023-03-14 21:21:40,099 - INFO - metric_name is: memory_usage
2023-03-14 21:21:40,099 - INFO - result is: [{'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-06-59c94bd6dd-7fqpw'}, 'value': [1678854100.088, '386162688']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-02-59c94bd6dd-hf2k2'}, 'value': [1678854100.088, '386564096']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-05-59c94bd6dd-2vw5v'}, 'value': [1678854100.088, '386441216']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-04-59c94bd6dd-whjrf'}, 'value': [1678854100.088, '386166784']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-03-59c94bd6dd-57bn5'}, 'value': [1678854100.088, '386551808']}, {'metric': {'pod': 'ei-sample-deployment-pose-bf16-amx-01-59c94bd6dd-n5rdt'}, 'value': [1678854100.088, '386002944']}, {'metric': {'pod': 'ei-gateway-server-deployment-694bf969dd-xhbg9'}, 'value': [1678854100.088, '56774656']}, {'metric': {'pod': 'ei-infer-deployment-pose-bf16-amx-01-5767795f6f-mhn8x'}, 'value': [1678854100.088, '340008960']}, {'metric': {'pod': 'ei-websocket-server-deployment-b4f68d987-95vnz'}, 'value': [1678854100.088, '5093191680']}, {'metric': {'pod': 'nfs-subdir-external-provisioner-6f66496f8f-529tg'}, 'value': [1678854100.088, '15425536']}, {'metric': {'pod': 'ei-redis-deployment-68df56c9d5-9kt42'}, 'value': [1678854100.088, '2444959744']}, {'metric': {'pod': 'tmp-shell'}, 'value': [1678854100.088, '847872']}]
2023-03-14 21:21:40,099 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_infer_fps{namespace="default"}[2m])
2023-03-14 21:21:40,099 - INFO - metric_name is: ei_infer_fps
2023-03-14 21:21:40,099 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.5:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-5767795f6f-mhn8x', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678854100.092, '118.37593691092667']}]
2023-03-14 21:21:40,100 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_drop_fps{namespace="default"}[2m])
2023-03-14 21:21:40,100 - INFO - metric_name is: ei_drop_fps
2023-03-14 21:21:40,100 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.5:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-5767795f6f-mhn8x', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678854100.096, '51.805613332124345']}]
2023-03-14 21:21:40,100 - INFO - The query to fetch metrics from prometheus is: http://10.45.247.81:31090/api/v1/query?query=avg_over_time(ei_scale_ratio{namespace="default"}[2m])
2023-03-14 21:21:40,100 - INFO - metric_name is: ei_scale_ratio
2023-03-14 21:21:40,100 - INFO - result is: [{'metric': {'container': 'ei-infer-pose-bf16-amx-app', 'endpoint': 'web', 'instance': '10.244.120.5:8000', 'job': 'ei-infer-pose-bf16-amx-app', 'namespace': 'default', 'pod': 'ei-infer-deployment-pose-bf16-amx-01-5767795f6f-mhn8x', 'service': 'ei-infer-pose-bf16-amx-app'}, 'value': [1678854100.099, '1.4380294422668485']}]
2023-03-14 21:21:40,100 - INFO - Results written to metrics/E086_AMX_IN8_metrics_20230314_212140.txt
2023-03-14 21:21:40,169 - INFO - Finished running all scenarios!
